var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var c=d++;return{value:b(c,a[c]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];c in d||(d[c]={});d=d[c]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return d})}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var e="";a;)if(a&1&&(e+=b),a>>>=1)b+=b;return e}},"es6","es3");$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padEnd",function(a){return a?a:function(a,d){var b=$jscomp.checkStringArgs(this,null,"padStart");return b+$jscomp.stringPadding(d,a-b.length)}},"es8","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,d){return a===d?0!==a||1/a===1/d:a!==a&&d!==d}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,d){var b=this;b instanceof String&&(b=String(b));var c=b.length;for(d=d||0;d<c;d++)if(b[d]==a||Object.is(b[d],a))return!0;return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6","es3");
$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,c=0;c<e;c++){var f=a[c];if(b.call(d,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(a){return a instanceof c?a:new c(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){e(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(h){this.asyncThrow_(h)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};c.prototype.createResolveAndReject_=
function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new b;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(h){c.reject(h)}};c.prototype.then=function(a,b){function d(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(u){g(u)}}:b}var f,g,e=new c(function(a,
b){f=a;g=b});this.callWhenSettled_(d(a,f),d(b,g));return e};c.prototype.catch=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};c.resolve=d;c.reject=function(a){return new c(function(b,c){c(a)})};c.race=function(a){return new c(function(b,
c){for(var f=$jscomp.makeIterator(a),e=f.next();!e.done;e=f.next())d(e.value).callWhenSettled_(b,c)})};c.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?d([]):new c(function(a,c){function e(b){return function(c){g[b]=c;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,d(f.value).callWhenSettled_(e(g.length-1),c),f=b.next();while(!f.done)})};return c},"es6","es3");
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,d){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(d,a-b.length)+b}},"es8","es3");angular.module("cahierDeTextesClientApp","angularMoment chieffancypants.loadingBar ngAnimate ngColorPicker ngLocale ngResource ngSanitize ngTouch nvd3 textAngular uiSwitch toastr ui.bootstrap ui.bootstrap.dropdown ui.calendar ui.checkbox ui.router ui.select".split(" "));
angular.module("cahierDeTextesClientApp").config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]).config(["cfpLoadingBarProvider",function(a){a.latencyThreshold=500}]).run(["amMoment",function(a){a.changeLocale("fr")}]).constant("angularMomentConfig",{timezone:"Europe/Brussels"}).config(["$provide",function(a){a.decorator("taTranslations",["$delegate",function(a){a.html.tooltip="Basculer entre les vues HTML et texte enrichi";a.justifyLeft.tooltip="Justifier \u00e0 gauche";a.justifyCenter.tooltip=
"Centrer";a.justifyRight.tooltip="Justifier \u00e0 droite";a.bold.tooltip="Mettre en gras";a.italic.tooltip="Mettre en italique";a.underline.tooltip="Souligner";a.insertLink.tooltip="Ins\u00e9rer un lien";a.insertLink.dialogPrompt="Lien \u00e0 ins\u00e9rer";a.editLink.targetToggle.buttontext="Le lien s'ouvrira dans une nouvelle fen\u00eatre";a.editLink.reLinkButton.tooltip="\u00c9diter le lien";a.editLink.unLinkButton.tooltip="Enlever le lien";a.insertImage.tooltip="Ins\u00e9rer une image";a.insertImage.dialogPrompt=
"URL de l'image :";a.insertVideo.tooltip="Ins\u00e9rer une vid\u00e9o";a.insertVideo.dialogPrompt="URL de la vid\u00e9o Youtube :";a.clear.tooltip="Enlever le formattage";a.ul.tooltip="Liste";a.ol.tooltip="Liste num\u00e9rot\u00e9e";a.quote.tooltip="Citation";a.undo.tooltip="Annuler";a.redo.tooltip="R\u00e9tablir";return a}]);a.decorator("taOptions",["$delegate","taRegisterTool",function(a,d){a.toolbar=["bold italics underline ul ol quote justifyLeft justifyCenter justifyRight insertLink insertImage insertVideo html redo undo".split(" ")];
var b=function(a){var b="backcolor"===a?"background-":"",c="#7bd148 #5484ed #a4bdfc #46d6db #7ae7bf #51b749 #fbd75b #ffb878 #ff887c #dc2127 #dbadff #e1e1e1".split(" ");"backcolor"===a&&c.push("transparent");return{couleurs:c,display:'\x3cspan uib-dropdown\x3e\x3ca uib-dropdown-toggle\x3e\x3ci class\x3d"fa fa-font" data-ng-style\x3d"{\''+b+'color\': selected }"\x3e\x3c/i\x3e \x3ci class\x3d"fa fa-caret-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cng-color-picker uib-dropdown-menu selected\x3d"selected" colors\x3d"couleurs"\x3e\x3c/ng-color-picker\x3e\x3c/span\x3e',
action:function(){return"nil"===this.selected?!1:this.$editor().wrapSelection(a,this.selected)}}};d("fontColor",b("forecolor"));a.toolbar[0].push("fontColor");d("backgroundColor",b("backcolor"));a.toolbar[0].push("backgroundColor");d("table",{columns:{value:1,hovered:1},rows:{value:1,hovered:1},hover:function(a,b){a.hovered=b},leave:function(a){a.hovered=a.value},tooltiptext:"ins\u00e9rer un tableau",display:'\x3cspan uib-dropdown\x3e\x3ca uib-dropdown-toggle\x3e\x3ci class\x3d"fa fa-table"\x3e\x3c/i\x3e \x3ci class\x3d"fa fa-caret-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cdiv uib-dropdown-menu data-ng-click\x3d"$event.stopPropagation()"\x3e\x3clabel\x3e\x3cspan uib-rating on-hover\x3d"hover( columns, value )" on-leave\x3d"leave( columns )" ng-model\x3d"columns.value" max\x3d"15" state-on\x3d"\'glyphicon-stop\'" state-off\x3d"\'glyphicon-unchecked\'"\x3e\x3c/span\x3e\x3cbr\x3e{{columns.hovered}} colonnes\x3c/label\x3e\x3cbr\x3e\x3clabel\x3e\x3cspan uib-rating on-hover\x3d"hover( rows, value )" on-leave\x3d"leave( rows )" ng-model\x3d"rows.value" max\x3d"15" state-on\x3d"\'glyphicon-stop\'" state-off\x3d"\'glyphicon-unchecked\'"\x3e\x3c/span\x3e\x3cbr\x3e{{rows.hovered}} lignes\x3c/label\x3e\x3cbr\x3e\x3cbutton class\x3d"btn btn-success" data-ng-click\x3d"insert_table()"\x3eIns\u00e9rer\x3c/button\x3e\x3c/div\x3e\x3c/span\x3e',
insert_table:function(){for(var a="",b=0;b<this.columns.value;b++)a+="\x3ctd\x3e\x26nbsp;\x3c/td\x3e";b="";for(var d=0;d<this.rows.value;d++)b=b+"\x3ctr\x3e"+a+"\x3c/tr\x3e";this.$editor().wrapSelection("insertHTML",'\x3ctable class\x3d"table table-bordered"\x3e'+b+"\x3c/table\x3e");this.deferration.resolve()},action:function(a){this.deferration=a;return!1}});a.toolbar[0].push("table");a.classes={focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",
disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"};return a}]);a.decorator("taTools",["$delegate",function(a){a.html.buttontext="HTML";return a}])}]).config(["toastrConfig",function(a){angular.extend(a,{allowHtml:!0,closeButton:!1,closeHtml:"\x3cbutton\x3e\x26times;\x3c/button\x3e",containerId:"toast-container",extendedTimeOut:1E3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},maxOpened:0,messageClass:"toast-message",newestOnTop:!0,
onHidden:null,onShown:null,positionClass:"toast-bottom-right",tapToDismiss:!0,target:"body",timeOut:5E3,titleClass:"toast-title",toastClass:"toast"})}]);
angular.module("cahierDeTextesClientApp").constant("LOCALHOST",!1).constant("ZONE","A").constant("POPUP_ACTIONS",{CANCELLED:"CANCELLED",CRENEAU_DELETED:"CRENEAU_DELETED",CRENEAU_MODIFIED:"CRENEAU_MODIFIED",SEQUENCE_PEDAGOGIQUE_CREATED:"SEQUENCE_PEDAGOGIQUE_CREATED",SEQUENCE_PEDAGOGIQUE_MODIFIED:"SEQUENCE_PEDAGOGIQUE_MODIFIED",SEQUENCE_PEDAGOGIQUE_DUPLICATED:"SEQUENCE_PEDAGOGIQUE_DUPLICATED",SEQUENCE_PEDAGOGIQUE_DELETED:"SEQUENCE_PEDAGOGIQUE_DELETED",DEVOIR_CREATED:"DEVOIR_CREATED",DEVOIR_MODIFIED:"DEVOIR_MODIFIED",
DEVOIR_DUPLICATED:"DEVOIR_DUPLICATED",DEVOIR_DELETED:"DEVOIR_DELETED"}).constant("MULTIBARCHART_DEFINITION",{data:[],options:{chart:{type:"multiBarChart",height:240,showControls:!1,showLegend:!0,showLabels:!0,stacked:!1,duration:500,reduceXTicks:!1,rotateLabels:-45,labelSunbeamLayout:!0,color:function(a,b){return{"saisies non vis\u00e9es":"#aaffaa","saisies vis\u00e9es":"#00ff00"}[a.key]}}}}).constant("PIECHART_DEFINITION",{data:[{label:"saisie",value:0},{label:"valide",value:0}],options:{chart:{type:"pieChart",
height:128,x:function(a){return a.label},y:function(a){return a.value},color:function(a,b){return{"saisies non vis\u00e9es":"#aaffaa","saisies vis\u00e9es":"#00ff00"}[a.label]},showLabels:!1,showLegend:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0}}});
angular.module("cahierDeTextesClientApp").config(["$httpProvider",function(a){a.interceptors.push(["$q",function(a){return{response:function(a){return a},responseError:function(b){401===b.status&&swal({title:"Erreur",text:"Votre session a expir\u00e9e.",type:"error",showCancelButton:!1,confirmButtonColor:"#ff6b55",confirmButtonText:"Fermer",timer:3E3});return a.reject(b)}}}])}]);
angular.module("cahierDeTextesClientApp").config(["$stateProvider","$urlRouterProvider","APP_PATH",function(a,b,d){b.otherwise("/");a.state("404",{url:"404",templateUrl:d+"/app/views/404.html"}).state("index",{url:"/",templateUrl:d+"/app/views/index.html",controller:"IndexCtrl",resolve:{auth:["Redirection",function(a){a.doorman("ADM DIR ENS DOC ELV TUT EVS".split(" "))}],current_user:["User",function(a){return a.get_user().then(function(a){return a.data})}]}}).state("emploi_du_temps",{parent:"index",
url:"emploi_du_temps",views:{content:{templateUrl:d+"/app/views/textbook.html",controller:"TextBookCtrl"}}}).state("devoirs",{parent:"index",url:"devoirs",resolve:{auth:["Redirection",function(a){a.doorman(["ELV","TUT"])}]},views:{content:{templateUrl:d+"/app/views/assignements.html",controller:"AssignementsCtrl"}}}).state("import",{parent:"index",url:"import",resolve:{auth:["Redirection",function(a){a.doorman(["DIR","ADM"])}]},views:{content:{templateUrl:d+"/app/views/import.html",controller:"ImportCtrl"}}}).state("enseignants",
{parent:"index",url:"enseignants",resolve:{auth:["Redirection",function(a){a.doorman(["DIR"])}]},views:{content:{templateUrl:d+"/app/views/dashboard_teachers.html",controller:"DashboardTeachersCtrl"}}}).state("enseignant",{parent:"index",url:"enseignants/:enseignant_id",resolve:{auth:["Redirection",function(a){a.doorman(["DIR"])}]},views:{content:{templateUrl:d+"/app/views/dashboard_teacher.html",controller:"DashboardTeacherCtrl"}}}).state("stats",{parent:"index",url:"stats",resolve:{auth:["Redirection",
function(a){a.doorman(["ENS","DOC"])}]},views:{content:{templateUrl:d+"/app/views/dashboard_teacher.html",controller:"DashboardTeacherCtrl"}}})}]).run(["$rootScope","log",function(a,b){a.$on("$stateChangeSuccess",function(a,e,c,f,g){b.add("CTXT",null,null)})}]);
angular.module("cahierDeTextesClientApp").component("displayDevoir",{bindings:{devoir:"\x3d"},template:"\x3cdiv ng:class\x3d\"{ 'type1': $ctrl.devoir.type_devoir_id \x3d\x3d\x3d 1, 'type2': $ctrl.devoir.type_devoir_id \x3d\x3d\x3d 2, 'type3': $ctrl.devoir.type_devoir_id \x3d\x3d\x3d 3, 'type4': $ctrl.devoir.type_devoir_id \x3d\x3d\x3d 4, 'type5': $ctrl.devoir.type_devoir_id \x3d\x3d\x3d 5, 'type6': $ctrl.devoir.type_devoir_id \x3d\x3d\x3d 6, 'fait': $ctrl.devoir.fait, 'a-faire': !$ctrl.devoir.fait }\"\x3e    \x3ch5\x3e\x3ci class\x3d\"picto\" ng:style\x3d\"{'background-image':'url(' + $ctrl.app_path + '/app/node_modules/laclasse-common-client/images/picto_matiere.svg)'}\"\x3e\x3c/i\x3e {{$ctrl.devoir.matiere.name}} \x3c/h5\x3e    \x3ch6\x3e\x3ci class\x3d\"picto\" ng:style\x3d\"{'background-image':'url(' + $ctrl.app_path + '/app/node_modules/laclasse-common-client/images/picto_devoir.svg)'}\"\x3e\x3c/i\x3e {{$ctrl.devoir.type_devoir.description}} : \x3c/h6\x3e    \x3cspan ng:if\x3d\"$ctrl.display_time_estimation \x26\x26 $ctrl.devoir.temps_estime \x3e 0\"\x3e\x3ci class\x3d\"picto\" ng:style\x3d\"{'background-image':'url(' + $ctrl.app_path + '/app/node_modules/laclasse-common-client/images/picto_temps.svg)'}\"\x3e\x3c/i\x3e Temps estim\u00e9 : \x3cem\x3e{{$ctrl.devoir.temps_estime * 5}} minutes\x3c/em\x3e\x3c/span\x3e    \x3cdiv class\x3d\"alert alert-default\" ng:bind-html\x3d\"$ctrl.devoir.contenu\"\x3e\x3c/div\x3e    \x3cdiv class\x3d\"row col-md-12 ressources\"\x3e      \x3cdiv class\x3d\"attached-document\" ng:repeat\x3d\"ressource in $ctrl.devoir.ressources\"\x3e        \x3ca target\x3d\"_blank\" href\x3d\"{{ressource.url}}\"\x3e{{ressource.name}}\x3c/a\x3e      \x3c/div\x3e    \x3c/div\x3e\x3c/div\x3e",controller:["$sce",
"URL_DOCS","APP_PATH","API",function(a,b,d,e){var c=this;c.$onInit=function(){c.app_path=d;c.display_time_estimation=!1;c.devoir.contenu=a.trustAsHtml(c.devoir.contenu);e.get_type_de_devoir(c.devoir.type_devoir_id).$promise.then(function(a){c.devoir.type_devoir=a});_(c.devoir.ressources).each(function(c){c.url=a.trustAsResourceUrl(b+"/api/connector?cmd\x3dfile\x26target\x3d"+c.hash)})}}]});
angular.module("cahierDeTextesClientApp").component("displaySequencePedagogique",{bindings:{sp:"\x3c"},template:'\x3ch5\x3eS\u00e9quence p\u00e9dagogique du {{$ctrl.sp.date_cours | amDateFormat:\'dddd D MMMM\'}}\x3c/h5\x3e\x3cdiv class\x3d"alert alert-default" ng:bind-html\x3d"$ctrl.sp.contenu"\x3e\x3c/div\x3e\x3cul ng:if\x3d"sp.ressources.length \x3e 0"\x3e  \x3cli ng:repeat\x3d"ressource in sp.ressources"\x3e    \x3ca target\x3d"_blank" href\x3d"{{ressource.url}}"\x3e{{ressource.name}}\x3c/a\x3e  \x3c/li\x3e\x3c/ul\x3e',controller:["$sce",
"URL_DOCS",function(a,b){var d=this;d.$onInit=function(){typeof d.sp.contenu==String&&(d.sp.contenu=a.trustAsHtml(d.sp.contenu));_(d.sp.ressources).each(function(d){d.url=a.trustAsResourceUrl(b+"/api/connector?cmd\x3dfile\x26target\x3d"+d.hash)})}}]});
angular.module("cahierDeTextesClientApp").component("switchDevoir",{bindings:{devoir:"\x3d"},template:'\x3cspan switch      class\x3d"violet"      ng:if\x3d"!($ctrl.devoir.type_devoir_id \x3d\x3d 1)"      ng:model\x3d"$ctrl.devoir.fait"      ng:change\x3d"$ctrl.fait( $ctrl.devoir )" \x3e\x3c/span\x3e',controller:["toastr",function(a){this.fait=function(b){b.$fait().then(function(b){b.fait?a.success("Devoir fait.","Bravo !"):a.info("Devoir \u00e0 faire","Encore un petit effort.")})}}]});
angular.module("cahierDeTextesClientApp").controller("AssignementsCtrl",["$scope","$sce","$timeout","toastr","$state","moment","APP_PATH","URL_DOCS","API","Annuaire","Devoirs","Cours","CreneauxEmploiDuTemps","User",function(a,b,d,e,c,f,g,k,l,h,p,q,m,y){a.affiche_faits=!1;a.tri_ascendant=!0;a.popup_ouverte=!1;a.matiere_selected=null;var n=_.memoize(function(a){return q.get({id:a})}),u=_.memoize(function(a){return m.get({id:a})});a.filter_data=function(b){_(b).isNull()?a.devoirs=a.all_devoirs:a.devoirs=
_(a.all_devoirs).select(function(a){return a.creneau_emploi_du_temps.matiere_id==b.id})};a.period_offset=0;d=Math.abs(9-(f().month()+1));a.period_offsets_list=_.range(d,-1*(10-d),-1).map(function(a){return{offset:a,label:0==a?"ce mois":f().add(-1*a,"months").fromNow()}});a.incr_offset=function(){a.period_offset++};a.decr_offset=function(){a.period_offset--};a.reset_offset=function(){a.period_offset=0};y.get_user().then(function(c){a.current_user=c.data;var d=function(){a.from_date=f().subtract(a.period_offset,
"months").subtract(2,"weeks").toDate();a.to_date=f().subtract(a.period_offset,"months").add(2,"weeks").toDate();l.query_devoirs({"date_due\x3e":a.from_date,"date_due\x3c":a.to_date,"groups_ids[]":"TUT"===a.current_user.profil_actif.type?_(a.current_user.enfant_actif.enfant.groups).pluck("group_id"):_(a.current_user.groups).pluck("group_id"),uid:"TUT"===a.current_user.profil_actif.type?a.current_user.enfant_actif.child_id:null}).$promise.then(function(c){a.matieres={};a.all_devoirs=_(c).map(function(c){c.cours=
n(c.cours_id);c.creneau_emploi_du_temps=u(c.creneau_emploi_du_temps_id);c.creneau_emploi_du_temps.$promise.then(function(){h.get_subject(c.creneau_emploi_du_temps.matiere_id).then(function(b){c.matiere=b.data;a.matieres[c.matiere.id]=c.matiere})});_(c.ressources).each(function(a){a.url=b.trustAsResourceUrl(k+"/api/connector?cmd\x3dfile\x26target\x3d"+a.hash)});return c});a.filter_data(a.matiere_selected)})};a.$watch("period_offset",function(){d()})})}]);
angular.module("cahierDeTextesClientApp").controller("DashboardTeacherCtrl",["$scope","$stateParams","$q","$locale","$timeout","moment","toastr","API","Cours","Annuaire","current_user","PIECHART_DEFINITION","MULTIBARCHART_DEFINITION",function(a,b,d,e,c,f,g,k,l,h,p,q,m){a.mois=_(e.DATETIME_FORMATS.MONTH).toArray();a.scope=a;a.moisCourant=null;a.montre_valides="DIR"!==p.profil_actif.type;a.nb_saisies_visables=0;a.current_user=p;a.enseignant_id=_(b).has("enseignant_id")?b.enseignant_id:a.current_user.id;
a.detail_regroupement=function(b){_(a.enseignant.liste_regroupements).findWhere({id:b})};a.filter_saisie=function(a,b,c){return function(d){return(a||_(d.cours.date_validation).isNull())&&(_(b).isNull()||d.mois==b)&&_.chain(c).pluck("id").contains(d.regroupement_id).value()}};a.graphiques={pieChart:angular.copy(q),multiBarChart:angular.copy(m),populate:function(b){a.graphiques.multiBarChart.data=[{key:"saisies non vis\u00e9es",values:[]},{key:"saisies vis\u00e9es",values:[]}];a.graphiques.pieChart.data=
[{label:"saisies non vis\u00e9es",value:0},{label:"saisies vis\u00e9es",value:0}];_.chain(b).groupBy("regroupement_id").each(function(b){var c=b.length,d=_(b).where({valide:!0}).length;b=b[0].group.name;a.graphiques.multiBarChart.data[0].values.push({key:b,x:b,y:c-d});a.graphiques.multiBarChart.data[1].values.push({key:b,x:b,y:d});a.graphiques.pieChart.data[0].value+=c-d;a.graphiques.pieChart.data[1].value+=d})}};a.select_all_regroupements=function(){a.selected_regroupements=a.enseignant.liste_regroupements;
a.graphiques.populate(a.raw_data)};a.select_no_regroupements=function(){a.selected_regroupements=[];a.graphiques.populate(a.raw_data)};a.valide=function(b){if("DIR"===p.profil_actif.type){var d=_(b).has("disable_toastr");b.cours.$valide().then(function(f){b.valide=!_(f.date_validation).isNull();if(!a.montre_valides&&!_(f.date_validation).isNull()){var k=f.date_validation;f.date_validation=null;c(function(){f.date_validation=k},3E3)}a.nb_saisies_visables=_(a.raw_data).select({recent:!1,valide:!1}).length;
a.graphiques.populate(a.raw_data);d||g.success("S\u00e9quence p\u00e9dagogique "+(b.valide?"":"d\u00e9-")+"vis\u00e9e.","Op\u00e9ration r\u00e9ussie")})}};a.valide_all=function(){swal({title:"Tout viser ?",text:"Cette action va viser toutes les saisies actuellement affich\u00e9es \u00e0 l'\u00e9cran.",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b55",confirmButtonText:"Confirmer",cancelButtonText:"Annuler"}).then(function(){var b=0;_.chain(a.raw_data).reject(function(a){return a.valide||
a.recent}).each(function(c){c.disable_toastr=!0;a.valide(c);b++});if(0<b){var c=1<b?"s":"";g.success(b+" s\u00e9quence"+c+" p\u00e9dagogique"+c+" vis\u00e9e"+c+".","Op\u00e9ration r\u00e9ussie")}},function(){})};h.get_user(a.enseignant_id).then(function(b){a.enseignant=b.data;a.enseignant.get_actual_groups().then(function(b){a.enseignant.liste_regroupements=_.chain(b).select(function(b){return"GPL"!==b.type&&b.structure_id===a.current_user.profil_actif.structure_id}).uniq(function(a){return a.id}).compact().value();
a.enseignant.prof_principal=_.chain(a.enseignant.groups).where({type:"PRI"}).pluck("group_id").map(function(b){return _(a.enseignant.liste_regroupements).findWhere({id:b})}).value();a.select_all_regroupements()});a.enseignant.get_actual_subjects().then(function(b){a.enseignant.liste_matieres=_.chain(b).uniq(function(a){return a.id}).compact().value()});return k.get_enseignant({enseignant_id:a.enseignant_id,uai:a.current_user.profil_actif.structure_id}).$promise}).then(function(b){var c=f().subtract(2,
"weeks");a.raw_data=_(b.saisies).map(function(b,d){b.index=d;b.cours=new l(b.cours);b.regroupement_id=parseInt(b.regroupement_id);b.month=f(b.cours.date_cours).month();b.recent=f(b.cours.date_cours).isAfter(c);b.matiere=_(a.enseignant.liste_matieres).findWhere({id:b.matiere_id});_(b.matiere).isUndefined()&&(b.matiere=h.get_subject(b.matiere_id));b.group=_(a.enseignant.liste_regroupements).findWhere({id:b.regroupement_id});_(b.group).isUndefined()&&h.get_group(b.regroupement_id).then(function(a){b.group=
a.data});return b});a.graphiques.populate(a.raw_data);a.nb_saisies_visables=_(a.raw_data).select({recent:!1,valide:!1}).length})}]);
angular.module("cahierDeTextesClientApp").controller("DashboardTeachersCtrl",["$scope","$locale","$q","API","Annuaire","current_user","PIECHART_DEFINITION",function(a,b,d,e,c,f,g){a.scope=a;a.select_all_regroupements=function(){a.selected_regroupements=a.regroupements;a.filter_data()};a.select_no_regroupements=function(){a.selected_regroupements=[];a.filter_data()};a.filter_data=function(){_(a.individualCharts.enseignants).each(function(b){b.display=!_.chain(b.enseignant.details.groups).pluck("group_id").intersection(_(a.selected_regroupements).pluck("id")).isEmpty().value()})};
a.individualCharts={enseignants:[],add:function(b){var c={enseignant:b,display:!0,pieChart:angular.copy(g)};c.pieChart.data=[{label:"saisies non vis\u00e9es",value:b.filled-b.validated},{label:"saisies vis\u00e9es",value:b.validated}];a.individualCharts.enseignants.push(c)}};c.get_groups_of_structures([f.profil_actif.structure_id]).then(function(b){a.regroupements=_(b.data).reject(function(a){return"GPL"===a.type});a.selected_regroupements=a.regroupements});e.query_enseignants({uai:f.profil_actif.structure_id}).$promise.then(function(b){a.raw_data=
b;return c.get_users(_(a.raw_data).pluck("enseignant_id"))}).then(function(b){var c=_(b.data).indexBy("id");_(a.raw_data).each(function(b){b.details=c[b.enseignant_id];var d=_(b.classes).reduce(function(a,b){b=_(b.statistiques).reduce(function(a,b){return{filled:a.filled+b.filled,validated:a.validated+b.validated}},{filled:0,validated:0});return{filled:a.filled+b.filled,validated:a.validated+b.validated}},{filled:0,validated:0});b.filled=d.filled;b.validated=d.validated;a.individualCharts.add(b)})})}]);
angular.module("cahierDeTextesClientApp").controller("FooterCtrl",["$scope","$state","$stateParams","$sce","VERSION","User",function(a,b,d,e,c,f){a.version=c;f.get_user().then(function(c){a.current_user=c.data;a.save_and_reload=function(){f.update_parameters(a.current_user.parametrage_cahier_de_textes).then(function(){b.transitionTo(b.current,d,{reload:!0,inherit:!0,notify:!0})})}})}]);
angular.module("cahierDeTextesClientApp").controller("HeaderCtrl",["$scope","$state","User","Redirection","$sce","URL_DOCS",function(a,b,d,e,c,f){a.load_docs="localhost"!==window.location.hostname;a.URL_DOCS_login=c.trustAsResourceUrl(f+"/login");a.embedded=window!=window.top;d.get_user().then(function(b){a.current_user=b.data});a.reload=function(){e.doorman([])}}]);
angular.module("cahierDeTextesClientApp").controller("ImportCtrl",["$scope","$http","$locale","$sce","$filter","fileUpload","moment","toastr","$q","APP_PATH","SEMAINES_VACANCES","ZONE","VERSION","Annuaire","Utils","Etablissements","CreneauxEmploiDuTemps","API","Matchable","current_user",function(a,b,d,e,c,f,g,k,l,h,p,q,m,y,n,u,z,A,v,B){a.scope=a;a.jours_de_la_semaine=d.DATETIME_FORMATS.DAY;a.annee=d.DATETIME_FORMATS.MONTH;a.fichier=null;a.display_all=!1;a.step=0;a.report={};a.ui={show_detailed_creneaux:!1,
display_ready:!0,display_problems:!0,sortCreneauxBy:["Jour"],sort_creneaux_by:function(b){a.ui.sortCreneauxBy=a.ui.sortCreneauxBy[0]===b[0]?_(b).map(function(a){return"-"+a}):b}};a.beautify_semainier=function(a){var b=n.padEnd(a.toString(2),53,"0");return'\x3cdiv class\x3d"semainier-tooltip gris1"\x3e'+_.chain(n.overlay_semainier()).sortBy(function(a){return a.index}).map(function(a){var c='\x3cdiv class\x3d"month blanc"\x3e\x3ch5 class\x3d"month-name gris4"\x3e'+a.label+"\x3c/h5\x3e";c+=_(a.semaines).map(function(a){var c=
'\x3cspan class\x3d"week';n.sont_ce_les_vacances(a.semaine,q)&&(c+=" vacances gris2");"1"===b[a.semaine]&&(c+=" active orange-moins");return c+='"\x3e'+a.semaine+"\x3c/span\x3e"}).join("");return c+"\x3c/div\x3e"}).value().join("")+'\x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\x3c/div\x3e'};a.filter_creneau=function(a,b){return function(c){if(!a.display_problems&&!c.ready||!a.display_ready&&c.ready)return!1;c.is_displayed=!0;_(b.classes).isEmpty()&&_(b.groupes).isEmpty()?c.is_displayed=c.is_displayed&&
!_(c).has("Classe")&&!_(c).has("Groupe"):_(b.classes).isEmpty()&&!_(b.groupes).isEmpty()?c.is_displayed=c.is_displayed&&!_(c).has("Classe")&&_(c).has("Groupe")&&_.chain(b.groupes).pluck("Ident").includes(c.Groupe.Ident).value():!_(b.classes).isEmpty()&&_(b.groupes).isEmpty()?c.is_displayed=c.is_displayed&&_(c).has("Classe")&&!_(c).has("Groupe")&&_.chain(b.classes).pluck("Ident").includes(c.Classe.Ident).value():c.is_displayed=c.is_displayed&&(_(c).has("Groupe")&&_.chain(b.groupes).pluck("Ident").includes(c.Groupe.Ident).value()||
_(c).has("Classe")&&_.chain(b.classes).pluck("Ident").includes(c.Classe.Ident).value());if(!c.is_displayed)return!1;_(b.matieres).isEmpty()?c.is_displayed=c.is_displayed&&!_(c).has("Matiere"):c.is_displayed=c.is_displayed&&_(c).has("Matiere")&&_.chain(b.matieres).pluck("Ident").includes(c.Matiere.Ident).value();return c.is_displayed?c.is_displayed:!1}};var r=function(){var b=c("filter")(a.creneaux,a.filter_creneau(a.ui,a.selected));a.counters={};a.counters.creneaux=a.creneaux.length;a.counters.creneaux_broken=
_(a.pronote.Cours[0].Cours).select(function(a){return!_(a).has("Matiere")||!_(a).has("Professeur")||!_(a).has("Classe")&&!_(a).has("Groupe")}).length;a.counters.creneaux_not_ready=_(a.creneaux).where({ready:!1}).length;a.counters.creneaux_ready=a.counters.creneaux-a.counters.creneaux_not_ready;a.counters.filtered_creneaux=b.length;a.counters.filtered_creneaux_not_ready=_(b).where({ready:!1}).length;a.counters.filtered_creneaux_ready=a.counters.filtered_creneaux-a.counters.filtered_creneaux_not_ready;
a.counters.percent_creneaux_ready=a.counters.filtered_creneaux_ready/a.counters.filtered_creneaux},C=function(){_(a.creneaux).each(function(b){b.readiness={matiere:!_(a.pronote.matieres[b.Matiere.Ident]).isUndefined()&&!_(a.pronote.matieres[b.Matiere.Ident].laclasse).isUndefined(),salle:!_(b.Salle).isUndefined(),classe:_(b).has("Classe")&&!_(a.pronote.classes[b.Classe.Ident]).isUndefined()&&!_(a.pronote.classes[b.Classe.Ident].laclasse).isUndefined(),groupe_eleve:_(b).has("Groupe")&&!_(a.pronote.groupes_eleves[b.Groupe.Ident]).isUndefined()&&
!_(a.pronote.groupes_eleves[b.Groupe.Ident].laclasse).isUndefined()};b.ready=b.readiness.matiere&&(b.readiness.classe||b.readiness.groupe_eleve)});r()},w=function(a){return window.btoa(unescape(encodeURIComponent(function(a){return _(a).has("PartieDeClass")?"regroupement":_(a).has("Code")?"matiere":"unknown"}(a)+a.displayed_label)))},x=function(b){a.pronote=!1;a.matcheable_data=[];var c=function(a){return l.reject(a)};k.info("D\u00e9chiffrage du fichier");return f.uploadFileToUrl(b,h+"/api/import/pronote/decrypt").then(function(b){a.pronote=
b.data;a.pronote.GrilleHoraire[0].DureePlace=parseInt(a.pronote.GrilleHoraire[0].DureePlace);k.info("r\u00e9cup\u00e9ration des donn\u00e9es de l'\u00e9tablissement");return u.get({uai:a.pronote.UAI}).$promise},c).then(function(b){a.etablissement_summary=b;_(a.etablissement_summary.imports).each(function(a){a.date_import=new Date(a.date_import)});return y.get_structure(a.pronote.UAI)},c).then(function(b){a.etablissement={classes:_(b.data.groups).where({type:"CLS"}),groupes_eleves:_(b.data.groups).select({type:"GRP"})};
_(a.etablissement.groupes_eleves).each(function(a){a.libelle_aaf=a.name.toUpperCase();a.displayed_label=a.name});_(a.etablissement.classes).each(function(a){a.libelle_aaf=a.name.toUpperCase();a.displayed_label=a.name});k.info("traitement des donn\u00e9es des regroupements");return A.query_statistiques_regroupements({uai:B.profil_actif.structure_id}).$promise},c).then(function(b){_(a.pronote.Classes[0].Classe).each(function(c){c.displayed_label=c.Nom;c.laclasse=_(a.etablissement.classes).findWhere({libelle_aaf:c.Nom.toUpperCase()});
if(_(c.laclasse).isUndefined()){var d=_(a.etablissement_summary.matchables).findWhere({hash_item:w(c)});_(d).isUndefined()||(c.laclasse=_(a.etablissement.classes).findWhere({id:d.id_annuaire}))}c.edit=_(c.laclasse).isUndefined();d=_(c.laclasse).isUndefined()?void 0:_(b).findWhere({regroupement_id:""+c.laclasse.id});c.existing_creneaux=_(d).isUndefined()?0:d.creneaux_emploi_du_temps.vides.length+d.creneaux_emploi_du_temps.pleins.length;c.edit||(c.laclasse.displayed_label=c.laclasse.libelle_aaf)});
_(a.pronote.Groupes[0].Groupe).each(function(c){c.displayed_label=c.Nom;c.laclasse=_(a.etablissement.groupes_eleves).findWhere({libelle_aaf:c.Nom.toUpperCase()});if(_(c.laclasse).isUndefined()){var d=_(a.etablissement_summary.matchables).findWhere({hash_item:w(c)});_(d).isUndefined()||(c.laclasse=_(a.etablissement.groupes_eleves).findWhere({id:d.id_annuaire}))}c.edit=_(c.laclasse).isUndefined();d=_(c.laclasse).isUndefined()?void 0:_(b).findWhere({regroupement_id:""+c.laclasse.id});c.existing_creneaux=
_(d).isUndefined()?0:d.creneaux_emploi_du_temps.vides.length+d.creneaux_emploi_du_temps.pleins.length;c.edit||(c.laclasse.displayed_label=c.laclasse.libelle_aaf)});k.info("traitement des donn\u00e9es des cours");a.creneaux=_.chain(a.pronote.Cours[0].Cours).map(function(b){return _.chain(b.Matiere).map(function(c){var d=function(d){return function(f){var t=angular.copy(b);t.is_displayed=!0;t.Matiere=c;"Classe"===d?(t.Classe=f,t.Classe.Semaines=n.fix_semainier_pronote(t.Classe.Semaines,a.pronote.AnneeScolaire[0].DateDebut)):
(t.Groupe=f,t.Groupe.Semaines=n.fix_semainier_pronote(t.Groupe.Semaines,a.pronote.AnneeScolaire[0].DateDebut));return _(b).has("Salle")?_(b.Salle).map(function(b){t.Salle=b;t.Salle.Semaines=n.fix_semainier_pronote(t.Salle.Semaines,a.pronote.AnneeScolaire[0].DateDebut);return t}):t}};return[_(b.Classe).map(d("Classe")),_(b.Groupe).map(d("Groupe"))]}).flatten().uniq().value()}).flatten().value();a.pronote.classes=n.groupByKey(a.pronote.Classes[0].Classe,"Ident");a.pronote.salles=n.groupByKey(a.pronote.Salles[0].Salle,
"Ident");a.pronote.plages_horaires=n.groupByKey(a.pronote.GrilleHoraire[0].PlacesParJour[0].Place,"Numero");a.pronote.groupes_eleves=n.groupByKey(a.pronote.Groupes[0].Groupe,"Ident");a.matcheable_data.push({title:"Classes",pronote:a.pronote.classes,annuaire:a.etablissement.classes});a.matcheable_data.push({title:"Groupes d'\u00e9l\u00e8ves",pronote:a.pronote.groupes_eleves,annuaire:a.etablissement.groupes_eleves});k.info("R\u00e9cup\u00e9ration des matieres");return y.query_subjects()},c).then(function(b){a.matieres=
_(b.data).map(function(a){_(a.name).isNull()&&(a.name="");a.name=a.name.toUpperCase();a.displayed_label=a.name;return a});_(a.pronote.Matieres[0].Matiere).each(function(b){b.displayed_label=b.Libelle;b.laclasse=_(a.matieres).findWhere({name:b.Libelle.toUpperCase()});if(_(b.laclasse).isUndefined()&&_(b.laclasse).isUndefined()){var c=_(a.etablissement_summary.matchables).findWhere({hash_item:w(b)});_(c).isUndefined()||(b.laclasse=_(a.matieres).findWhere({id:c.id_annuaire}))}b.edit=_(b.laclasse).isUndefined();
b.edit||(b.laclasse.displayed_label=b.laclasse.name)});a.pronote.matieres=n.groupByKey(a.pronote.Matieres[0].Matiere,"Ident");a.matcheable_data.push({title:"Mati\u00e8res",pronote:a.pronote.matieres,annuaire:a.matieres});_(a.matcheable_data).each(function(a){a.total=function(){return _(a.pronote).size()};a.unmatched=function(){return _(a.pronote).where({laclasse:void 0}).length};a.percent_valid=function(){return(a.total()-a.unmatched())/a.total()}});a.selected={matieres:a.pronote.Matieres[0].Matiere,
classes:_(a.pronote.Classes[0].Classe).where({existing_creneaux:0}),groupes:_(a.pronote.Groupes[0].Groupe).where({existing_creneaux:0})};C();a.$watchCollection("selected",function(){r()})},c).then(function(b){a.step++;return l.resolve(!0)},c)},I=function(){g();var c=null,d=function(a){return l.reject(a)};a.report={};var f=_(a.creneaux).select(function(a){return a.ready&&a.is_displayed});return b.post(h+"/api/import/log/start/?uai\x3d"+a.pronote.UAI,{uai:a.pronote.UAI,type:"client "+m,comment:""}).then(function(b){c=
b.data.id;return(new u({uai:a.pronote.UAI,date_premier_jour_premiere_semaine:new Date(a.pronote.AnneeScolaire[0].DatePremierJourSemaine1),debut_annee_scolaire:new Date(a.pronote.AnneeScolaire[0].DateDebut),fin_annee_scolaire:new Date(a.pronote.AnneeScolaire[0].DateFin)})).$save()},d).then(function(c){a.report.etablissement=c;c=function(b){return _.chain(b).reject(function(a){return _(a.laclasse).isUndefined()}).map(function(b){return{label:b.laclasse.libelle_aaf,regroupement_id:b.laclasse.id,debut_annee_scolaire:new Date(a.pronote.AnneeScolaire[0].DateDebut),
fin_annee_scolaire:new Date(a.pronote.AnneeScolaire[0].DateFin)}}).value()};var d=c(a.pronote.classes);d.push(c(a.pronote.groupes_eleves));d=_(d).flatten();return b.post(h+"/api/cahiers_de_textes/bulk",{cahiers_de_textes:d})},d).then(function(c){a.report.cahiers_de_textes=c.data;k.info("Cr\u00e9ation des salles");c=_(a.pronote.salles).map(function(b){return{uai:a.pronote.UAI,identifiant:b.Ident,nom:b.Nom}});return b.post(h+"/api/salles/bulk",{salles:c})},d).then(function(d){a.report.salles=d.data;
d=f.map(function(b){var d=n.libelleHeure_to_Moment(a.pronote.plages_horaires[b.NumeroPlaceDebut].LibelleHeureDebut);d={import_id:c,jour_de_la_semaine:parseInt(b.Jour),heure_debut:d.toISOString(),heure_fin:d.add(parseInt(b.NombrePlaces)*parseInt(a.pronote.GrilleHoraire[0].DureePlace),"minutes").toISOString(),matiere_id:a.pronote.matieres[b.Matiere.Ident].laclasse.id};_(b).has("Salle")&&(d.salle_id=_(a.report.salles).find({identifiant:b.Salle.Ident}).id,d.semainier_salle=parseInt(b.Salle.Semaines));
_(b).has("Classe")?(d.regroupement_id=a.pronote.classes[b.Classe.Ident].laclasse.id,d.semainier_regroupement=parseInt(b.Classe.Semaines)):(d.regroupement_id=a.pronote.groupes_eleves[b.Groupe.Ident].laclasse.id,d.semainier_regroupement=parseInt(b.Groupe.Semaines));return d});k.info("Import de "+d.length+" cr\u00e9neaux");for(var g=[];0<d.length;)g.push(b.post(h+"/api/creneaux_emploi_du_temps/bulk/",{uai:a.pronote.UAI,creneaux_emploi_du_temps:d.splice(0,500)}));return l.all(g)},d).then(function(b){a.report.creneaux=
_.chain(b).pluck("data").flatten().value();return l.resolve(a.report)},d)};a.match_this=function(a,b){var c=_(a.laclasse).has("ent_id")?a.laclasse.ent_id:a.laclasse.id;(new v({uai:b,hash_item:w(a),id_annuaire:c})).$save().then(function(){C()})};a.unmatch_this=function(a,b){v.$delete({uai:b,hash_item:w(a)}).then(function(){a.laclasse=null;C()})};a.process_load=function(a){swal({title:"Chargement des donn\u00e9es...",text:"traitement en cours",type:"info",showLoaderOnConfirm:!0,onOpen:function(){swal.clickConfirm()},
preConfirm:function(){return new Promise(function(b){x(a).then(function(a){swal.closeModal()},function(a){console.log(a);swal.closeModal();swal({title:"Erreur :(",text:a.data.error,type:"error"})})})},allowOutsideClick:!1})};a.validate_matches=function(){a.step++};a.process_import=function(){swal({title:"Import des donn\u00e9es...",text:"traitement en cours",type:"info",showLoaderOnConfirm:!0,allowOutsideClick:!1,onOpen:function(){swal.clickConfirm()},preConfirm:function(){return new Promise(function(b){I().then(function(b){swal.closeModal();
a.step=0;swal({title:"Import termin\u00e9",html:"",type:"success"})},function(a){console.log(a);swal.closeModal();swal({title:"Erreur :(",text:a.data.error,type:"error"})})})}})}}]);
angular.module("cahierDeTextesClientApp").controller("IndexCtrl",["$scope","$state","User",function(a,b,d){d.get_user().then(function(d){switch(d.data.profil_actif.type){case "DIR":a.tabs=[{heading:"Validation des saisies par enseignant",uisref:"enseignants",css_class:"glyphicon glyphicon-user",active:!0},{heading:"Emplois du Temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!1},{heading:"Import Pronote",uisref:"import",css_class:"glyphicon glyphicon-import",active:!1}];
break;case "ENS":a.tabs=[{heading:"Cahier de textes",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0},{heading:"Statistiques",uisref:"stats",css_class:"glyphicon glyphicon-stats",active:!1}];break;case "TUT":case "ELV":a.tabs=[{heading:"Emploi du temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0},{heading:"Liste des devoirs",uisref:"devoirs",css_class:"glyphicon glyphicon-list",active:!1}];break;case "ADM":a.tabs=[{heading:"Emplois du Temps",
uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0},{heading:"Import Pronote",uisref:"import",css_class:"glyphicon glyphicon-import",active:!1}];break;case "EVS":a.tabs=[{heading:"Emplois du Temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0}];break;default:a.tabs=[]}_(a.tabs).each(function(a){a.active=a.uisref==b.current.name});a.set_active_tab=function(b){_(a.tabs).each(function(a){a.active=a.uisref==b})};a.set_active_tab(a.tabs[0].uisref);
b.go(a.tabs[0].uisref)})}]);
angular.module("cahierDeTextesClientApp").controller("PopupDisplayCtrl",["$scope","$sce","$uibModalInstance","toastr","APP_PATH","Cours","Devoirs","User","titre","cours","devoirs",function(a,b,d,e,c,f,g,k,l,h,p){a.app_path=c;a.matiere=l;a.date=null;_(h).isNull()||(a.cours=new f(h),a.date=a.cours.date_cours,_(h.devoirs).each(function(a){a.tooltip=a.contenu;0<a.temps_estime&&(a.tooltip='\x3cspan\x3e\x3ci class\x3d"picto temps"\x3e\x3c/i\x3e'+5*a.temps_estime+" minutes\x3c/span\x3e\x3chr\x3e"+a.tooltip);
a.tooltip=b.trustAsHtml(a.tooltip)}));a.devoirs=p.map(function(a){a.matiere=l;return new g(a)});_(a.date).isNull()&&!_(a.devoirs).isEmpty()&&(a.date=a.devoirs[0].date_due);a.fermer=function(){d.close(a)};k.get_user().then(function(b){a.current_user=b.data})}]);
angular.module("cahierDeTextesClientApp").controller("PopupEditionCtrl",["$scope","$filter","$q","$sce","$uibModalInstance","$locale","toastr","moment","APP_PATH","URL_DOCS","SEMAINES_VACANCES","ZONE","POPUP_ACTIONS","LOCALHOST","Documents","API","CreneauxEmploiDuTemps","Cours","Devoirs","User","Utils","cours","devoirs","creneau","raw_data","classes","matieres",function(a,b,d,e,c,f,g,k,l,h,p,q,m,y,n,u,z,A,v,B,r,C,w,x,I,J,K){a.scope=a;a.correctTimeZoneToGMT=function(a){var b=(new Date(a)).getTimezoneOffset()/
60;a.setHours(a.getHours()+b);return a};a.app_path=l;a.ZONE=q;a.jours=_(f.DATETIME_FORMATS.DAY).indexBy(function(a){return _(f.DATETIME_FORMATS.DAY).indexOf(a)});a.classes=J;a.matieres=_(K).sortBy("name");a.faulty_docs_app=!1;a.erreurs=[];a.dirty=!1;a.mode_duplication=!1;a.actions_done=[];a.creneau=x;a.creneau.jour_de_la_semaine=""+a.creneau.jour_de_la_semaine;a.mode_edition_creneau=a.creneau.en_creation;a.creneau.regroupement_id=parseInt(a.creneau.regroupement_id);a.creneau.previous_regroupement_id=
a.creneau.regroupement_id;a.creneau.vierge=_(x.vierge).isUndefined();a.selected_regroupement=_(a.creneau.regroupement_id).isUndefined()?_(a.classes).first():_(a.classes).findWhere({id:parseInt(a.creneau.regroupement_id)});a.selected_matiere=_(a.creneau.matiere_id).isEmpty()?_(a.matieres).first():_(a.matieres).findWhere({id:a.creneau.matiere_id});a.creneau.en_creation?(a.creneau.tmp_heure_debut=a.correctTimeZoneToGMT(a.creneau.heure_debut),a.creneau.tmp_heure_fin=a.correctTimeZoneToGMT(a.creneau.heure_fin)):
(a.creneau.tmp_heure_debut=angular.copy(a.creneau.heure_debut),a.creneau.tmp_heure_fin=angular.copy(a.creneau.heure_fin),_(a.creneau.regroupements).each(function(a){a.regroupement_id=parseInt(a.regroupement_id)}));a.creneau.tmp_heure_debut=k(a.creneau.tmp_heure_debut);a.creneau.tmp_heure_fin=k(a.creneau.tmp_heure_fin);a.creneau.n_week=k(a.creneau.tmp_heure_debut).week();var F=function(){};a.formateCreneau=function(a){var c="";return c=_(a).has("start")?c+(b("amDateFormat")(a.start,"ddd DD MMM HH:mm")+
" - "+b("amDateFormat")(a.end,"HH:mm")):c+(b("amDateFormat")(a.heure_debut,"ddd DD MMM HH:mm")+" - "+b("amDateFormat")(a.heure_fin,"HH:mm"))};a.correctTimeZone=function(a){a=new Date(a);var b=a.getTimezoneOffset()/60;a.setHours(a.getHours()-b);return a};a.is_dirty=function(b){b=_(b).isUndefined()||_(b).isNull()?null:b;a.dirty=a.dirty||_(b).isNull()||!_(b).isNull()&&0<b.contenu.length;_(b).isNull()||(b.dirty=!0)};a.overlay_semainier=r.overlay_semainier();a.sont_ce_les_vacances=r.sont_ce_les_vacances;
var G=function(){var a=[];_(52).times(function(b){r.sont_ce_les_vacances(b+1,q)?a.push(0):a.push(1)});return a};a.semaines_actives={regroupement:[]};a.templates_semainier=[{label:"Tout",apply:function(){a.semaines_actives.regroupement=G()}},{label:"Semaine A",apply:function(){var b=[],c=0;_(52).times(function(a){r.sont_ce_les_vacances(a+1,q)?c=0:c++;b.push(1==c%2?1:0)});a.semaines_actives.regroupement=b}},{label:"Semaine B",apply:function(){var b=[],c=0;_(52).times(function(a){r.sont_ce_les_vacances(a+
1,q)?c=0:c++;b.push(0==c%2?1:0)});a.semaines_actives.regroupement=b}},{label:"Unique",apply:function(){var b=[];_(52).times(function(c){b.push(c+1==a.creneau.n_week?1:0)});a.semaines_actives.regroupement=b}},{label:"Inverser",apply:function(){a.semaines_actives.regroupement=_(a.semaines_actives.regroupement).map(function(a,b){return 0!=a||r.sont_ce_les_vacances(b+1,q)?0:1})}},{label:"R\u00e9initialiser",apply:function(){a.semaines_actives.regroupement=a.creneau.en_creation?G():r.fixnum_to_bitfield(x.semainier)}}];
_(a.templates_semainier).findWhere({label:"R\u00e9initialiser"}).apply();a.fermer=function(){c.close(a)};a.effacer_creneau=function(){var c=function(){z.delete({id:a.creneau.id,date_creneau:a.creneau.heure_debut}).$promise.then(function(){a.actions_done.push(m.CRENEAU_DELETED);a.fermer()})};a.dirty?swal({title:"Ceci supprimera le cr\u00e9neau \u00e0 compter du "+b("amDateFormat")(x.heure_debut,"dddd D MMMM YYYY"),text:"Le cr\u00e9neau avec ses s\u00e9quences p\u00e9dagogiques et devoirs associ\u00e9s restera visible pour les dates ant\u00e9rieures.",
type:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b55",confirmButtonText:"Confirmer",cancelButtonText:"Annuler"}).then(c,F):c()};a.annuler=function(){var b=function(){a.creneau.en_creation?a.effacer_creneau():(a.dirty=!1,0==a.actions_done.length&&a.actions_done.push(m.CANCELLED),a.fermer())};a.dirty?swal({title:"\u00cates-vous sur ?",text:"Les modifications que vous avez faites dans cette fen\u00eatre seront perdues.",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b55",confirmButtonText:"Confirmer",
cancelButtonText:"Annuler"}).then(b,F):b()};a.valider=function(){a.erreurs=[];var b=[];if(a.mode_edition_creneau){a.creneau.matiere_id=a.selected_matiere.id;a.creneau.regroupement_id=a.selected_regroupement.id;if(a.creneau.tmp_heure_debut>a.creneau.tmp_heure_fin){var c=a.creneau.tmp_heure_debut;a.creneau.tmp_heure_debut=a.creneau.tmp_heure_fin;a.creneau.tmp_heure_fin=c}a.creneau.heure_debut=a.correctTimeZone(a.creneau.tmp_heure_debut);a.creneau.heure_fin=a.correctTimeZone(a.creneau.tmp_heure_fin);
a.creneau.semainier_regroupement=r.bitfield_to_fixnum(a.semaines_actives.regroupement);a.creneau.$update();a.actions_done.push(m.CRENEAU_MODIFIED)}else{var f=function(c,f){_.chain(c).where({dirty:!0}).each(function(c){var g=d.defer(),e=function(b){a.erreurs.unshift({status:b.status,message:b.data.error});g.reject(b)},H=function(b){return function(d){c.id=d.id;g.resolve(d);a.actions_done.push(b)}};c.create?(c.regroupement_id=a.selected_regroupement.id,_(f).isNull()||(c.cours_id=f.id),_(c).has("contenu")||
(c.contenu=""),c.$save().then(H(m.DEVOIR_CREATED),e)):c.$update().then(H(m.DEVOIR_MODIFIED),e);b.push(g.promise)})};if(0<a.cours.contenu.length||_(a.cours).has("ressources")&&0<a.cours.ressources.length||0<a.cours.devoirs.length){var g=_(a.cours.devoirs).map(function(a){return new v(a)});a.cours.editable?(c=d.when(!0),a.cours.create?(a.cours.regroupement_id=a.selected_regroupement.id,a.cours.creneau_emploi_du_temps_id=a.creneau.id,c=a.cours.$save(),a.actions_done.push(m.SEQUENCE_PEDAGOGIQUE_CREATED)):
(c=a.cours.$update(),a.actions_done.push(m.SEQUENCE_PEDAGOGIQUE_MODIFIED)),0<g.length&&c.then(function(a){f(g,a)})):f(g,a.cours)}f(a.devoirs,null)}d.all(b).then(a.fermer)};if(!a.creneau.en_creation){a.estimation_over=function(a,b){a.overValue=b;a.minutes=5*b};a.estimation_leave=function(b){a.estimation_over(b,b.temps_estime)};a.types_de_devoir=u.query_types_de_devoir();var D=function(c){a.cours=A.get({id:c.id});a.cours.$promise.then(function(c){a.cours.editable=_(a.cours.date_validation).isNull()&&
_(["ENS","DOC"]).includes(a.current_user.profil_actif.type)&&a.cours.enseignant_id===a.current_user.id;a.cours.editable||(a.cours.contenu=e.trustAsHtml(a.cours.contenu));c.devoirs=_.chain(c.devoirs).select(function(a){return _.chain(w).findWhere({id:a.id}).isUndefined().value()}).map(function(a){return v.get({id:a.id})}).value();_(c.devoirs).each(function(c){c.$promise.then(function(c){a.estimation_leave(c);c.tooltip="\x3cem\x3e"+b("amDateFormat")(c.date_due,"dddd D MMMM YYYY")+"\x3c/em\x3e\x3chr /\x3e"+
c.contenu;0<c.temps_estime&&(c.tooltip='\x3cspan\x3e\x3ci class\x3d"picto temps"\x3e\x3c/i\x3e'+5*c.temps_estime+" minutes\x3c/span\x3e\x3chr /\x3e"+c.tooltip);c.tooltip=e.trustAsHtml("\x3cdiv\x3e"+c.tooltip+"\x3c/div\x3e");a.creneau.etranger&&(c.contenu=e.trustAsHtml(c.contenu))})});d.all(a.devoirs).then(function(){a.cours.devoirs=_(a.cours.devoirs).filter(function(b){return _.chain(a.devoirs).findWhere({id:b.id}).isUndefined().value()})});a.cours.$promise.then(function(){_(a.cours.ressources).each(function(a){a.url=
e.trustAsResourceUrl(h+"/api/connector?cmd\x3dfile\x26target\x3d"+a.hash)})});_(a.cours.devoirs).each(function(a){a.$promise.then(function(){_(a.ressources).each(function(a){a.url=e.trustAsResourceUrl(h+"/api/connector?cmd\x3dfile\x26target\x3d"+a.hash)})})})});a.cours.create=!1};a.devoirs=w.map(function(a){return v.get({id:a.id})});_(a.devoirs).each(function(b){b.$promise.then(function(){a.estimation_leave(b);_(b.ressources).each(function(a){a.url=e.trustAsResourceUrl(h+"/api/connector?cmd\x3dfile\x26target\x3d"+
a.hash)});a.creneau.etranger&&(b.contenu=e.trustAsHtml(b.contenu))})});a.set_creneau_date_due=function(b){var c=_(a.creneaux_devoirs_possibles).findWhere({date_due:b.date_due});b.creneau_emploi_du_temps_id=c.id;a.is_dirty(b)};var E=function(a,b,c){return u.get_creneaux_emploi_du_temps_similaires({id:a.id,debut:k(a.heure_debut.toISOString()).subtract(b,"weeks").toDate(),fin:k(a.heure_debut.toISOString()).add(c,"weeks").toDate()})};E(a.creneau,2,8).then(function(b){a.creneaux_devoirs_possibles_duplication=
[];a.creneaux_similaires=_.chain(b.data).reject(function(a){return _(a.regroupement_id).isUndefined()||a.has_cours}).map(function(b){b.classe=_(a.classes).findWhere({id:parseInt(b.regroupement_id)});b.heure_debut=new Date(b.heure_debut);b.heure_fin=new Date(b.heure_fin);return b}).value();a.creneaux_similaires.selected=[]});E(a.creneau,0,8).then(function(c){_(c.data).isEmpty()&&(c.data=[a.creneau]);a.creneaux_devoirs_possibles=_.chain(c.data).select(function(b){return b.regroupement_id===a.creneau.regroupement_id}).map(function(c){c.classe=
_(a.classes).findWhere({id:parseInt(c.regroupement_id)});c.semaine=k(c.start).from(k(a.creneau.heure_debut));c.heure_debut=new Date(c.heure_debut);c.heure_fin=new Date(c.heure_fin);c.date_due=b("date")(c.heure_debut,"y-MM-dd");return c}).sortBy(function(a){return a.start}).value();1<a.creneaux_devoirs_possibles.length&&(a.creneaux_devoirs_possibles=_(a.creneaux_devoirs_possibles).select(function(b){return b.heure_debut.toISOString()!=a.creneau.heure_debut.toISOString()}))});a.cartable={};a.cartable.expandedNodes=
[];a.treeOptions={dirSelectable:!1};n.list_files().then(function(b){_(b.data).has("files")&&(a.cartable=b.data,a.cartable.files=_(b.data.files).select(function(a){return _(a.phash).isNull()}),a.cartable.expandedNodes=[])},function(){});a.consume_Documents_response_callback=function(b){return function(c){a.erreurs=[];if(_(c.error).isEmpty()){var d=_(c.added).first();b.ressources.push({name:d.name,hash:d.hash,url:e.trustAsResourceUrl(h+"/api/connector?cmd\x3dfile\x26target\x3d"+d.hash)});a.is_dirty(b);
_(c.removed).isEmpty()||(b.ressources=_(b.ressources).reject(function(a){return _(c.removed).includes(a.hash)}))}else a.erreurs.push({message:c.error})}};a.upload_and_add_ressource=function(b,c){void 0==b.ressources&&(b.ressources=[]);n.upload_dans_cahier_de_textes(a.selected_regroupement,c).then(function(c){c.forEach(function(c){a.consume_Documents_response_callback(b)(c.data)})})};a.remove_ressource=function(b,c){b.ressources=_(b.ressources).reject(function(a){return a.hash==c});a.is_dirty(b)};
a.effacer_cours=function(){a.cours.$delete().then(function(){a.actions_done.push(m.SEQUENCE_PEDAGOGIQUE_DELETED);D(a.cours)})};a.effacer_devoir=function(b){_(b).has("id")?b.$delete().then(function(){a.actions_done.push(m.DEVOIR_DELETED)}):b.deleted=!0};a.ajout_devoir=function(c,d){_(d).isNull()||_(d).isUndefined()||1>a.creneaux_devoirs_possibles.length?d=a.creneau:"next"===d&&(d=1<a.creneaux_devoirs_possibles.length?_.chain(a.creneaux_devoirs_possibles).select(function(b){return b.heure_debut>a.creneau.heure_debut}).head().value():
_(a.creneaux_devoirs_possibles).first());d=new v({cours_id:a.cours.id,date_due:b("date")(d.heure_debut,"yyyy-MM-dd"),type_devoir_id:_(a.types_de_devoir).last().id,creneau_emploi_du_temps_id:d.id,contenu:""});d.create=!0;d.dirty=!0;c.unshift(d)};a.switch_to_duplication_mode=function(){a.mode_duplication=!0};a.ok_go_for_duplication=!1;a.are_we_go_for_duplication=function(){a.ok_go_for_duplication=!_(a.creneaux_similaires.selected).isEmpty()&&_(a.cours.devoirs).reduce(function(a,b){return a&&_(b).has("creneau_cible")},
!0)};a.creneau_cible_duplication_SP_updated=function(){E(a.creneaux_similaires.selected,0,4).then(function(c){a.creneaux_devoirs_possibles_duplication=_.chain(c.data).select(function(b){return b.regroupement_id==a.creneaux_similaires.selected.regroupement_id}).map(function(c){c.classe=_(a.classes).findWhere({id:parseInt(c.regroupement_id)});c.date_due=b("date")(c.start,"y-MM-dd");c.semaine=k(c.start).from(k(a.creneau.heure_debut),!0)+" plus tard";c.heure_debut=new Date(c.heure_debut);c.heure_fin=
new Date(c.heure_fin);return c}).value()});a.are_we_go_for_duplication()};a.dupliquer=function(){var b=angular.copy(a.cours.devoirs);a.cours.$copie({regroupement_id:a.creneaux_similaires.selected.regroupement_id,creneau_emploi_du_temps_id:a.creneaux_similaires.selected.creneau_emploi_du_temps_id,date:a.creneaux_similaires.selected.start}).then(function(){a.actions_done.push(m.SEQUENCE_PEDAGOGIQUE_DUPLICATED);g.success("","S\u00e9quence p\u00e9dagogique copi\u00e9e.");_(b).each(function(b){b.$copie({cours_id:a.cours.copie_id,
creneau_emploi_du_temps_id:b.creneau_cible.id,date_due:b.creneau_cible.date_due}).then(function(){a.actions_done.push(m.DEVOIR_DUPLICATED);g.success("","Devoir copi\u00e9.");b.creneau_cible=[]})});a.creneaux_similaires=_(a.creneaux_similaires).reject(function(b){return b.id+b.start==a.creneaux_similaires.selected.id+a.creneaux_similaires.selected.start});a.creneaux_similaires.selected=[];D(a.cours);swal({title:"Cr\u00e9neau copi\u00e9 !",type:"success",timer:2E3,showCancelButton:!1,confirmButtonColor:"#ff6b55",
confirmButtonText:"Fermer"})})};a.switch_to_modification_mode=function(){a.mode_edition_creneau=!1;a.mode_duplication=!1};a.switch_to_creneau_edition=function(){a.dirty=!0;a.erreurs=[];a.mode_edition_creneau=!0}}B.get_user().then(function(b){a.current_user=b.data;a.current_user.parametrage_cahier_de_textes.affichage_week_ends||(delete a.jours[0],delete a.jours[6]);a.creneau.mine=a.creneau.en_creation||_.chain(a.current_user.profil_actif.matieres).pluck("id").include(a.creneau.matiere_id).value();
a.creneau.can_add_homework=_(["ENS","DOC"]).includes(a.current_user.profil_actif.type)&&_.chain(a.current_user.profil_actif.matieres).pluck("id").include(a.creneau.matiere_id).value();a.creneau.etranger=!a.current_user.profil_actif.admin&&!a.creneau.en_creation&&!a.creneau.mine;_(C).isNull()?a.creneau.etranger||(b=new A({creneau_emploi_du_temps_id:x.id,date_cours:(new Date(x.heure_debut)).toISOString(),date_validation:null,enseignant_id:a.current_user.id,contenu:""}),b.devoirs=[],b.create=!0,a.cours=
b,a.cours.editable=!0):D(C)})}]);
angular.module("cahierDeTextesClientApp").controller("TextBookCtrl",["$scope","moment","$state","$q","$locale","APP_PATH","SEMAINES_VACANCES","ZONE","EmploisDuTemps","PopupsCreneau","CreneauxEmploiDuTemps","Utils","Annuaire","User","current_user",function(a,b,d,e,c,f,g,k,l,h,p,q,m,y,n){a.scope=a;a.current_user=n;"TUT"===a.current_user.profil_actif.type&&_(a.current_user.enfant_actif).isUndefined()&&(a.current_user.enfant_actif=a.current_user.enfants[0]);a.zone=k;a.emploi_du_temps=angular.element("#emploi_du_temps");
a.uniquement_mes_creneaux=!_(["EVS","DIR","ADM"]).contains(a.current_user.profil_actif.type);var u=function(b){a.current_user.parametrage_cahier_de_textes.preferredView=b;y.update_parameters(a.current_user.parametrage_cahier_de_textes)};_(a.current_user.parametrage_cahier_de_textes).has("preferredView")||u("timetableWeek");a.filter_data=function(b){return _(["EVS","DIR","ADM"]).contains(a.current_user.profil_actif.type)?B(b,a.selected_regroupements):_(["ENS","DOC"]).contains(a.current_user.profil_actif.type)?
r(B(b,a.selected_regroupements),a.current_user.extract_subjects_ids(),a.uniquement_mes_creneaux):b};a.prev=function(){a.emploi_du_temps.fullCalendar("prev")};a.next=function(){a.emploi_du_temps.fullCalendar("next")};a.select_all_regroupements=function(){a.selected_regroupements=a.current_user.actual_groups;a.refresh_calendar()};a.select_no_regroupements=function(){a.selected_regroupements=[];a.refresh_calendar()};var z=function(b){b=a.emploi_du_temps.fullCalendar("getView");v(b.start.toDate(),b.end.toDate())},
A=function(c){var d=function(c){var d=this;d.details=c;d.allDay=!1;d.regroupement=_(a.current_period_groups).findWhere({id:parseInt(d.details.regroupement_id)});d.title=_(d.regroupement).isUndefined()?"":d.regroupement.name;d.matiere=_(a.subjects).findWhere({id:d.details.matiere_id});d.has_resources=_(c.cours).has("ressources")&&0<c.cours.ressources.length;d.temps_estime=0;d.start=b(c.start);d.end=b(c.end);d.className="saisie-vide";_(d.matiere).isUndefined()||(d.title+=" - "+d.matiere.name);_(c.cours).isNull()||
_(c.cours.devoirs).each(function(a){d.has_ressources=d.has_ressources||_(a).has("ressources")&&0<a.ressources.length});_(c.devoirs).each(function(a){d.has_ressources=d.has_ressources||_(a).has("ressources")&&0<a.ressources.length;_(a.temps_estime).isNull()||(d.temps_estime+=a.temps_estime,15<d.temps_estime&&(d.temps_estime=15))});if(0<c.devoirs.length)switch(_.chain(c.devoirs).pluck("type_devoir_id").sort().first().value()){case 1:d.className="edt-devoir-note-surveille";break;case 2:d.className="edt-devoir-note-maison";
break;default:"ELV"===a.current_user.profil_actif.type&&(d.className=_.chain(c.devoirs).pluck("fait").contains(!0).value()?"edt-devoir-fait":"edt-devoir-a-faire")}else(d.className="edt-cours",_(c.cours).isNull()||_(c.cours.date_validation).isNull()||"ENS"!==a.current_user.profil_actif.type||"DOC"!==a.current_user.profil_actif.type)?_(c.cours).isNull()||(d.className+="-saisie"):d.className+="-valide";_(["ELV","TUT","EVS","DIR","ADM"]).contains(a.current_user.profil_actif.type)&&_(c.cours).isNull()&&
_(c.devoirs).isEmpty()?d.className+=" unclickable-event":d.className+=" clickable-event"};return _(c).map(function(a){return new d(a)})};a.refresh_calendar=function(){a.calendar.events[0]=A(a.filter_data(a.raw_data))};var v=function(b,c){("TUT"!=a.current_user.profil_actif.type||a.current_user.enfant_actif)&&l.query({debut:b,fin:c,uai:a.current_user.profil_actif.structure_id,uid:"TUT"===a.current_user.profil_actif.type?a.current_user.enfant_actif.child_id:null}).$promise.then(function(b){a.raw_data=
b;b=_.chain(a.raw_data).pluck("regroupement_id").uniq().value();var c=_.chain(a.raw_data).pluck("matiere_id").uniq().value();(_(b).isEmpty()?e.resolve([]):m.get_groups(b)).then(function(b){a.current_period_groups=b.data;return m.get_subjects(c)}).then(function(b){a.subjects=b.data;a.refresh_calendar()})})};a.current_user.get_actual_groups().then(function(b){a.selected_regroupements=a.uniquement_mes_creneaux?a.current_user.actual_groups:[a.current_user.actual_groups[0]]});a.extraEventSignature=function(a){return""+
a.matiere};var B=function(a,b){return _(a).filter(function(a){return _.chain(b).pluck("id").contains(parseInt(a.regroupement_id)).value()})},r=function(a,b,c){return c?_(a).filter(function(a){return _(b).contains(a.matiere_id)}):a};"TUT"===a.current_user.profil_actif.type&&(0==a.current_user.enfants.length?swal({title:"Erreur",text:"Aucun enfant configur\u00e9 pour ce profil.",type:"error",showCancelButton:!1,confirmButtonColor:"#ff6b55",confirmButtonText:"Fermer"}):(a.uid_enfant_actif=a.current_user.enfant_actif.child_id,
a.reload_data=z));d=_(["ENS","DOC","DIR","ADM"]).contains(a.current_user.profil_actif.type)||a.current_user.profil_actif.admin;a.calendar={options:{lang:"fr",locale:"fr",height:600,header:{left:_(["ENS","DOC"]).contains(a.current_user.profil_actif.type)?"timetableWeek,textbookWeek":"",center:"title",right:"today prev,next"},firstDay:1,minTime:"07:00:00",maxTime:"19:00:00",businessHours:{start:"7:00",end:"19:00",dow:[1,2,3,4,5]},titleFormat:"D MMM YYYY, [semaine] W",columnFormat:"dddd D",slotDuration:"00:30:00",
slotEventOverlap:!1,ignoreTimezone:!1,slotLabelFormat:c.DATETIME_FORMATS.shortTime,allDaySlot:!1,theme:!1,defaultView:a.current_user.parametrage_cahier_de_textes.preferredView,editable:d,eventDurationEditable:d,eventStartEditable:d,selectable:d,selectHelper:!0,weekends:a.current_user.parametrage_cahier_de_textes.affichage_week_ends,views:{timetableWeek:{type:"agenda",duration:{weeks:1},buttonText:"Emploi du temps",displayEventTime:!1},textbookWeek:{type:"list",duration:{weeks:1},buttonText:"Liste"}},
viewRender:function(b,c){a.current_user.date=b.start;a.c_est_les_vacances=q.sont_ce_les_vacances(b.start.week(),a.zone);b.name!==a.current_user.parametrage_cahier_de_textes.preferredView&&u(b.name);v(b.start.toDate(),b.end.toDate())},eventRender:function(b,c,d){d=c.find(".fc-content");if(!_(["ELV","TUT"]).contains(a.current_user.profil_actif.type)&&0<b.temps_estime){var f="";4>b.temps_estime?f=" label-success":8>b.temps_estime?f=" label-info":12>b.temps_estime?f=" label-warning":15>=b.temps_estime&&
(f=" label-danger");d.prepend('\x3cdiv class\x3d"est-time est-time-'+b.temps_estime+f+'"\x3e\x3c/div\x3e')}b.has_resources&&d.prepend('\x3ci class\x3d"glyphicon glyphicon-paperclip"\x3e\x3c/i\x3e');c=c.find(".fc-list-item-title");if(0<c.length&&(!_(b.details.cours).isNull()||!_(b.details.devoirs).isEmpty())){var g=c.html();g+="\x3cbr\x3e";g+='\x3cdiv class\x3d"col-md-6 sequence-pedagogique"\x3e';_(b.details.cours).isNull()||(g+="\x3cfieldset\x3e",g+="\x3clegend\x3eS\u00e9quence p\u00e9dagogique\x3c/legend\x3e",
g+=b.details.cours.contenu,g+="\x3c/fieldset\x3e");g+="\x3c/div\x3e";_(b.details.devoirs).isEmpty()||(g+="\x3cfieldset\x3e\x3clegend\x3eDevoirs\x3c/legend\x3e",g+='\x3cul class\x3d"col-md-6 devoirs"\x3e',_(b.details.devoirs).each(function(b){g+='  \x3cli class\x3d"devoir type'+b.type_devoir_id+" "+("ELV"===a.current_user.profil_actif.type?b.fait?"fait":"a-faire":"")+'"\x3e';a.current_user.parametrage_cahier_de_textes.affichage_types_de_devoir&&(g+='    \x3cspan class\x3d"type"\x3e'+b.type_devoir_description+
"\x3c/span\x3e");0<b.temps_estime&&(g+='    \x3cspan class\x3d"temps-estime"\x3e'+5*b.temps_estime+" minutes\x3c/span\x3e");g+=b.contenu;g+="  \x3c/li\x3e"}),g+="\x3c/ul\x3e",g+="\x3c/fieldset\x3e");c.html(g)}},eventClick:function(b){_(["ENS","DOC"]).contains(a.current_user.profil_actif.type)||a.current_user.profil_actif.admin?p.get({id:b.details.creneau_emploi_du_temps_id}).$promise.then(function(c){c.dirty=!1;c.en_creation=!1;c.heure_debut=b.start;c.heure_fin=b.end;c.regroupement_id=b.details.regroupement_id;
a.current_user.get_actual_subjects().then(function(d){h.edition(a.raw_data,d,a.current_user.actual_groups,c,b.details.cours,b.details.devoirs,z,!1)})}):(0<b.details.devoirs.length||!_(b.details.cours).isNull()&&_(b.details.cours).has("contenu"))&&h.display(b.matiere,b.details.cours,b.details.devoirs,z,!1)},select:function(c,d,f){if(a.calendar.options.selectable&&a.calendar.options.editable&&0<a.selected_regroupements.length){18E5===d-c&&(d=b(d).add(30,"minutes").toDate());c=new Date(c);d=new Date(d);
var g=a.selected_regroupements[0].id,e=new p({regroupement_id:g,jour_de_la_semaine:c.getDay(),heure_debut:b(c).toISOString(),heure_fin:b(d).toISOString(),matiere_id:""});e.$save().then(function(){e.dirty=!0;e.en_creation=!0;e.heure_debut=c;e.heure_fin=d;e.regroupement_id=g;a.current_user.get_actual_subjects().then(function(b){h.edition(a.raw_data,b,a.current_user.actual_groups,e,null,[],z,!1)});a.emploi_du_temps.fullCalendar("unselect")})}},eventDrop:function(b,c,d,f,g,e){a.calendar.options.selectable&&
a.calendar.options.editable&&p.update({id:b.details.creneau_emploi_du_temps_id,heure_debut:b.start.toDate(),heure_fin:b.end.toDate(),jour_de_la_semaine:b.end.day()})},eventResize:function(b,c,d,f,g,e){a.calendar.options.selectable&&a.calendar.options.editable&&p.update({id:b.details.creneau_emploi_du_temps_id,heure_debut:b.start.toDate(),heure_fin:b.end.toDate()})}},events:[]}}]);
angular.module("cahierDeTextesClientApp").factory("RecursionHelper",["$compile",function(a){return{compile:function(b,d){angular.isFunction(d)&&(d={post:d});var e=b.contents().remove(),c;return{pre:d&&d.pre?d.pre:null,post:function(b,g){c||(c=a(e));c(b,function(a){g.append(a)});d&&d.post&&d.post.apply(null,arguments)}}}}}]).directive("cartable",["RecursionHelper",function(a){return{scope:{racine:"\x3dracine",target:"\x3dtarget",regroupement:"\x3dregroupement",addCallback:"\x3daddCallback"},replace:!0,
controller:["$scope","$sce","URL_DOCS","Documents",function(a,d,e,c){a.$ctrl=a;a.getChildren=function(a){c.list_files(a.hash).then(function(b){a.children=_(b.data.files).rest()})};a.add_ressource_to_target=function(b,d,e){void 0===b.ressources&&(b.ressources=[]);void 0===_(b.ressources).findWhere({hash:d.hash})&&c.ajout_au_cahier_de_textes(e,d).then(a.addCallback(b),function(a){console.debug(a.error)})};a.add_ressource_already_in_CT_to_target=function(a,b){a.ressources.push({name:b.name,hash:b.hash,
url:d.trustAsResourceUrl(e+"/api/connector?cmd\x3dfile\x26target\x3d"+b.hash)})}}],template:'\x3cul class\x3d"cartable"\x3e                              \x3cli ng:repeat\x3d"node in $ctrl.racine"                          ng:class\x3d"{\'disabled\': node.name \x3d\x3d \'Cahier de textes.ct\'}"                          style\x3d"list-style-type: none"\x3e                              \x3cspan class\x3d"glyphicon"                          ng:class\x3d"{\'glyphicon-folder-open\': node.children, \'glyphicon-folder-close\': !node.children}"                          ng:if\x3d"node.mime \x3d\x3d \'directory\'"                          ng:click\x3d"$ctrl.getChildren( node )"\x3e        {{node.name}}    \x3c/span\x3e    \x3cbutton class\x3d"btn btn-sm btn-success from-docs"            style\x3d"padding:top: 0; padding:bottom: 0"            ng:if\x3d"node.mime !\x3d \'directory\'"            ng:click\x3d"$ctrl.add_ressource_to_target( $ctrl.target, node, $ctrl.regroupement )"\x3e      \x3cspan class\x3d"glyphicon glyphicon-plus"\x3e\x3c/span\x3e    \x3c/button\x3e    \x3cbutton class\x3d"btn btn-sm btn-success from-ct"            style\x3d"padding:top: 0; padding:bottom: 0"            ng:if\x3d"node.mime !\x3d \'directory\'"            ng:click\x3d"$ctrl.add_ressource_already_in_CT_to_target( $ctrl.target, node )"\x3e      \x3cspan class\x3d"glyphicon glyphicon-plus"\x3e\x3c/span\x3e    \x3c/button\x3e    \x3cspan class\x3d"glyphicon glyphicon-file" ng:if\x3d"node.mime !\x3d \'directory\'"\x3e        {{node.name}} \x3cspan ng:if\x3d"node.mime !\x3d \'directory\'"\x3e({{node.mime}})\x3c/span\x3e    \x3c/span\x3e    \x3cdiv cartable         ng:if\x3d"node.mime \x3d\x3d \'directory\'"         racine\x3d"node.children"         target\x3d"$ctrl.target"         regroupement\x3d"$ctrl.regroupement"         add-callback\x3d"$ctrl.addCallback"\x3e    \x3c/div\x3e  \x3c/li\x3e\x3c/ul\x3e',
compile:a.compile}}]);angular.module("cahierDeTextesClientApp").directive("fileModel",["$parse",function(a){return{restrict:"A",link:function(b,d,e){var c=a(e.fileModel).assign;d.bind("change",function(){b.$apply(function(){c(b,d[0].files[0])})})}}}]);
angular.module("cahierDeTextesClientApp").service("Annuaire",["$http","$q","URL_ENT",function(a,b,d){var e=this,c=function(a){switch(a){case "CLS":return"Classe";case "GRP":return"Groupe";case "GPL":return"Groupe libre";default:return""}};e.query_subjects=_.memoize(function(){return a.get(d+"/api/subjects")});e.get_subject=_.memoize(function(b){return a.get(d+"/api/subjects/"+b)});e.get_subjects=_.memoize(function(b){return a.get(d+"/api/subjects/",{params:{"id[]":b}})});e.get_structure=_.memoize(function(b){return a.get(d+
"/api/structures/"+b)});e.get_group=_.memoize(function(f){return a.get(d+"/api/groups/"+f+"?expand\x3dfalse").then(function(a){a.data.full_type=c(a.data.type);return b.resolve(a)})});e.get_groups=_.memoize(function(f){return _(f).isEmpty()?b.resolve({data:[]}):a.get(d+"/api/groups/",{params:{"id[]":f}}).then(function(a){a.data=a.data.map(function(a){a.full_type=c(a.type);return a});return b.resolve(a)})});e.get_groups_of_structures=_.memoize(function(f){return a.get(d+"/api/groups/",{params:{"structure_id[]":f}}).then(function(a){a.data=
a.data.map(function(a){a.full_type=c(a.type);return a});return b.resolve(a)})});e.get_user=_.memoize(function(c){return a.get(d+"/api/users/"+c).then(function(a){a.data.profil_actif=_(a.data.profiles).findWhere({active:!0});a.data.get_actual_groups=function(){return e.get_groups(_(a.data.groups).pluck("group_id")).then(function(a){return b.resolve(a.data)})};a.data.get_actual_subjects=function(){return e.get_subjects(_(a.data.groups).pluck("subject_id")).then(function(a){return b.resolve(a.data)})};
return a})});e.get_users=_.memoize(function(b){return a.get(d+"/api/users/",{params:{"id[]":b}})})}]);
angular.module("cahierDeTextesClientApp").service("User",["$http","$q","APP_PATH","Annuaire",function(a,b,d,e){this.get_user=_.memoize(function(){return a.get(d+"/api/users/current").then(function(a){_(a.data.profils).each(function(b){b.regroupements=_.chain(a.data.regroupements).filter(function(a){return a.etablissement_code==b.structure_id}).map(function(a){return{id:a.id,libelle:a.name,type:a.type}}).uniq(function(a){return a.id}).reject(function(a){return _.isUndefined(a.id)}).value()});a.data.profil_actif=
_(a.data.profils).findWhere({active:!0});a.data.profil_actif.admin=!_.chain(a.data.profils).findWhere({structure_id:a.data.profil_actif.structure_id,type:"ADM"}).isUndefined().value();if(0<a.data.enfants.length){var c=a.data.enfants.map(function(a){return e.get_user(a.child_id).then(function(b){a.enfant=b.data})});b.all(c).then(function(){a.data.enfant_actif=a.data.enfants[0]})}a.data.get_actual_groups=function(){var c=_.chain(a.data.groups).pluck("group_id").uniq().value(),d=b.resolve([]);d=_(["EVS",
"DIR","ADM"]).contains(a.data.profil_actif.type)||a.data.profil_actif.admin?e.get_groups_of_structures([a.data.profil_actif.structure_id]):e.get_groups(c);return d.then(function(c){a.data.actual_groups=_(c.data).select(function(b){return b.structure_id===a.data.profil_actif.structure_id});return b.resolve(a.data.actual_groups)})};a.data.extract_subjects_ids=function(){return _.chain(a.data.groups).pluck("subject_id").uniq().value()};a.data.get_actual_subjects=function(){return e.get_subjects(a.data.extract_subjects_ids()).then(function(c){a.data.actual_subjects=
c.data;return b.resolve(a.data.actual_subjects)})};a.data.is=function(a){return this.profil_actif.type==a};return a})});this.update_parameters=function(b){return a.put(d+"/api/users/current/parametres",{parameters:JSON.stringify(b)})}}]).factory("StatistiquesRegroupements",["$resource","APP_PATH",function(a,b){return a(b+"/api/etablissements/:uai/statistiques/regroupements/:id",{uai:"@uai",id:"@id"})}]).factory("Cours",["$resource","APP_PATH",function(a,b){return a(b+"/api/cours/:id",{id:"@id"},{update:{method:"PUT"},
valide:{method:"PUT",url:b+"/api/cours/:id/valide"},copie:{method:"PUT",url:b+"/api/cours/:id/copie/regroupement/:regroupement_id/creneau_emploi_du_temps/:creneau_emploi_du_temps_id/date/:date",params:{id:"@id",regroupement_id:"@regroupement_id",creneau_emploi_du_temps_id:"@creneau_emploi_du_temps_id",date:"@date"}}})}]).factory("CreneauxEmploiDuTemps",["$resource","APP_PATH",function(a,b){return a(b+"/api/creneaux_emploi_du_temps/:id",{id:"@id",regroupement_id:"@regroupement_id",previous_regroupement_id:"@previous_regroupement_id",
jour_de_la_semaine:"@jour_de_la_semaine",heure_debut:"@heure_debut",heure_fin:"@heure_fin",matiere_id:"@matiere_id",semainier_regroupement:"@semainier_regroupement",semainier_salle:"@semainier_salle"},{update:{method:"PUT"},delete:{method:"DELETE",params:{id:"@id",date_creneau:"@date_creneau"}},bulk:{method:"POST",isArray:!0,url:b+"/api/creneaux_emploi_du_temps/bulk",params:{creneaux_emploi_du_temps:"@creneaux_emploi_du_temps"}},bulk_delete:{method:"DELETE",isArray:!0,url:b+"/api/creneaux_emploi_du_temps/bulk",
params:{ids:"@ids",date_creneau:"@date_creneau"}}})}]).factory("Devoirs",["$resource","APP_PATH",function(a,b){return a(b+"/api/devoirs/:id",{id:"@id",uid:"@uid"},{update:{method:"PUT"},fait:{method:"PUT",url:b+"/api/devoirs/:id/fait"},copie:{method:"PUT",url:b+"/api/devoirs/:id/copie/cours/:cours_id/creneau_emploi_du_temps/:creneau_emploi_du_temps_id/date_due/:date_due",params:{id:"@id",cours_id:"@cours_id",creneau_emploi_du_temps_id:"@creneau_emploi_du_temps_id",date_due:"@date_due"}}})}]).factory("EmploisDuTemps",
["$resource","APP_PATH",function(a,b){return a(b+"/api/emplois_du_temps",{debut:"@debut",fin:"@fin",uid:"@uid"})}]).factory("Enseignants",["$resource","APP_PATH",function(a,b){return a(b+"/api/etablissements/:uai/statistiques/enseignants/:enseignant_id",{uai:"@uai",enseignant_id:"@enseignant_id"})}]).factory("Etablissements",["$resource","APP_PATH",function(a,b){return a(b+"/api/etablissements/:uai",{uai:"@uai"})}]).factory("Salles",["$resource","APP_PATH",function(a,b){return a(b+"/api/salles/:id",
{id:"@id"},{bulk:{method:"POST",isArray:!0,url:b+"/api/salles/bulk",params:{salles:"@salles"}}})}]).factory("CahiersDeTextes",["$resource","APP_PATH",function(a,b){return a(b+"/api/cahiers_de_textes/:id",{id:"@id"},{bulk:{method:"POST",isArray:!0,url:b+"/api/cahiers_de_textes/bulk",params:{cahiers_de_textes:"@cahiers_de_textes"}}})}]).factory("TypesDeDevoir",["$resource","APP_PATH",function(a,b){return a(b+"/api/types_de_devoir/:id",{id:"@id"})}]).factory("Matchable",["$resource","APP_PATH",function(a,
b){return a(b+"/api/matchables/:uai/:hash_item",{uai:"@uai",hash_item:"@hash_item",id_annuaire:"@id_annuaire"})}]);
angular.module("cahierDeTextesClientApp").service("API",["$http","APP_PATH","StatistiquesRegroupements","Cours","CreneauxEmploiDuTemps","Devoirs","EmploisDuTemps","Enseignants","Etablissements","TypesDeDevoir",function(a,b,d,e,c,f,g,k,l,h){this.get_etablissement=function(a){return l.get(a)};this.query_statistiques_regroupements=function(a){return d.query(a)};this.query_types_de_devoir=_.memoize(function(){return h.query()});this.get_type_de_devoir=_.memoize(function(a){return h.get({id:a})});this.query_emplois_du_temps=
function(){return g.query()};this.get_creneau_emploi_du_temps=function(a){return c.get(a)};this.get_creneaux_emploi_du_temps_similaires=function(c){return a.get(b+"/api/creneaux_emploi_du_temps/"+c.id+"/similaires?debut\x3d"+c.debut.toISOString()+"\x26fin\x3d"+c.fin.toISOString())};this.query_enseignants=function(a){return k.query(a)};this.get_enseignant=function(a){return k.get(a)};this.get_cours=function(a){return e.get(a)};this.query_devoirs=function(a){return f.query(a)};this.get_devoir=function(a){return f.get(a)}}]);
angular.module("cahierDeTextesClientApp").service("Documents",["$http","$q","URL_DOCS","Annuaire",function(a,b,d,e){var c=this;c.list_files=_.memoize(function(b){var c={cmd:"open",target:""};void 0==b?c.tree=1:c.target=b;return a.get(d+"/api/connector",{params:c})});c.get_ctxt_folder_hash=_.memoize(function(a){var b,d,f,h,p;return e.get_structure(a.structure_id).then(function(a){b=a.data;return c.list_files()}).then(function(a){d=_(a.data.files).findWhere({phash:null,name:b.name});return c.list_files(d.hash)}).then(function(a){f=
_(a.data.files).findWhere({phash:d.hash,name:"classes"});return c.list_files(f.hash)}).then(function(b){h=_(b.data.files).findWhere({phash:f.hash,name:a.name});return c.list_files(h.hash)}).then(function(a){p=_(a.data.files).findWhere({phash:h.hash,name:"Cahier de textes.ct"});return p.hash})});c.ajout_au_cahier_de_textes=function(b,e){return c.get_ctxt_folder_hash(b).then(function(b){return a.get(d+"/api/connector",{params:{cmd:"paste","targets[]":e.hash,"renames[]":e.name,dst:b,cut:!1}})}).then(function(a){return a.data})};
c.upload_dans_cahier_de_textes=function(f,e){return c.get_ctxt_folder_hash(f).then(function(c){return b.all(_(e).map(function(b){var f=new FormData;f.append("cmd","upload");f.append("target",c);f.append("upload[]",b);f.append("renames[]",b.name);return a.post(d+"/api/connector",f,{headers:{"Content-Type":void 0},transformRequest:angular.identity})})).then(function(a){return a})})}}]);
angular.module("cahierDeTextesClientApp").service("fileUpload",["$http",function(a){this.uploadFileToUrl=function(b,d,e){var c=new FormData;c.append("file",b);_.chain(e).keys().each(function(a){c.append(a,e[a])});return a.post(d,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}}]);
angular.module("cahierDeTextesClientApp").service("PopupsCreneau",["$uibModal","toastr","POPUP_ACTIONS","APP_PATH",function(a,b,d,e){var c=function(c,e,k){a.open(c).result.then(function(a){_(a.actions_done).each(function(a){switch(a){case d.CANCELLED:b.info("","Annulation.");break;case d.CRENEAU_DELETED:b.info("","Cr\u00e9neau supprim\u00e9.");break;case d.CRENEAU_MODIFIED:b.info("","Cr\u00e9neau mis \u00e0 jour.");break;case d.SEQUENCE_PEDAGOGIQUE_CREATED:b.success("","S\u00e9quence p\u00e9dagogique cr\u00e9\u00e9e.");
break;case d.SEQUENCE_PEDAGOGIQUE_MODIFIED:b.success("","S\u00e9quence p\u00e9dagogique modifi\u00e9e.");break;case d.SEQUENCE_PEDAGOGIQUE_DELETED:b.success("","S\u00e9quence p\u00e9dagogique supprim\u00e9e.");break;case d.DEVOIR_CREATED:b.success("","Devoir cr\u00e9\u00e9.");break;case d.DEVOIR_MODIFIED:b.success("","Devoir modifi\u00e9.");break;case d.DEVOIR_DELETED:b.success("","Devoir supprim\u00e9.")}});e(a)}).finally(function(){})};this.edition=function(a,b,d,l,h,p,q,m){c({templateUrl:e+"/app/views/popup_edition.html",
controller:"PopupEditionCtrl",resolve:{raw_data:function(){return a},matieres:function(){return b},classes:function(){return d},creneau:function(){return l},cours:function(){return h},devoirs:function(){return p}},backdrop:"static"},q,m)};this.display=function(a,b,d,l,h){c({templateUrl:e+"/app/views/popup_display.html",controller:"PopupDisplayCtrl",resolve:{titre:function(){return a},cours:function(){return b},devoirs:function(){return d}},backdrop:"static"},l,h)}}]);
angular.module("cahierDeTextesClientApp").service("Redirection",["$state","User",function(a,b){this.doorman=function(d){b.get_user().then(function(b){if(0===_(d).size()||-1===_(d).indexOf(b.data.profil_actif.type)&&!b.data.profil_actif.admin){var c="404";switch(b.data.profil_actif.type){case "DIR":c="enseignants";break;case "ADM":case "EVS":case "ENS":case "DOC":case "TUT":case "ELV":c="emploi_du_temps"}a.go(c,a.params,{reload:!0,inherit:!0,notify:!0})}})}}]);
angular.module("cahierDeTextesClientApp").service("Utils",["$locale","moment","SEMAINES_VACANCES",function(a,b,d){var e=this;this.school_year_start=function(){var a=b(),d=b();8<a.month()+1?d.set("year",a.year()):d.set("year",a.year()-1);d.set("month",8);d.set("date",1);return d};this.school_year_end=function(){var a=b(),d=b();8<a.month()+1?d.set("year",a.year()+1):d.set("year",a.year());d.set("month",6);d.set("date",7);return d};this.is_in_school_year=function(a){a=b(a);return a.isAfter(this.school_year_start())&&
a.isBefore(this.school_year_end())};this.sont_ce_les_vacances=function(a,b){return-1!=d[b].indexOf(a)};this.what_month=function(a){var c=b(),d=c.year();36>a&&7<c.month()?d++:7>c.month()&&d--;return b(d).isoWeek(a).month()};this.fix_semainier_pronote=function(a,d){a=parseInt(a).toString(2);a=e.padStart(a,53,"0");a=a.substr(0,52).split("").reverse().join("");d=52-b(new Date(d)).week();d=a.slice(d,52)+a.substr(0,d);d=d.split("").reverse().join("");return parseInt(d,2)};this.overlay_semainier=function(){return _.chain(_.range(1,
52)).map(function(a){return{semaine:a,mois:e.what_month(a)}}).groupBy(function(a){return a.mois}).toArray().map(function(b,d){return{index:7<d?d-8:d+4,label:a.DATETIME_FORMATS.MONTH[d],semaines:b}}).value()};this.groupByKey=function(a,b){return _.chain(a).map(function(a){return a[b]}).object(a).value()};this.padEnd=function(a,b,d){if(a.length>=b)return a;var c="";_((b-a.length)/d.length).times(function(){c+=d});return(a+c).substr(0,b)};this.padStart=function(a,b,d){if(a.length>=b)return a;var c="";
_((b-a.length)/d.length).times(function(){c+=d});return(c+a).substr(-1*b)};this.libelleHeure_to_Moment=function(a){a=a.split(":").map(function(a){return parseInt(a)});var c=(new Date).getTimezoneOffset()/60*-1;return b().set({hour:a[0]+c,minute:a[1],second:a[2]})};this.fixnum_to_bitfield=function(a){a=a.toString(2);var b="";_(52-a.length).times(function(){b+="0"});return _((b+a).split("").map(function(a){return parseInt(a)}).reverse()).rest()};this.bitfield_to_fixnum=function(a){return parseInt(a.reverse().join("")+
"0",2)}}]);angular.module("cahierDeTextesClientApp").service("log",["$http","$state","APP_PATH","User","URL_ENT",function(a,b,d,e,c){this.add=function(f,g,k){e.get_user().then(function(e){e=e.data;a.post(c+"/api/logs",{application_id:f,user_id:e.id,structure_id:e.profil_actif.structure_id,profil_id:e.profil_actif.type,url:(_(g).isNull()?d+b.current.url:g).substr(0,1023),params:_(k).isNull()?_(b.params).map(function(a,b){return b+"\x3d"+a}).join("\x26"):k}).then(function(){},function(){})})}}]);
