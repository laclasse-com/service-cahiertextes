"use strict";angular.module("cahierDeTextesClientApp",["angularMoment","chieffancypants.loadingBar","ngAnimate","ngColorPicker","ngLocale","ngResource","ngSanitize","ngTouch","nvd3","textAngular","uiSwitch","toastr","ui.bootstrap","ui.bootstrap.dropdown","ui.calendar","ui.checkbox","ui.router","ui.select"]),angular.module("cahierDeTextesClientApp").component("displayDevoir",{bindings:{devoir:"="},template:"<div ng:class=\"{ 'type1': $ctrl.devoir.type_devoir_id === 1, 'type2': $ctrl.devoir.type_devoir_id === 2, 'type3': $ctrl.devoir.type_devoir_id === 3, 'type4': $ctrl.devoir.type_devoir_id === 4, 'type5': $ctrl.devoir.type_devoir_id === 5, 'type6': $ctrl.devoir.type_devoir_id === 6, 'fait': $ctrl.devoir.fait, 'a-faire': !$ctrl.devoir.fait }\">    <h5><i class=\"picto\" ng:style=\"{'background-image':'url(' + $ctrl.app_path + '/app/node_modules/laclasse-common-client/images/picto_matiere.svg)'}\"></i> {{$ctrl.devoir.matiere.name}} </h5>    <h6><i class=\"picto\" ng:style=\"{'background-image':'url(' + $ctrl.app_path + '/app/node_modules/laclasse-common-client/images/picto_devoir.svg)'}\"></i> {{$ctrl.devoir.type_devoir.description}} : </h6>    <span ng:if=\"$ctrl.display_time_estimation && $ctrl.devoir.temps_estime > 0\"><i class=\"picto\" ng:style=\"{'background-image':'url(' + $ctrl.app_path + '/app/node_modules/laclasse-common-client/images/picto_temps.svg)'}\"></i> Temps estim\xe9 : <em>{{$ctrl.devoir.temps_estime * 5}} minutes</em></span>"+'    <div class="alert alert-default" ng:bind-html="$ctrl.devoir.contenu"></div>    <div class="row col-md-12 ressources">      <div class="attached-document" ng:repeat="ressource in $ctrl.devoir.ressources">        <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>      </div>    </div></div>',controller:["$sce","URL_DOCS","APP_PATH","API",function(e,t,n,a){var i=this;i.$onInit=function(){i.app_path=n,i.display_time_estimation=!1,i.devoir.contenu=e.trustAsHtml(i.devoir.contenu),a.get_type_de_devoir(i.devoir.type_devoir_id).$promise.then(function(e){i.devoir.type_devoir=e}),_(i.devoir.ressources).each(function(n){n.url=e.trustAsResourceUrl(t+"/api/connector?cmd=file&target="+n.hash)})}}]}),angular.module("cahierDeTextesClientApp").component("displaySequencePedagogique",{bindings:{sp:"<"},template:'<h5>S\xe9quence p\xe9dagogique du {{$ctrl.sp.date_cours | amDateFormat:\'dddd D MMMM\'}}</h5><div class="alert alert-default" ng:bind-html="$ctrl.sp.contenu"></div><ul ng:if="sp.ressources.length > 0">  <li ng:repeat="ressource in sp.ressources">    <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>  </li></ul>',controller:["$sce","URL_DOCS",function(e,t){var n=this;n.$onInit=function(){typeof n.sp.contenu==String&&(n.sp.contenu=e.trustAsHtml(n.sp.contenu)),_(n.sp.ressources).each(function(n){n.url=e.trustAsResourceUrl(t+"/api/connector?cmd=file&target="+n.hash)})}}]}),angular.module("cahierDeTextesClientApp").component("switchDevoir",{bindings:{devoir:"="},template:'<span switch      class="violet"      ng:if="!($ctrl.devoir.type_devoir_id == 1)"      ng:model="$ctrl.devoir.fait"      ng:change="$ctrl.fait( $ctrl.devoir )" ></span>',controller:["toastr",function(e){this.fait=function(t){t.$fait().then(function(t){t.fait?e.success("Devoir fait.","Bravo !"):e.info("Devoir \xe0 faire","Encore un petit effort.")})}}]}),angular.module("cahierDeTextesClientApp").config(["$httpProvider",function(e){e.defaults.withCredentials=!0}]).config(["cfpLoadingBarProvider",function(e){e.latencyThreshold=500}]).run(["amMoment",function(e){e.changeLocale("fr")}]).constant("angularMomentConfig",{timezone:"Europe/Brussels"}).config(["$provide",function(e){e.decorator("taTranslations",["$delegate",function(e){return e.html.tooltip="Basculer entre les vues HTML et texte enrichi",e.justifyLeft.tooltip="Justifier \xe0 gauche",e.justifyCenter.tooltip="Centrer",e.justifyRight.tooltip="Justifier \xe0 droite",e.bold.tooltip="Mettre en gras",e.italic.tooltip="Mettre en italique",e.underline.tooltip="Souligner",e.insertLink.tooltip="Ins\xe9rer un lien",e.insertLink.dialogPrompt="Lien \xe0 ins\xe9rer",e.editLink.targetToggle.buttontext="Le lien s'ouvrira dans une nouvelle fen\xeatre",e.editLink.reLinkButton.tooltip="\xc9diter le lien",e.editLink.unLinkButton.tooltip="Enlever le lien",e.insertImage.tooltip="Ins\xe9rer une image",e.insertImage.dialogPrompt="URL de l'image :",e.insertVideo.tooltip="Ins\xe9rer une vid\xe9o",e.insertVideo.dialogPrompt="URL de la vid\xe9o Youtube :",e.clear.tooltip="Enlever le formattage",e.ul.tooltip="Liste",e.ol.tooltip="Liste num\xe9rot\xe9e",e.quote.tooltip="Citation",e.undo.tooltip="Annuler",e.redo.tooltip="R\xe9tablir",e}]),e.decorator("taOptions",["$delegate","taRegisterTool",function(e,t){e.toolbar=[["bold","italics","underline","ul","ol","quote","justifyLeft","justifyCenter","justifyRight","insertLink","insertImage","insertVideo","html","redo","undo"]];var n=function(e){var t="backcolor"===e?"background-":"",n=["#7bd148","#5484ed","#a4bdfc","#46d6db","#7ae7bf","#51b749","#fbd75b","#ffb878","#ff887c","#dc2127","#dbadff","#e1e1e1"];return"backcolor"===e&&n.push("transparent"),{couleurs:n,display:'<span uib-dropdown><a uib-dropdown-toggle><i class="fa fa-font" data-ng-style="{\''+t+'color\': selected }"></i> <i class="fa fa-caret-down"></i></a><ng-color-picker uib-dropdown-menu selected="selected" colors="couleurs"></ng-color-picker></span>',action:function(){return"nil"!==this.selected&&this.$editor().wrapSelection(e,this.selected)}}};return t("fontColor",n("forecolor")),e.toolbar[0].push("fontColor"),t("backgroundColor",n("backcolor")),e.toolbar[0].push("backgroundColor"),t("table",{columns:{value:1,hovered:1},rows:{value:1,hovered:1},hover:function(e,t){e.hovered=t},leave:function(e){e.hovered=e.value},tooltiptext:"ins\xe9rer un tableau",display:'<span uib-dropdown><a uib-dropdown-toggle><i class="fa fa-table"></i> <i class="fa fa-caret-down"></i></a><div uib-dropdown-menu data-ng-click="$event.stopPropagation()"><label><span uib-rating on-hover="hover( columns, value )" on-leave="leave( columns )" ng-model="columns.value" max="15" state-on="\'glyphicon-stop\'" state-off="\'glyphicon-unchecked\'"></span><br>{{columns.hovered}} colonnes</label><br><label><span uib-rating on-hover="hover( rows, value )" on-leave="leave( rows )" ng-model="rows.value" max="15" state-on="\'glyphicon-stop\'" state-off="\'glyphicon-unchecked\'"></span><br>{{rows.hovered}} lignes</label><br><button class="btn btn-success" data-ng-click="insert_table()">Ins\xe9rer</button></div></span>',insert_table:function(){for(var e="",t=0;t<this.columns.value;t++)e+="<td>&nbsp;</td>";for(var n="",a=0;a<this.rows.value;a++)n=n+"<tr>"+e+"</tr>";this.$editor().wrapSelection("insertHTML",'<table class="table table-bordered">'+n+"</table>"),this.deferration.resolve()},action:function(e){return this.deferration=e,!1}}),e.toolbar[0].push("table"),e.classes={focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},e}]),e.decorator("taTools",["$delegate",function(e){return e.html.buttontext="HTML",e}])}]).config(["toastrConfig",function(e){angular.extend(e,{allowHtml:!0,closeButton:!1,closeHtml:"<button>&times;</button>",containerId:"toast-container",extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},maxOpened:0,messageClass:"toast-message",newestOnTop:!0,onHidden:null,onShown:null,positionClass:"toast-bottom-right",tapToDismiss:!0,target:"body",timeOut:5e3,titleClass:"toast-title",toastClass:"toast"})}]),angular.module("cahierDeTextesClientApp").controller("AssignementsCtrl",["$scope","$sce","$timeout","toastr","$state","moment","APP_PATH","URL_DOCS","API","Annuaire","Devoirs","Cours","CreneauxEmploiDuTemps","User",function(e,t,n,a,i,s,r,o,l,c,u,d,p,m){e.affiche_faits=!1,e.tri_ascendant=!0,e.popup_ouverte=!1,e.matiere_selected=null;var f=_.memoize(function(e){return d.get({id:e})}),g=_.memoize(function(e){return p.get({id:e})});e.filter_data=function(t){_(t).isNull()?e.devoirs=e.all_devoirs:e.devoirs=_(e.all_devoirs).select(function(e){return e.creneau_emploi_du_temps.matiere_id==t.id})},e.period_offset=0;var h=Math.abs(9-(s().month()+1));e.period_offsets_list=_.range(h,-1*(10-h),-1).map(function(e){return{offset:e,label:0==e?"ce mois":s().add(-1*e,"months").fromNow()}}),e.incr_offset=function(){e.period_offset++},e.decr_offset=function(){e.period_offset--},e.reset_offset=function(){e.period_offset=0},m.get_user().then(function(n){e.current_user=n.data;var a=function(){e.from_date=s().subtract(e.period_offset,"months").subtract(2,"weeks").toDate(),e.to_date=s().subtract(e.period_offset,"months").add(2,"weeks").toDate(),l.query_devoirs({"date_due>":e.from_date,"date_due<":e.to_date,"groups_ids[]":"TUT"===e.current_user.profil_actif.type?_(e.current_user.enfant_actif.enfant.groups).pluck("group_id"):_(e.current_user.groups).pluck("group_id"),uid:"TUT"===e.current_user.profil_actif.type?e.current_user.enfant_actif.child_id:null}).$promise.then(function(n){e.matieres={},e.all_devoirs=_(n).map(function(n){return n.cours=f(n.cours_id),n.creneau_emploi_du_temps=g(n.creneau_emploi_du_temps_id),n.creneau_emploi_du_temps.$promise.then(function(){c.get_subject(n.creneau_emploi_du_temps.matiere_id).then(function(t){n.matiere=t.data,e.matieres[n.matiere.id]=n.matiere})}),_(n.ressources).each(function(e){e.url=t.trustAsResourceUrl(o+"/api/connector?cmd=file&target="+e.hash)}),n}),e.filter_data(e.matiere_selected)})};e.$watch("period_offset",function(){a()})})}]),angular.module("cahierDeTextesClientApp").controller("DashboardTeacherCtrl",["$scope","$stateParams","$q","$locale","$timeout","moment","toastr","API","Cours","Annuaire","current_user","PIECHART_DEFINITION","MULTIBARCHART_DEFINITION",function(e,t,n,a,i,s,r,o,l,c,u,d,p){e.mois=_(a.DATETIME_FORMATS.MONTH).toArray(),e.scope=e,e.moisCourant=null,e.montre_valides="DIR"!==u.profil_actif.type,e.nb_saisies_visables=0,e.current_user=u,e.enseignant_id=_(t).has("enseignant_id")?t.enseignant_id:e.current_user.id;var m=function(e){return _(e).select({recent:!1,valide:!1}).length};e.detail_regroupement=function(t){_(e.enseignant.liste_regroupements).findWhere({id:t})},e.filter_saisie=function(e,t,n){return function(a){return(e||_(a.cours.date_validation).isNull())&&(_(t).isNull()||a.mois==t)&&_.chain(n).pluck("id").contains(a.regroupement_id).value()}},e.graphiques={pieChart:angular.copy(d),multiBarChart:angular.copy(p),populate:function(t){e.graphiques.multiBarChart.data=[{key:"saisies non vis\xe9es",values:[]},{key:"saisies vis\xe9es",values:[]}],e.graphiques.pieChart.data=[{label:"saisies non vis\xe9es",value:0},{label:"saisies vis\xe9es",value:0}],_.chain(t).groupBy("regroupement_id").each(function(t){var n=t.length,a=_(t).where({valide:!0}).length,i=t[0].group.name;e.graphiques.multiBarChart.data[0].values.push({key:i,x:i,y:n-a}),e.graphiques.multiBarChart.data[1].values.push({key:i,x:i,y:a}),e.graphiques.pieChart.data[0].value+=n-a,e.graphiques.pieChart.data[1].value+=a})}},e.select_all_regroupements=function(){e.selected_regroupements=e.enseignant.liste_regroupements,e.graphiques.populate(e.raw_data)},e.select_no_regroupements=function(){e.selected_regroupements=[],e.graphiques.populate(e.raw_data)},e.valide=function(t){if("DIR"===u.profil_actif.type){var n=_(t).has("disable_toastr");t.cours.$valide().then(function(a){if(t.valide=!_(a.date_validation).isNull(),!e.montre_valides&&!_(a.date_validation).isNull()){var s=a.date_validation;a.date_validation=null,i(function(){a.date_validation=s},3e3)}e.nb_saisies_visables=m(e.raw_data),e.graphiques.populate(e.raw_data),n||r.success("S\xe9quence p\xe9dagogique "+(t.valide?"":"d\xe9-")+"vis\xe9e.","Op\xe9ration r\xe9ussie")})}},e.valide_all=function(){swal({title:"Tout viser ?",text:"Cette action va viser toutes les saisies actuellement affich\xe9es \xe0 l'\xe9cran.",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b55",confirmButtonText:"Confirmer",cancelButtonText:"Annuler"}).then(function(){var t=0;if(_.chain(e.raw_data).reject(function(e){return e.valide||e.recent}).each(function(n){n.disable_toastr=!0,e.valide(n),t++}),t>0){var n=t>1?"s":"",a=t+" s\xe9quence"+n+" p\xe9dagogique"+n+" vis\xe9e"+n+".";r.success(a,"Op\xe9ration r\xe9ussie")}},function(){})},c.get_user(e.enseignant_id).then(function(t){return e.enseignant=t.data,e.enseignant.get_actual_groups().then(function(t){e.enseignant.liste_regroupements=_.chain(t).select(function(t){return"GPL"!==t.type&&t.structure_id===e.current_user.profil_actif.structure_id}).uniq(function(e){return e.id}).compact().value(),e.enseignant.prof_principal=_.chain(e.enseignant.groups).where({type:"PRI"}).pluck("group_id").map(function(t){return _(e.enseignant.liste_regroupements).findWhere({id:t})}).value(),e.select_all_regroupements()}),e.enseignant.get_actual_subjects().then(function(t){e.enseignant.liste_matieres=_.chain(t).uniq(function(e){return e.id}).compact().value()}),o.get_enseignant({enseignant_id:e.enseignant_id,uai:e.current_user.profil_actif.structure_id}).$promise}).then(function(t){var n=s().subtract(2,"weeks");e.raw_data=_(t.saisies).map(function(t,a){return t.index=a,t.cours=new l(t.cours),t.regroupement_id=parseInt(t.regroupement_id),t.month=s(t.cours.date_cours).month(),t.recent=s(t.cours.date_cours).isAfter(n),t.matiere=_(e.enseignant.liste_matieres).findWhere({id:t.matiere_id}),_(t.matiere).isUndefined()&&(t.matiere=c.get_subject(t.matiere_id)),t.group=_(e.enseignant.liste_regroupements).findWhere({id:t.regroupement_id}),_(t.group).isUndefined()&&c.get_group(t.regroupement_id).then(function(e){t.group=e.data}),t}),e.graphiques.populate(e.raw_data),e.nb_saisies_visables=m(e.raw_data)})}]),angular.module("cahierDeTextesClientApp").controller("DashboardTeachersCtrl",["$scope","$locale","$q","API","Annuaire","current_user","PIECHART_DEFINITION",function(e,t,n,a,i,s,r){e.scope=e,e.select_all_regroupements=function(){e.selected_regroupements=e.regroupements,e.filter_data()},e.select_no_regroupements=function(){e.selected_regroupements=[],e.filter_data()},e.filter_data=function(){_(e.individualCharts.enseignants).each(function(t){t.display=!_.chain(t.enseignant.details.groups).pluck("group_id").intersection(_(e.selected_regroupements).pluck("id")).isEmpty().value()})},e.individualCharts={enseignants:[],add:function(t){var n={enseignant:t,display:!0,pieChart:angular.copy(r)};n.pieChart.data=[{label:"saisies non vis\xe9es",value:t.filled-t.validated},{label:"saisies vis\xe9es",value:t.validated}],e.individualCharts.enseignants.push(n)}},i.get_groups_of_structures([s.profil_actif.structure_id]).then(function(t){e.regroupements=_(t.data).reject(function(e){return"GPL"===e.type}),e.selected_regroupements=e.regroupements}),a.query_enseignants({uai:s.profil_actif.structure_id}).$promise.then(function(t){return e.raw_data=t,i.get_users(_(e.raw_data).pluck("enseignant_id"))}).then(function(t){var n=_(t.data).indexBy("id");_(e.raw_data).each(function(t){t.details=n[t.enseignant_id];var a=_(t.classes).reduce(function(e,t){var n=_(t.statistiques).reduce(function(e,t){return{filled:e.filled+t.filled,validated:e.validated+t.validated}},{filled:0,validated:0});return{filled:e.filled+n.filled,validated:e.validated+n.validated}},{filled:0,validated:0});t.filled=a.filled,t.validated=a.validated,e.individualCharts.add(t)})})}]),angular.module("cahierDeTextesClientApp").controller("FooterCtrl",["$scope","$state","$stateParams","$sce","VERSION","User",function(e,t,n,a,i,s){e.version=i,s.get_user().then(function(a){e.current_user=a.data,e.save_and_reload=function(){s.update_parameters(e.current_user.parametrage_cahier_de_textes).then(function(){t.transitionTo(t.current,n,{reload:!0,inherit:!0,notify:!0})})}})}]),angular.module("cahierDeTextesClientApp").controller("HeaderCtrl",["$scope","$state","User","Redirection","$sce","URL_DOCS",function(e,t,n,a,i,s){e.load_docs="localhost"!==window.location.hostname,e.URL_DOCS_login=i.trustAsResourceUrl(s+"/login"),e.embedded=window!=window.top,n.get_user().then(function(t){e.current_user=t.data}),e.reload=function(){a.doorman([])}}]),angular.module("cahierDeTextesClientApp").controller("ImportCtrl",["$scope","$http","$locale","$sce","$filter","fileUpload","moment","toastr","$q","APP_PATH","SEMAINES_VACANCES","ZONE","VERSION","Annuaire","Utils","Etablissements","CreneauxEmploiDuTemps","API","Matchable","current_user",function(e,t,n,a,i,s,r,o,l,c,u,d,p,m,f,g,h,v,b,y){e.scope=e,e.jours_de_la_semaine=n.DATETIME_FORMATS.DAY,e.annee=n.DATETIME_FORMATS.MONTH,e.fichier=null,e.display_all=!1,e.step=0,e.report={},e.ui={show_detailed_creneaux:!1,display_ready:!0,display_problems:!0,sortCreneauxBy:["Jour"],sort_creneaux_by:function(t){e.ui.sortCreneauxBy=e.ui.sortCreneauxBy[0]===t[0]?_(t).map(function(e){return"-"+e}):t}},e.beautify_semainier=function(e){var t=f.padEnd(e.toString(2),53,"0");return'<div class="semainier-tooltip gris1">'+_.chain(f.overlay_semainier()).sortBy(function(e){return e.index}).map(function(e){var n='<div class="month blanc"><h5 class="month-name gris4">'+e.label+"</h5>";return n+=_(e.semaines).map(function(e){var n='<span class="week';return f.sont_ce_les_vacances(e.semaine,d)&&(n+=" vacances gris2"),"1"===t[e.semaine]&&(n+=" active orange-moins"),n+='">'+e.semaine+"</span>"}).join(""),n+="</div>"}).value().join("")+'<div class="clearfix"></div></div>'},e.filter_creneau=function(e,t){return function(n){return!(!e.display_problems&&!n.ready)&&(!(!e.display_ready&&n.ready)&&(n.is_displayed=!0,_(t.classes).isEmpty()&&_(t.groupes).isEmpty()?n.is_displayed=n.is_displayed&&!_(n).has("Classe")&&!_(n).has("Groupe"):_(t.classes).isEmpty()&&!_(t.groupes).isEmpty()?n.is_displayed=n.is_displayed&&!_(n).has("Classe")&&_(n).has("Groupe")&&_.chain(t.groupes).pluck("Ident").includes(n.Groupe.Ident).value():!_(t.classes).isEmpty()&&_(t.groupes).isEmpty()?n.is_displayed=n.is_displayed&&_(n).has("Classe")&&!_(n).has("Groupe")&&_.chain(t.classes).pluck("Ident").includes(n.Classe.Ident).value():n.is_displayed=n.is_displayed&&(_(n).has("Groupe")&&_.chain(t.groupes).pluck("Ident").includes(n.Groupe.Ident).value()||_(n).has("Classe")&&_.chain(t.classes).pluck("Ident").includes(n.Classe.Ident).value()),!!n.is_displayed&&(_(t.matieres).isEmpty()?n.is_displayed=n.is_displayed&&!_(n).has("Matiere"):n.is_displayed=n.is_displayed&&_(n).has("Matiere")&&_.chain(t.matieres).pluck("Ident").includes(n.Matiere.Ident).value(),!!n.is_displayed&&n.is_displayed)))}};var x=function(){var t=i("filter")(e.creneaux,e.filter_creneau(e.ui,e.selected));e.counters={},e.counters.creneaux=e.creneaux.length,e.counters.creneaux_broken=_(e.pronote.Cours[0].Cours).select(function(e){return!_(e).has("Matiere")||!_(e).has("Professeur")||!_(e).has("Classe")&&!_(e).has("Groupe")}).length,e.counters.creneaux_not_ready=_(e.creneaux).where({ready:!1}).length,e.counters.creneaux_ready=e.counters.creneaux-e.counters.creneaux_not_ready,e.counters.filtered_creneaux=t.length,e.counters.filtered_creneaux_not_ready=_(t).where({ready:!1}).length,e.counters.filtered_creneaux_ready=e.counters.filtered_creneaux-e.counters.filtered_creneaux_not_ready,e.counters.percent_creneaux_ready=e.counters.filtered_creneaux_ready/e.counters.filtered_creneaux},D=function(){_(e.creneaux).each(function(t){t.readiness={matiere:!_(e.pronote.matieres[t.Matiere.Ident]).isUndefined()&&!_(e.pronote.matieres[t.Matiere.Ident].laclasse).isUndefined(),salle:!_(t.Salle).isUndefined(),classe:_(t).has("Classe")&&!_(e.pronote.classes[t.Classe.Ident]).isUndefined()&&!_(e.pronote.classes[t.Classe.Ident].laclasse).isUndefined(),groupe_eleve:_(t).has("Groupe")&&!_(e.pronote.groupes_eleves[t.Groupe.Ident]).isUndefined()&&!_(e.pronote.groupes_eleves[t.Groupe.Ident].laclasse).isUndefined()},t.ready=t.readiness.matiere&&(t.readiness.classe||t.readiness.groupe_eleve)}),x()},C=function(e){var t=function(e){return _(e).has("PartieDeClass")?"regroupement":_(e).has("Code")?"matiere":"unknown"};return window.btoa(unescape(encodeURIComponent(t(e)+e.displayed_label)))},E=function(t){e.pronote=!1,e.matcheable_data=[];var n=function(e){return l.reject(e)};return o.info("D\xe9chiffrage du fichier"),s.uploadFileToUrl(t,c+"/api/import/pronote/decrypt").then(function(t){return e.pronote=t.data,e.pronote.GrilleHoraire[0].DureePlace=parseInt(e.pronote.GrilleHoraire[0].DureePlace),o.info("r\xe9cup\xe9ration des donn\xe9es de l'\xe9tablissement"),g.get({uai:e.pronote.UAI}).$promise},n).then(function(t){return e.etablissement_summary=t,_(e.etablissement_summary.imports).each(function(e){e.date_import=new Date(e.date_import)}),m.get_structure(e.pronote.UAI)},n).then(function(t){return e.etablissement={classes:_(t.data.groups).where({type:"CLS"}),groupes_eleves:_(t.data.groups).select({type:"GRP"})},_(e.etablissement.groupes_eleves).each(function(e){e.libelle_aaf=e.name.toUpperCase(),e.displayed_label=e.name}),_(e.etablissement.classes).each(function(e){e.libelle_aaf=e.name.toUpperCase(),e.displayed_label=e.name}),o.info("traitement des donn\xe9es des regroupements"),v.query_statistiques_regroupements({uai:y.profil_actif.structure_id}).$promise},n).then(function(t){return _(e.pronote.Classes[0].Classe).each(function(n){if(n.displayed_label=n.Nom,n.laclasse=_(e.etablissement.classes).findWhere({libelle_aaf:n.Nom.toUpperCase()}),_(n.laclasse).isUndefined()){var a=_(e.etablissement_summary.matchables).findWhere({hash_item:C(n)});_(a).isUndefined()||(n.laclasse=_(e.etablissement.classes).findWhere({id:a.id_annuaire}))}n.edit=_(n.laclasse).isUndefined();var i=_(n.laclasse).isUndefined()?undefined:_(t).findWhere({regroupement_id:""+n.laclasse.id});n.existing_creneaux=_(i).isUndefined()?0:i.creneaux_emploi_du_temps.vides.length+i.creneaux_emploi_du_temps.pleins.length,n.edit||(n.laclasse.displayed_label=n.laclasse.libelle_aaf)}),_(e.pronote.Groupes[0].Groupe).each(function(n){if(n.displayed_label=n.Nom,n.laclasse=_(e.etablissement.groupes_eleves).findWhere({libelle_aaf:n.Nom.toUpperCase()}),_(n.laclasse).isUndefined()){var a=_(e.etablissement_summary.matchables).findWhere({hash_item:C(n)});_(a).isUndefined()||(n.laclasse=_(e.etablissement.groupes_eleves).findWhere({id:a.id_annuaire}))}n.edit=_(n.laclasse).isUndefined();var i=_(n.laclasse).isUndefined()?undefined:_(t).findWhere({regroupement_id:""+n.laclasse.id});n.existing_creneaux=_(i).isUndefined()?0:i.creneaux_emploi_du_temps.vides.length+i.creneaux_emploi_du_temps.pleins.length,n.edit||(n.laclasse.displayed_label=n.laclasse.libelle_aaf)}),o.info("traitement des donn\xe9es des cours"),e.creneaux=_.chain(e.pronote.Cours[0].Cours).map(function(t){return _.chain(t.Matiere).map(function(n){var a=function(a){return function(i){var s=angular.copy(t);return s.is_displayed=!0,s.Matiere=n,"Classe"===a?(s.Classe=i,s.Classe.Semaines=f.fix_semainier_pronote(s.Classe.Semaines,e.pronote.AnneeScolaire[0].DateDebut)):(s.Groupe=i,s.Groupe.Semaines=f.fix_semainier_pronote(s.Groupe.Semaines,e.pronote.AnneeScolaire[0].DateDebut)),_(t).has("Salle")?_(t.Salle).map(function(t){return s.Salle=t,s.Salle.Semaines=f.fix_semainier_pronote(s.Salle.Semaines,e.pronote.AnneeScolaire[0].DateDebut),s}):s}};return[_(t.Classe).map(a("Classe")),_(t.Groupe).map(a("Groupe"))]}).flatten().uniq().value()}).flatten().value(),e.pronote.classes=f.groupByKey(e.pronote.Classes[0].Classe,"Ident"),e.pronote.salles=f.groupByKey(e.pronote.Salles[0].Salle,"Ident"),e.pronote.plages_horaires=f.groupByKey(e.pronote.GrilleHoraire[0].PlacesParJour[0].Place,"Numero"),e.pronote.groupes_eleves=f.groupByKey(e.pronote.Groupes[0].Groupe,"Ident"),e.matcheable_data.push({title:"Classes",pronote:e.pronote.classes,annuaire:e.etablissement.classes}),e.matcheable_data.push({title:"Groupes d'\xe9l\xe8ves",pronote:e.pronote.groupes_eleves,annuaire:e.etablissement.groupes_eleves}),o.info("R\xe9cup\xe9ration des matieres"),m.query_subjects()},n).then(function(t){e.matieres=_(t.data).map(function(e){return _(e.name).isNull()&&(e.name=""),e.name=e.name.toUpperCase(),e.displayed_label=e.name,e}),_(e.pronote.Matieres[0].Matiere).each(function(t){if(t.displayed_label=t.Libelle,t.laclasse=_(e.matieres).findWhere({name:t.Libelle.toUpperCase()}),_(t.laclasse).isUndefined()&&_(t.laclasse).isUndefined()){var n=_(e.etablissement_summary.matchables).findWhere({hash_item:C(t)});_(n).isUndefined()||(t.laclasse=_(e.matieres).findWhere({id:n.id_annuaire}))}t.edit=_(t.laclasse).isUndefined(),t.edit||(t.laclasse.displayed_label=t.laclasse.name)}),e.pronote.matieres=f.groupByKey(e.pronote.Matieres[0].Matiere,"Ident"),e.matcheable_data.push({title:"Mati\xe8res",pronote:e.pronote.matieres,annuaire:e.matieres}),_(e.matcheable_data).each(function(e){e.total=function(){return _(e.pronote).size()},e.unmatched=function(){return _(e.pronote).where({laclasse:undefined}).length},e.percent_valid=function(){return(e.total()-e.unmatched())/e.total()}}),e.selected={matieres:e.pronote.Matieres[0].Matiere,classes:_(e.pronote.Classes[0].Classe).where({existing_creneaux:0}),groupes:_(e.pronote.Groupes[0].Groupe).where({existing_creneaux:0})},D(),e.$watchCollection("selected",function(){x()})},n).then(function(){return e.step++,l.resolve(!0)},n)},w=function(){var n=(r(),null),a=function(e){return l.reject(e)};e.report={};var i=_(e.creneaux).select(function(e){return e.ready&&e.is_displayed});return t.post(c+"/api/import/log/start/?uai="+e.pronote.UAI,{uai:e.pronote.UAI,type:"client "+p,comment:""}).then(function(t){return n=t.data.id,new g({uai:e.pronote.UAI,date_premier_jour_premiere_semaine:new Date(e.pronote.AnneeScolaire[0].DatePremierJourSemaine1),debut_annee_scolaire:new Date(e.pronote.AnneeScolaire[0].DateDebut),fin_annee_scolaire:new Date(e.pronote.AnneeScolaire[0].DateFin)}).$save()},a).then(function(n){e.report.etablissement=n;var a=function(t){return _.chain(t).reject(function(e){return _(e.laclasse).isUndefined()}).map(function(t){return{label:t.laclasse.libelle_aaf,regroupement_id:t.laclasse.id,debut_annee_scolaire:new Date(e.pronote.AnneeScolaire[0].DateDebut),fin_annee_scolaire:new Date(e.pronote.AnneeScolaire[0].DateFin)}}).value()},i=a(e.pronote.classes);return i.push(a(e.pronote.groupes_eleves)),i=_(i).flatten(),t.post(c+"/api/cahiers_de_textes/bulk",{cahiers_de_textes:i})},a).then(function(n){e.report.cahiers_de_textes=n.data,o.info("Cr\xe9ation des salles");var a=_(e.pronote.salles).map(function(t){return{uai:e.pronote.UAI,identifiant:t.Ident,nom:t.Nom}});return t.post(c+"/api/salles/bulk",{salles:a})},a).then(function(a){e.report.salles=a.data;var s=i.map(function(t){var a=f.libelleHeure_to_Moment(e.pronote.plages_horaires[t.NumeroPlaceDebut].LibelleHeureDebut),i={import_id:n,jour_de_la_semaine:parseInt(t.Jour),heure_debut:a.toISOString(),heure_fin:a.add(parseInt(t.NombrePlaces)*parseInt(e.pronote.GrilleHoraire[0].DureePlace),"minutes").toISOString(),matiere_id:e.pronote.matieres[t.Matiere.Ident].laclasse.id};return _(t).has("Salle")&&(i.salle_id=_(e.report.salles).find({identifiant:t.Salle.Ident}).id,i.semainier_salle=parseInt(t.Salle.Semaines)),_(t).has("Classe")?(i.regroupement_id=e.pronote.classes[t.Classe.Ident].laclasse.id,i.semainier_regroupement=parseInt(t.Classe.Semaines)):(i.regroupement_id=e.pronote.groupes_eleves[t.Groupe.Ident].laclasse.id,i.semainier_regroupement=parseInt(t.Groupe.Semaines)),i});o.info("Import de "+s.length+" cr\xe9neaux");for(var r=[];s.length>0;)r.push(t.post(c+"/api/creneaux_emploi_du_temps/bulk/",{uai:e.pronote.UAI,creneaux_emploi_du_temps:s.splice(0,500)}));return l.all(r)},a).then(function(t){return e.report.creneaux=_.chain(t).pluck("data").flatten().value(),l.resolve(e.report)},a)};e.match_this=function(e,t){var n=_(e.laclasse).has("ent_id")?e.laclasse.ent_id:e.laclasse.id;new b({uai:t,hash_item:C(e),id_annuaire:n}).$save().then(function(){D()})},e.unmatch_this=function(e,t){b.$delete({uai:t,hash_item:C(e)}).then(function(){e.laclasse=null,D()})},e.process_load=function(e){swal({title:"Chargement des donn\xe9es...",text:"traitement en cours",type:"info",showLoaderOnConfirm:!0,onOpen:function(){swal.clickConfirm()},preConfirm:function(){return new Promise(function(){E(e).then(function(){swal.closeModal()},function(e){console.log(e),swal.closeModal(),swal({title:"Erreur :(",text:e.data.error,type:"error"})})})},allowOutsideClick:!1})},e.validate_matches=function(){e.step++},e.process_import=function(){swal({title:"Import des donn\xe9es...",text:"traitement en cours",type:"info",showLoaderOnConfirm:!0,allowOutsideClick:!1,onOpen:function(){swal.clickConfirm()},preConfirm:function(){return new Promise(function(){w().then(function(){swal.closeModal(),e.step=0,swal({title:"Import termin\xe9",html:"",type:"success"})},function(e){console.log(e),swal.closeModal(),swal({title:"Erreur :(",text:e.data.error,type:"error"})})})}})}}]),angular.module("cahierDeTextesClientApp").controller("IndexCtrl",["$scope","$state","User",function(e,t,n){var a=e;n.get_user().then(function(e){switch(e.data.profil_actif.type){case"DIR":a.tabs=[{heading:"Validation des saisies par enseignant",uisref:"enseignants",css_class:"glyphicon glyphicon-user",active:!0},{heading:"Emplois du Temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!1},{heading:"Import Pronote",uisref:"import",css_class:"glyphicon glyphicon-import",active:!1}];break;case"ENS":a.tabs=[{heading:"Cahier de textes",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0},{heading:"Statistiques",uisref:"stats",css_class:"glyphicon glyphicon-stats",active:!1}];break;case"TUT":case"ELV":a.tabs=[{heading:"Emploi du temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0},{heading:"Liste des devoirs",uisref:"devoirs",css_class:"glyphicon glyphicon-list",active:!1}];break;case"ADM":a.tabs=[{heading:"Emplois du Temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0},{heading:"Import Pronote",uisref:"import",css_class:"glyphicon glyphicon-import",active:!1}];break;case"EVS":a.tabs=[{heading:"Emplois du Temps",uisref:"emploi_du_temps",css_class:"glyphicon glyphicon-calendar",active:!0}];break;default:a.tabs=[]}_(a.tabs).each(function(e){e.active=e.uisref==t.current.name}),a.set_active_tab=function(e){_(a.tabs).each(function(t){t.active=t.uisref==e})},a.set_active_tab(a.tabs[0].uisref),t.go(a.tabs[0].uisref)})}]),angular.module("cahierDeTextesClientApp").controller("PopupDisplayCtrl",["$scope","$sce","$uibModalInstance","toastr","APP_PATH","Cours","Devoirs","User","titre","cours","devoirs",function(e,t,n,a,i,s,r,o,l,c,u){e.app_path=i,e.matiere=l,e.date=null,_(c).isNull()||(e.cours=new s(c),e.date=e.cours.date_cours,_(c.devoirs).each(function(e){e.tooltip=e.contenu,e.temps_estime>0&&(e.tooltip='<span><i class="picto temps"></i>'+5*e.temps_estime+" minutes</span><hr>"+e.tooltip),e.tooltip=t.trustAsHtml(e.tooltip)})),e.devoirs=u.map(function(e){return e.matiere=l,new r(e)}),_(e.date).isNull()&&!_(e.devoirs).isEmpty()&&(e.date=e.devoirs[0].date_due),e.fermer=function(){n.close(e)},o.get_user().then(function(t){e.current_user=t.data})}]),angular.module("cahierDeTextesClientApp").controller("PopupEditionCtrl",["$scope","$filter","$q","$sce","$uibModalInstance","$locale","toastr","moment","APP_PATH","URL_DOCS","SEMAINES_VACANCES","ZONE","POPUP_ACTIONS","LOCALHOST","Documents","API","CreneauxEmploiDuTemps","Cours","Devoirs","User","Utils","cours","devoirs","creneau","raw_data","classes","matieres",function(e,t,n,a,i,s,r,o,l,c,u,d,p,m,f,g,h,v,b,y,x,D,C,E,w,k,T){var A=e;A.scope=A,A.correctTimeZoneToGMT=function(e){var t=new Date(e).getTimezoneOffset()/60;return e.setHours(e.getHours()+t),e},A.app_path=l,A.ZONE=d,A.jours=_(s.DATETIME_FORMATS.DAY).indexBy(function(e){return _(s.DATETIME_FORMATS.DAY).indexOf(e)}),A.classes=k,A.matieres=_(T).sortBy("name"),A.faulty_docs_app=!1,A.erreurs=[],A.dirty=!1,A.mode_duplication=!1,A.actions_done=[],A.creneau=E,A.creneau.jour_de_la_semaine=""+A.creneau.jour_de_la_semaine,A.mode_edition_creneau=A.creneau.en_creation,A.creneau.regroupement_id=parseInt(A.creneau.regroupement_id),A.creneau.previous_regroupement_id=A.creneau.regroupement_id,A.creneau.vierge=_(E.vierge).isUndefined(),A.selected_regroupement=_(A.creneau.regroupement_id).isUndefined()?_(A.classes).first():_(A.classes).findWhere({id:parseInt(A.creneau.regroupement_id)}),A.selected_matiere=_(A.creneau.matiere_id).isEmpty()?_(A.matieres).first():_(A.matieres).findWhere({id:A.creneau.matiere_id}),A.creneau.en_creation?(A.creneau.tmp_heure_debut=A.correctTimeZoneToGMT(A.creneau.heure_debut),A.creneau.tmp_heure_fin=A.correctTimeZoneToGMT(A.creneau.heure_fin)):(A.creneau.tmp_heure_debut=angular.copy(A.creneau.heure_debut),
A.creneau.tmp_heure_fin=angular.copy(A.creneau.heure_fin),_(A.creneau.regroupements).each(function(e){e.regroupement_id=parseInt(e.regroupement_id)})),A.creneau.tmp_heure_debut=o(A.creneau.tmp_heure_debut),A.creneau.tmp_heure_fin=o(A.creneau.tmp_heure_fin),A.creneau.n_week=o(A.creneau.tmp_heure_debut).week();var I=function(){};A.formateCreneau=function(e){var n="";return _(e).has("start")?n+=t("amDateFormat")(e.start,"ddd DD MMM HH:mm")+" - "+t("amDateFormat")(e.end,"HH:mm"):n+=t("amDateFormat")(e.heure_debut,"ddd DD MMM HH:mm")+" - "+t("amDateFormat")(e.heure_fin,"HH:mm"),n},A.correctTimeZone=function(e){e=new Date(e);var t=e.getTimezoneOffset()/60;return e.setHours(e.getHours()-t),e};var P=function(e){var t=new v({creneau_emploi_du_temps_id:e.id,date_cours:new Date(e.heure_debut).toISOString(),date_validation:null,enseignant_id:A.current_user.id,contenu:""});return t.devoirs=[],t.create=!0,t};A.is_dirty=function(e){e=_(e).isUndefined()||_(e).isNull()?null:e,A.dirty=A.dirty||_(e).isNull()||!_(e).isNull()&&e.contenu.length>0,_(e).isNull()||(e.dirty=!0)},A.overlay_semainier=x.overlay_semainier(),A.sont_ce_les_vacances=x.sont_ce_les_vacances;var S=function(){var e=[];return _(52).times(function(t){x.sont_ce_les_vacances(t+1,d)?e.push(0):e.push(1)}),e};if(A.semaines_actives={regroupement:[]},A.templates_semainier=[{label:"Tout",apply:function(){A.semaines_actives.regroupement=S()}},{label:"Semaine A",apply:function(){var e=[],t=0;_(52).times(function(n){x.sont_ce_les_vacances(n+1,d)?t=0:t++,e.push(t%2==1?1:0)}),A.semaines_actives.regroupement=e}},{label:"Semaine B",apply:function(){var e=[],t=0;_(52).times(function(n){x.sont_ce_les_vacances(n+1,d)?t=0:t++,e.push(t%2==0?1:0)}),A.semaines_actives.regroupement=e}},{label:"Unique",apply:function(){var e=[];_(52).times(function(t){e.push(t+1==A.creneau.n_week?1:0)}),A.semaines_actives.regroupement=e}},{label:"Inverser",apply:function(){A.semaines_actives.regroupement=_(A.semaines_actives.regroupement).map(function(e,t){return 0!=e||x.sont_ce_les_vacances(t+1,d)?0:1})}},{label:"R\xe9initialiser",apply:function(){A.semaines_actives.regroupement=A.creneau.en_creation?S():x.fixnum_to_bitfield(E.semainier)}}],_(A.templates_semainier).findWhere({label:"R\xe9initialiser"}).apply(),A.fermer=function(){i.close(A)},A.effacer_creneau=function(){var e=function(){h["delete"]({id:A.creneau.id,date_creneau:A.creneau.heure_debut}).$promise.then(function(){A.actions_done.push(p.CRENEAU_DELETED),A.fermer()})};A.dirty?swal({title:"Ceci supprimera le cr\xe9neau \xe0 compter du "+t("amDateFormat")(E.heure_debut,"dddd D MMMM YYYY"),text:"Le cr\xe9neau avec ses s\xe9quences p\xe9dagogiques et devoirs associ\xe9s restera visible pour les dates ant\xe9rieures.",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b55",confirmButtonText:"Confirmer",cancelButtonText:"Annuler"}).then(e,I):e()},A.annuler=function(){var e=function(){A.creneau.en_creation?A.effacer_creneau():(A.dirty=!1,0==A.actions_done.length&&A.actions_done.push(p.CANCELLED),A.fermer())};A.dirty?swal({title:"\xcates-vous sur ?",text:"Les modifications que vous avez faites dans cette fen\xeatre seront perdues.",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b55",confirmButtonText:"Confirmer",cancelButtonText:"Annuler"}).then(e,I):e()},A.valider=function(){A.erreurs=[];var e=[];if(A.mode_edition_creneau){if(A.creneau.matiere_id=A.selected_matiere.id,A.creneau.regroupement_id=A.selected_regroupement.id,A.creneau.tmp_heure_debut>A.creneau.tmp_heure_fin){var t=A.creneau.tmp_heure_debut;A.creneau.tmp_heure_debut=A.creneau.tmp_heure_fin,A.creneau.tmp_heure_fin=t}A.creneau.heure_debut=A.correctTimeZone(A.creneau.tmp_heure_debut),A.creneau.heure_fin=A.correctTimeZone(A.creneau.tmp_heure_fin),A.creneau.semainier_regroupement=x.bitfield_to_fixnum(A.semaines_actives.regroupement),A.creneau.$update(),A.actions_done.push(p.CRENEAU_MODIFIED)}else{var a=function(t,a){_.chain(t).where({dirty:!0}).each(function(t){var i=n.defer(),s=function(e){A.erreurs.unshift({status:e.status,message:e.data.error}),i.reject(e)},r=function(e){return function(n){t.id=n.id,i.resolve(n),A.actions_done.push(e)}};t.create?(t.regroupement_id=A.selected_regroupement.id,_(a).isNull()||(t.cours_id=a.id),_(t).has("contenu")||(t.contenu=""),t.$save().then(r(p.DEVOIR_CREATED),s)):t.$update().then(r(p.DEVOIR_MODIFIED),s),e.push(i.promise)})};if(A.cours.contenu.length>0||_(A.cours).has("ressources")&&A.cours.ressources.length>0||A.cours.devoirs.length>0){var i=_(A.cours.devoirs).map(function(e){return new b(e)});if(A.cours.editable){var s=n.when(!0);A.cours.create?(A.cours.regroupement_id=A.selected_regroupement.id,A.cours.creneau_emploi_du_temps_id=A.creneau.id,s=A.cours.$save(),A.actions_done.push(p.SEQUENCE_PEDAGOGIQUE_CREATED)):(s=A.cours.$update(),A.actions_done.push(p.SEQUENCE_PEDAGOGIQUE_MODIFIED)),i.length>0&&s.then(function(e){a(i,e)})}else a(i,A.cours)}a(A.devoirs,null)}n.all(e).then(A.fermer)},!A.creneau.en_creation){A.estimation_over=function(e,t){e.overValue=t,e.minutes=5*t},A.estimation_leave=function(e){A.estimation_over(e,e.temps_estime)},A.types_de_devoir=g.query_types_de_devoir();var $=function(e){A.cours=v.get({id:e.id}),A.cours.$promise.then(function(e){A.cours.editable=_(A.cours.date_validation).isNull()&&_(["ENS","DOC"]).includes(A.current_user.profil_actif.type)&&A.cours.enseignant_id===A.current_user.id,A.cours.editable||(A.cours.contenu=a.trustAsHtml(A.cours.contenu)),e.devoirs=_.chain(e.devoirs).select(function(e){return _.chain(C).findWhere({id:e.id}).isUndefined().value()}).map(function(e){return b.get({id:e.id})}).value(),_(e.devoirs).each(function(e){e.$promise.then(function(e){A.estimation_leave(e),e.tooltip="<em>"+t("amDateFormat")(e.date_due,"dddd D MMMM YYYY")+"</em><hr />"+e.contenu,e.temps_estime>0&&(e.tooltip='<span><i class="picto temps"></i>'+5*e.temps_estime+" minutes</span><hr />"+e.tooltip),e.tooltip=a.trustAsHtml("<div>"+e.tooltip+"</div>"),A.creneau.etranger&&(e.contenu=a.trustAsHtml(e.contenu))})}),n.all(A.devoirs).then(function(){A.cours.devoirs=_(A.cours.devoirs).filter(function(e){return _.chain(A.devoirs).findWhere({id:e.id}).isUndefined().value()})}),A.cours.$promise.then(function(){_(A.cours.ressources).each(function(e){e.url=a.trustAsResourceUrl(c+"/api/connector?cmd=file&target="+e.hash)})}),_(A.cours.devoirs).each(function(e){e.$promise.then(function(){_(e.ressources).each(function(e){e.url=a.trustAsResourceUrl(c+"/api/connector?cmd=file&target="+e.hash)})})})}),A.cours.create=!1};A.devoirs=C.map(function(e){return b.get({id:e.id})}),_(A.devoirs).each(function(e){e.$promise.then(function(){A.estimation_leave(e),_(e.ressources).each(function(e){e.url=a.trustAsResourceUrl(c+"/api/connector?cmd=file&target="+e.hash)}),A.creneau.etranger&&(e.contenu=a.trustAsHtml(e.contenu))})}),A.set_creneau_date_due=function(e){var t=_(A.creneaux_devoirs_possibles).findWhere({date_due:e.date_due});e.creneau_emploi_du_temps_id=t.id,A.is_dirty(e)};var U=function(e,t,n){return g.get_creneaux_emploi_du_temps_similaires({id:e.id,debut:o(e.heure_debut.toISOString()).subtract(t,"weeks").toDate(),fin:o(e.heure_debut.toISOString()).add(n,"weeks").toDate()})};U(A.creneau,2,8).then(function(e){A.creneaux_devoirs_possibles_duplication=[],A.creneaux_similaires=_.chain(e.data).reject(function(e){return _(e.regroupement_id).isUndefined()||e.has_cours}).map(function(e){return e.classe=_(A.classes).findWhere({id:parseInt(e.regroupement_id)}),e.heure_debut=new Date(e.heure_debut),e.heure_fin=new Date(e.heure_fin),e}).value(),A.creneaux_similaires.selected=[]}),U(A.creneau,0,8).then(function(e){_(e.data).isEmpty()&&(e.data=[A.creneau]),A.creneaux_devoirs_possibles=_.chain(e.data).select(function(e){return e.regroupement_id===A.creneau.regroupement_id}).map(function(e){return e.classe=_(A.classes).findWhere({id:parseInt(e.regroupement_id)}),e.semaine=o(e.start).from(o(A.creneau.heure_debut)),e.heure_debut=new Date(e.heure_debut),e.heure_fin=new Date(e.heure_fin),e.date_due=t("date")(e.heure_debut,"y-MM-dd"),e}).sortBy(function(e){return e.start}).value(),A.creneaux_devoirs_possibles.length>1&&(A.creneaux_devoirs_possibles=_(A.creneaux_devoirs_possibles).select(function(e){return e.heure_debut.toISOString()!=A.creneau.heure_debut.toISOString()}))}),A.cartable={},A.cartable.expandedNodes=[],A.treeOptions={dirSelectable:!1},f.list_files().then(function(e){_(e.data).has("files")&&(A.cartable=e.data,A.cartable.files=_(e.data.files).select(function(e){return _(e.phash).isNull()}),A.cartable.expandedNodes=[])},function(){}),A.consume_Documents_response_callback=function(e){return function(t){if(A.erreurs=[],_(t.error).isEmpty()){var n=_(t.added).first();e.ressources.push({name:n.name,hash:n.hash,url:a.trustAsResourceUrl(c+"/api/connector?cmd=file&target="+n.hash)}),A.is_dirty(e),_(t.removed).isEmpty()||(e.ressources=_(e.ressources).reject(function(e){return _(t.removed).includes(e.hash)}))}else A.erreurs.push({message:t.error})}},A.upload_and_add_ressource=function(e,t){e.ressources==undefined&&(e.ressources=[]),f.upload_dans_cahier_de_textes(A.selected_regroupement,t).then(function(t){t.forEach(function(t){A.consume_Documents_response_callback(e)(t.data)})})},A.remove_ressource=function(e,t){e.ressources=_(e.ressources).reject(function(e){return e.hash==t}),A.is_dirty(e)},A.effacer_cours=function(){A.cours.$delete().then(function(){A.actions_done.push(p.SEQUENCE_PEDAGOGIQUE_DELETED),$(A.cours)})},A.effacer_devoir=function(e){_(e).has("id")?e.$delete().then(function(){A.actions_done.push(p.DEVOIR_DELETED)}):e.deleted=!0},A.ajout_devoir=function(e,n){_(n).isNull()||_(n).isUndefined()||A.creneaux_devoirs_possibles.length<1?n=A.creneau:"next"===n&&(n=A.creneaux_devoirs_possibles.length>1?_.chain(A.creneaux_devoirs_possibles).select(function(e){return e.heure_debut>A.creneau.heure_debut}).head().value():_(A.creneaux_devoirs_possibles).first());var a=new b({cours_id:A.cours.id,date_due:t("date")(n.heure_debut,"yyyy-MM-dd"),type_devoir_id:_(A.types_de_devoir).last().id,creneau_emploi_du_temps_id:n.id,contenu:""});a.create=!0,a.dirty=!0,e.unshift(a)},A.switch_to_duplication_mode=function(){A.mode_duplication=!0},A.ok_go_for_duplication=!1,A.are_we_go_for_duplication=function(){A.ok_go_for_duplication=!_(A.creneaux_similaires.selected).isEmpty()&&_(A.cours.devoirs).reduce(function(e,t){return e&&_(t).has("creneau_cible")},!0)},A.creneau_cible_duplication_SP_updated=function(){U(A.creneaux_similaires.selected,0,4).then(function(e){A.creneaux_devoirs_possibles_duplication=_.chain(e.data).select(function(e){return e.regroupement_id==A.creneaux_similaires.selected.regroupement_id}).map(function(e){return e.classe=_(A.classes).findWhere({id:parseInt(e.regroupement_id)}),e.date_due=t("date")(e.start,"y-MM-dd"),e.semaine=o(e.start).from(o(A.creneau.heure_debut),!0)+" plus tard",e.heure_debut=new Date(e.heure_debut),e.heure_fin=new Date(e.heure_fin),e}).value()}),A.are_we_go_for_duplication()},A.dupliquer=function(){var e=angular.copy(A.cours.devoirs);A.cours.$copie({regroupement_id:A.creneaux_similaires.selected.regroupement_id,creneau_emploi_du_temps_id:A.creneaux_similaires.selected.creneau_emploi_du_temps_id,date:A.creneaux_similaires.selected.start}).then(function(){A.actions_done.push(p.SEQUENCE_PEDAGOGIQUE_DUPLICATED),r.success("","S\xe9quence p\xe9dagogique copi\xe9e."),_(e).each(function(e){e.$copie({cours_id:A.cours.copie_id,creneau_emploi_du_temps_id:e.creneau_cible.id,date_due:e.creneau_cible.date_due}).then(function(){A.actions_done.push(p.DEVOIR_DUPLICATED),r.success("","Devoir copi\xe9."),e.creneau_cible=[]})}),A.creneaux_similaires=_(A.creneaux_similaires).reject(function(e){return e.id+e.start==A.creneaux_similaires.selected.id+A.creneaux_similaires.selected.start}),A.creneaux_similaires.selected=[],$(A.cours),swal({title:"Cr\xe9neau copi\xe9 !",type:"success",timer:2e3,showCancelButton:!1,confirmButtonColor:"#ff6b55",confirmButtonText:"Fermer"})})},A.switch_to_modification_mode=function(){A.mode_edition_creneau=!1,A.mode_duplication=!1},A.switch_to_creneau_edition=function(){A.dirty=!0,A.erreurs=[],A.mode_edition_creneau=!0}}y.get_user().then(function(e){A.current_user=e.data,A.current_user.parametrage_cahier_de_textes.affichage_week_ends||(delete A.jours[0],delete A.jours[6]),A.creneau.mine=A.creneau.en_creation||_.chain(A.current_user.profil_actif.matieres).pluck("id").include(A.creneau.matiere_id).value(),A.creneau.can_add_homework=_(["ENS","DOC"]).includes(A.current_user.profil_actif.type)&&_.chain(A.current_user.profil_actif.matieres).pluck("id").include(A.creneau.matiere_id).value(),A.creneau.etranger=!A.current_user.profil_actif.admin&&!A.creneau.en_creation&&!A.creneau.mine,_(D).isNull()?A.creneau.etranger||(A.cours=P(E),A.cours.editable=!0):$(D)})}]),angular.module("cahierDeTextesClientApp").controller("TextBookCtrl",["$scope","moment","$state","$q","$locale","APP_PATH","SEMAINES_VACANCES","ZONE","EmploisDuTemps","PopupsCreneau","CreneauxEmploiDuTemps","Utils","Annuaire","User","current_user",function(e,t,n,a,i,s,r,o,l,c,u,d,p,m,f){e.scope=e,e.current_user=f,"TUT"===e.current_user.profil_actif.type&&_(e.current_user.enfant_actif).isUndefined()&&(e.current_user.enfant_actif=e.current_user.enfants[0]),e.zone=o,e.emploi_du_temps=angular.element("#emploi_du_temps");var g=!1;e.uniquement_mes_creneaux=!_(["EVS","DIR","ADM"]).contains(e.current_user.profil_actif.type);var h=function(t){e.current_user.parametrage_cahier_de_textes.preferredView=t,m.update_parameters(e.current_user.parametrage_cahier_de_textes)};_(e.current_user.parametrage_cahier_de_textes).has("preferredView")||h("timetableWeek"),e.filter_data=function(t){return _(["EVS","DIR","ADM"]).contains(e.current_user.profil_actif.type)?x(t,e.selected_regroupements):_(["ENS","DOC"]).contains(e.current_user.profil_actif.type)?D(x(t,e.selected_regroupements),e.current_user.extract_subjects_ids(),e.uniquement_mes_creneaux):t},e.prev=function(){e.emploi_du_temps.fullCalendar("prev")},e.next=function(){e.emploi_du_temps.fullCalendar("next")},e.select_all_regroupements=function(){e.selected_regroupements=e.current_user.actual_groups,e.refresh_calendar()},e.select_no_regroupements=function(){e.selected_regroupements=[],e.refresh_calendar()};var v=function(){var t=e.emploi_du_temps.fullCalendar("getView");y(t.start.toDate(),t.end.toDate())},b=function(n){var a=function(n){var a=this;if(a.details=n,a.allDay=!1,a.regroupement=_(e.current_period_groups).findWhere({id:parseInt(a.details.regroupement_id)}),a.title=_(a.regroupement).isUndefined()?"":a.regroupement.name,a.matiere=_(e.subjects).findWhere({id:a.details.matiere_id}),a.has_resources=_(n.cours).has("ressources")&&n.cours.ressources.length>0,a.temps_estime=0,a.start=t(n.start),a.end=t(n.end),a.className="saisie-vide",_(a.matiere).isUndefined()||(a.title+=" - "+a.matiere.name),_(n.cours).isNull()||_(n.cours.devoirs).each(function(e){a.has_ressources=a.has_ressources||_(e).has("ressources")&&e.ressources.length>0}),_(n.devoirs).each(function(e){a.has_ressources=a.has_ressources||_(e).has("ressources")&&e.ressources.length>0,_(e.temps_estime).isNull()||(a.temps_estime+=e.temps_estime,a.temps_estime>15&&(a.temps_estime=15))}),n.devoirs.length>0){switch(_.chain(n.devoirs).pluck("type_devoir_id").sort().first().value()){case 1:a.className="edt-devoir-note-surveille";break;case 2:a.className="edt-devoir-note-maison";break;default:"ELV"===e.current_user.profil_actif.type&&(a.className=_.chain(n.devoirs).pluck("fait").contains(!0).value()?"edt-devoir-fait":"edt-devoir-a-faire")}}else a.className="edt-cours",_(n.cours).isNull()||_(n.cours.date_validation).isNull()||"ENS"!==e.current_user.profil_actif.type||"DOC"!==e.current_user.profil_actif.type?_(n.cours).isNull()||(a.className+="-saisie"):a.className+="-valide";_(["ELV","TUT","EVS","DIR","ADM"]).contains(e.current_user.profil_actif.type)&&_(n.cours).isNull()&&_(n.devoirs).isEmpty()?a.className+=" unclickable-event":a.className+=" clickable-event"};return _(n).map(function(e){return new a(e)})};e.refresh_calendar=function(){e.calendar.events[0]=b(e.filter_data(e.raw_data))};var y=function(t,n){("TUT"!=e.current_user.profil_actif.type||e.current_user.enfant_actif)&&l.query({debut:t,fin:n,uai:e.current_user.profil_actif.structure_id,uid:"TUT"===e.current_user.profil_actif.type?e.current_user.enfant_actif.child_id:null}).$promise.then(function(t){e.raw_data=t;var n=_.chain(e.raw_data).pluck("regroupement_id").uniq().value(),i=_.chain(e.raw_data).pluck("matiere_id").uniq().value();(_(n).isEmpty()?a.resolve([]):p.get_groups(n)).then(function(t){return e.current_period_groups=t.data,p.get_subjects(i)}).then(function(t){e.subjects=t.data,e.refresh_calendar()})})};e.current_user.get_actual_groups().then(function(){e.uniquement_mes_creneaux?e.selected_regroupements=e.current_user.actual_groups:e.selected_regroupements=[e.current_user.actual_groups[0]]}),e.extraEventSignature=function(e){return""+e.matiere};var x=function(e,t){return _(e).filter(function(e){return _.chain(t).pluck("id").contains(parseInt(e.regroupement_id)).value()})},D=function(e,t,n){return n?_(e).filter(function(e){return _(t).contains(e.matiere_id)}):e};"TUT"===e.current_user.profil_actif.type&&(0==e.current_user.enfants.length?swal({title:"Erreur",text:"Aucun enfant configur\xe9 pour ce profil.",type:"error",showCancelButton:!1,confirmButtonColor:"#ff6b55",confirmButtonText:"Fermer"}):(e.uid_enfant_actif=e.current_user.enfant_actif.child_id,e.reload_data=v));var C=_(["ENS","DOC","DIR","ADM"]).contains(e.current_user.profil_actif.type)||e.current_user.profil_actif.admin;e.calendar={options:{lang:"fr",locale:"fr",height:600,header:{left:_(["ENS","DOC"]).contains(e.current_user.profil_actif.type)?"timetableWeek,textbookWeek":"",center:"title",right:"today prev,next"},firstDay:1,minTime:"07:00:00",maxTime:"19:00:00",businessHours:{start:"7:00",end:"19:00",dow:[1,2,3,4,5]},titleFormat:"D MMM YYYY, [semaine] W",columnFormat:"dddd D",slotDuration:"00:30:00",slotEventOverlap:!1,ignoreTimezone:!1,slotLabelFormat:i.DATETIME_FORMATS.shortTime,allDaySlot:!1,theme:!1,defaultView:e.current_user.parametrage_cahier_de_textes.preferredView,editable:C,eventDurationEditable:C,eventStartEditable:C,selectable:C,selectHelper:!0,weekends:e.current_user.parametrage_cahier_de_textes.affichage_week_ends,views:{timetableWeek:{type:"agenda",duration:{weeks:1},buttonText:"Emploi du temps",displayEventTime:!1},textbookWeek:{type:"list",duration:{weeks:1},buttonText:"Liste"}},viewRender:function(t){e.current_user.date=t.start,e.c_est_les_vacances=d.sont_ce_les_vacances(t.start.week(),e.zone),t.name!==e.current_user.parametrage_cahier_de_textes.preferredView&&h(t.name),y(t.start.toDate(),t.end.toDate())},eventRender:function(t,n){var a=n.find(".fc-content");if(!_(["ELV","TUT"]).contains(e.current_user.profil_actif.type)&&t.temps_estime>0){var i="";t.temps_estime<4?i=" label-success":t.temps_estime<8?i=" label-info":t.temps_estime<12?i=" label-warning":t.temps_estime<=15&&(i=" label-danger"),a.prepend('<div class="est-time est-time-'+t.temps_estime+i+'"></div>')}t.has_resources&&a.prepend('<i class="glyphicon glyphicon-paperclip"></i>');var s=n.find(".fc-list-item-title");if(s.length>0&&(!_(t.details.cours).isNull()||!_(t.details.devoirs).isEmpty())){var r=s.html();r+="<br>",r+='<div class="col-md-6 sequence-pedagogique">',_(t.details.cours).isNull()||(r+="<fieldset>",r+="<legend>S\xe9quence p\xe9dagogique</legend>",r+=t.details.cours.contenu,r+="</fieldset>"),r+="</div>",_(t.details.devoirs).isEmpty()||(r+="<fieldset><legend>Devoirs</legend>",r+='<ul class="col-md-6 devoirs">',_(t.details.devoirs).each(function(t){var n="ELV"===e.current_user.profil_actif.type?t.fait?"fait":"a-faire":"";r+='  <li class="devoir type'+t.type_devoir_id+" "+n+'">',e.current_user.parametrage_cahier_de_textes.affichage_types_de_devoir&&(r+='    <span class="type">'+t.type_devoir_description+"</span>"),t.temps_estime>0&&(r+='    <span class="temps-estime">'+5*t.temps_estime+" minutes</span>"),r+=t.contenu,r+="  </li>"}),r+="</ul>",r+="</fieldset>"),s.html(r)}},eventClick:function(t){_(["ENS","DOC"]).contains(e.current_user.profil_actif.type)||e.current_user.profil_actif.admin?g||u.get({id:t.details.creneau_emploi_du_temps_id}).$promise.then(function(n){n.dirty=!1,n.en_creation=!1,n.heure_debut=t.start,n.heure_fin=t.end,n.regroupement_id=t.details.regroupement_id,e.current_user.get_actual_subjects().then(function(a){c.edition(e.raw_data,a,e.current_user.actual_groups,n,t.details.cours,t.details.devoirs,v,g)})}):!g&&(t.details.devoirs.length>0||!_(t.details.cours).isNull()&&_(t.details.cours).has("contenu"))&&c.display(t.matiere,t.details.cours,t.details.devoirs,v,g)},select:function(n,a){if(e.calendar.options.selectable&&e.calendar.options.editable&&e.selected_regroupements.length>0&&(a-n==18e5&&(a=t(a).add(30,"minutes").toDate()),!g)){n=new Date(n),a=new Date(a);var i=e.selected_regroupements[0].id,s=new u({regroupement_id:i,jour_de_la_semaine:n.getDay(),heure_debut:t(n).toISOString(),heure_fin:t(a).toISOString(),matiere_id:""});s.$save().then(function(){s.dirty=!0,s.en_creation=!0,s.heure_debut=n,s.heure_fin=a,s.regroupement_id=i,e.current_user.get_actual_subjects().then(function(t){c.edition(e.raw_data,t,e.current_user.actual_groups,s,null,[],v,g)}),e.emploi_du_temps.fullCalendar("unselect")})}},eventDrop:function(t){e.calendar.options.selectable&&e.calendar.options.editable&&u.update({id:t.details.creneau_emploi_du_temps_id,heure_debut:t.start.toDate(),heure_fin:t.end.toDate(),jour_de_la_semaine:t.end.day()})},eventResize:function(t){e.calendar.options.selectable&&e.calendar.options.editable&&u.update({id:t.details.creneau_emploi_du_temps_id,heure_debut:t.start.toDate(),heure_fin:t.end.toDate()})}},events:[]}}]),angular.module("cahierDeTextesClientApp").constant("LOCALHOST",!1).constant("ZONE","A").constant("POPUP_ACTIONS",{CANCELLED:"CANCELLED",CRENEAU_DELETED:"CRENEAU_DELETED",CRENEAU_MODIFIED:"CRENEAU_MODIFIED",SEQUENCE_PEDAGOGIQUE_CREATED:"SEQUENCE_PEDAGOGIQUE_CREATED",SEQUENCE_PEDAGOGIQUE_MODIFIED:"SEQUENCE_PEDAGOGIQUE_MODIFIED",SEQUENCE_PEDAGOGIQUE_DUPLICATED:"SEQUENCE_PEDAGOGIQUE_DUPLICATED",SEQUENCE_PEDAGOGIQUE_DELETED:"SEQUENCE_PEDAGOGIQUE_DELETED",DEVOIR_CREATED:"DEVOIR_CREATED",DEVOIR_MODIFIED:"DEVOIR_MODIFIED",DEVOIR_DUPLICATED:"DEVOIR_DUPLICATED",DEVOIR_DELETED:"DEVOIR_DELETED"}).constant("MULTIBARCHART_DEFINITION",{data:[],options:{chart:{type:"multiBarChart",height:240,showControls:!1,showLegend:!0,showLabels:!0,stacked:!1,duration:500,reduceXTicks:!1,rotateLabels:-45,labelSunbeamLayout:!0,color:function(e){return{"saisies non vis\xe9es":"#aaffaa","saisies vis\xe9es":"#00ff00"}[e.key]}}}}).constant("PIECHART_DEFINITION",{data:[{label:"saisie",value:0},{label:"valide",value:0}],options:{chart:{type:"pieChart",height:128,x:function(e){return e.label},y:function(e){return e.value},color:function(e){return{"saisies non vis\xe9es":"#aaffaa","saisies vis\xe9es":"#00ff00"}[e.label]},showLabels:!1,showLegend:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0}}}),angular.module("cahierDeTextesClientApp").factory("RecursionHelper",["$compile",function(e){return{compile:function(t,n){angular.isFunction(n)&&(n={post:n});var a,i=t.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(t,s){a||(a=e(i)),a(t,function(e){s.append(e)}),n&&n.post&&n.post.apply(null,arguments)}}}}}]).directive("cartable",["RecursionHelper",function(e){return{scope:{racine:"=racine",target:"=target",regroupement:"=regroupement",addCallback:"=addCallback"},replace:!0,controller:["$scope","$sce","URL_DOCS","Documents",function(e,t,n,a){var i=e;i.$ctrl=i,i.getChildren=function(e){a.list_files(e.hash).then(function(t){e.children=_(t.data.files).rest()})},i.add_ressource_to_target=function(e,t,n){e.ressources===undefined&&(e.ressources=[]),_(e.ressources).findWhere({hash:t.hash})===undefined&&a.ajout_au_cahier_de_textes(n,t).then(i.addCallback(e),function(e){console.debug(e.error)})},i.add_ressource_already_in_CT_to_target=function(e,a){e.ressources.push({name:a.name,hash:a.hash,url:t.trustAsResourceUrl(n+"/api/connector?cmd=file&target="+a.hash)})}}],template:'<ul class="cartable">                              <li ng:repeat="node in $ctrl.racine"                          ng:class="{\'disabled\': node.name == \'Cahier de textes.ct\'}"                          style="list-style-type: none">                              <span class="glyphicon"                          ng:class="{\'glyphicon-folder-open\': node.children, \'glyphicon-folder-close\': !node.children}"                          ng:if="node.mime == \'directory\'"                          ng:click="$ctrl.getChildren( node )">        {{node.name}}    </span>    <button class="btn btn-sm btn-success from-docs"            style="padding:top: 0; padding:bottom: 0"            ng:if="node.mime != \'directory\'"            ng:click="$ctrl.add_ressource_to_target( $ctrl.target, node, $ctrl.regroupement )">      <span class="glyphicon glyphicon-plus"></span>    </button>    <button class="btn btn-sm btn-success from-ct"            style="padding:top: 0; padding:bottom: 0"            ng:if="node.mime != \'directory\'"            ng:click="$ctrl.add_ressource_already_in_CT_to_target( $ctrl.target, node )">      <span class="glyphicon glyphicon-plus"></span>    </button>    <span class="glyphicon glyphicon-file" ng:if="node.mime != \'directory\'">        {{node.name}} <span ng:if="node.mime != \'directory\'">({{node.mime}})</span>    </span>    <div cartable         ng:if="node.mime == \'directory\'"         racine="node.children"         target="$ctrl.target"         regroupement="$ctrl.regroupement"         add-callback="$ctrl.addCallback">    </div>  </li></ul>',compile:e.compile}}]),angular.module("cahierDeTextesClientApp").directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var i=e(a.fileModel),s=i.assign;n.bind("change",function(){t.$apply(function(){s(t,n[0].files[0])})})}}}]),angular.module("cahierDeTextesClientApp").config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){return{response:function(e){return e},responseError:function(t){return 401===t.status&&swal({title:"Erreur",text:"Votre session a expir\xe9e.",type:"error",showCancelButton:!1,confirmButtonColor:"#ff6b55",confirmButtonText:"Fermer",timer:3e3}),e.reject(t)}}}])}]),angular.module("cahierDeTextesClientApp").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("404",{url:"404",templateUrl:"app/views/404.html"}).state("index",{url:"/",templateUrl:"app/views/index.html",controller:"IndexCtrl",resolve:{auth:["Redirection",function(e){e.doorman(["ADM","DIR","ENS","DOC","ELV","TUT","EVS"])}],current_user:["User",function(e){return e.get_user().then(function(e){return e.data})}]}}).state("emploi_du_temps",{parent:"index",url:"emploi_du_temps",views:{content:{templateUrl:"app/views/textbook.html",controller:"TextBookCtrl"}}}).state("devoirs",{parent:"index",url:"devoirs",resolve:{auth:["Redirection",function(e){e.doorman(["ELV","TUT"])}]},views:{content:{templateUrl:"app/views/assignements.html",controller:"AssignementsCtrl"}}}).state("import",{parent:"index",url:"import",resolve:{auth:["Redirection",function(e){e.doorman(["DIR","ADM"])}]},views:{content:{templateUrl:"app/views/import.html",controller:"ImportCtrl"}}}).state("enseignants",{parent:"index",url:"enseignants",resolve:{auth:["Redirection",function(e){e.doorman(["DIR"])}]},views:{content:{templateUrl:"app/views/dashboard_teachers.html",controller:"DashboardTeachersCtrl"}}}).state("enseignant",{parent:"index",url:"enseignants/:enseignant_id",resolve:{auth:["Redirection",function(e){e.doorman(["DIR"])}]},views:{content:{templateUrl:"app/views/dashboard_teacher.html",controller:"DashboardTeacherCtrl"}}}).state("stats",{parent:"index",url:"stats",resolve:{auth:["Redirection",function(e){e.doorman(["ENS","DOC"])}]},views:{content:{templateUrl:"app/views/dashboard_teacher.html",controller:"DashboardTeacherCtrl"}}})}]).run(["$rootScope","log",function(e,t){e.$on("$stateChangeSuccess",function(){t.add("CTXT",null,null)})}]),angular.module("cahierDeTextesClientApp").service("Annuaire",["$http","$q","URL_ENT",function(e,t,n){var a=this,i=function(e){switch(e){case"CLS":return"Classe";case"GRP":return"Groupe";case"GPL":return"Groupe libre";default:return""}};a.query_subjects=_.memoize(function(){return e.get(n+"/api/subjects")}),a.get_subject=_.memoize(function(t){return e.get(n+"/api/subjects/"+t)}),a.get_subjects=_.memoize(function(t){return e.get(n+"/api/subjects/",{params:{"id[]":t}})}),a.get_structure=_.memoize(function(t){return e.get(n+"/api/structures/"+t)}),a.get_group=_.memoize(function(a){return e.get(n+"/api/groups/"+a+"?expand=false").then(function(e){return e.data.full_type=i(e.data.type),t.resolve(e)})}),a.get_groups=_.memoize(function(a){return _(a).isEmpty()?t.resolve({data:[]}):e.get(n+"/api/groups/",{params:{"id[]":a}}).then(function(e){return e.data=e.data.map(function(e){return e.full_type=i(e.type),e}),t.resolve(e)})}),a.get_groups_of_structures=_.memoize(function(a){return e.get(n+"/api/groups/",{params:{"structure_id[]":a}}).then(function(e){return e.data=e.data.map(function(e){return e.full_type=i(e.type),e}),t.resolve(e)})}),a.get_user=_.memoize(function(i){return e.get(n+"/api/users/"+i).then(function(e){return e.data.profil_actif=_(e.data.profiles).findWhere({active:!0}),e.data.get_actual_groups=function(){return a.get_groups(_(e.data.groups).pluck("group_id")).then(function(e){return t.resolve(e.data)})},e.data.get_actual_subjects=function(){return a.get_subjects(_(e.data.groups).pluck("subject_id")).then(function(e){return t.resolve(e.data)})},e})}),a.get_users=_.memoize(function(t){return e.get(n+"/api/users/",{params:{"id[]":t}})})}]),angular.module("cahierDeTextesClientApp").service("User",["$http","$q","APP_PATH","Annuaire",function(e,t,n,a){this.get_user=_.memoize(function(){return e.get(n+"/api/users/current").then(function(e){if(_(e.data.profils).each(function(t){t.regroupements=_.chain(e.data.regroupements).filter(function(e){return e.etablissement_code==t.structure_id}).map(function(e){return{id:e.id,libelle:e.name,type:e.type}}).uniq(function(e){return e.id}).reject(function(e){return _.isUndefined(e.id)}).value()}),e.data.profil_actif=_(e.data.profils).findWhere({active:!0}),e.data.profil_actif.admin=!_.chain(e.data.profils).findWhere({structure_id:e.data.profil_actif.structure_id,type:"ADM"}).isUndefined().value(),e.data.enfants.length>0){var n=e.data.enfants.map(function(e){return a.get_user(e.child_id).then(function(t){e.enfant=t.data})});t.all(n).then(function(){e.data.enfant_actif=e.data.enfants[0]})}return e.data.get_actual_groups=function(){var n=_.chain(e.data.groups).pluck("group_id").uniq().value(),i=t.resolve([]);return i=_(["EVS","DIR","ADM"]).contains(e.data.profil_actif.type)||e.data.profil_actif.admin?a.get_groups_of_structures([e.data.profil_actif.structure_id]):a.get_groups(n),i.then(function(n){return e.data.actual_groups=_(n.data).select(function(t){return t.structure_id===e.data.profil_actif.structure_id}),t.resolve(e.data.actual_groups)})},e.data.extract_subjects_ids=function(){return _.chain(e.data.groups).pluck("subject_id").uniq().value()},e.data.get_actual_subjects=function(){return a.get_subjects(e.data.extract_subjects_ids()).then(function(n){return e.data.actual_subjects=n.data,t.resolve(e.data.actual_subjects)})},e.data.is=function(e){return this.profil_actif.type==e},e})}),this.update_parameters=function(t){return e.put(n+"/api/users/current/parametres",{parameters:JSON.stringify(t)})}}]).factory("StatistiquesRegroupements",["$resource","APP_PATH",function(e,t){return e(t+"/api/etablissements/:uai/statistiques/regroupements/:id",{uai:"@uai",id:"@id"})}]).factory("Cours",["$resource","APP_PATH",function(e,t){return e(t+"/api/cours/:id",{id:"@id"},{update:{method:"PUT"},valide:{method:"PUT",url:t+"/api/cours/:id/valide"},copie:{method:"PUT",url:t+"/api/cours/:id/copie/regroupement/:regroupement_id/creneau_emploi_du_temps/:creneau_emploi_du_temps_id/date/:date",params:{id:"@id",regroupement_id:"@regroupement_id",creneau_emploi_du_temps_id:"@creneau_emploi_du_temps_id",date:"@date"}}})}]).factory("CreneauxEmploiDuTemps",["$resource","APP_PATH",function(e,t){return e(t+"/api/creneaux_emploi_du_temps/:id",{id:"@id",regroupement_id:"@regroupement_id",previous_regroupement_id:"@previous_regroupement_id",jour_de_la_semaine:"@jour_de_la_semaine",heure_debut:"@heure_debut",heure_fin:"@heure_fin",matiere_id:"@matiere_id",semainier_regroupement:"@semainier_regroupement",semainier_salle:"@semainier_salle"},{update:{method:"PUT"},"delete":{method:"DELETE",params:{id:"@id",date_creneau:"@date_creneau"}},bulk:{method:"POST",
isArray:!0,url:t+"/api/creneaux_emploi_du_temps/bulk",params:{creneaux_emploi_du_temps:"@creneaux_emploi_du_temps"}},bulk_delete:{method:"DELETE",isArray:!0,url:t+"/api/creneaux_emploi_du_temps/bulk",params:{ids:"@ids",date_creneau:"@date_creneau"}}})}]).factory("Devoirs",["$resource","APP_PATH",function(e,t){return e(t+"/api/devoirs/:id",{id:"@id",uid:"@uid"},{update:{method:"PUT"},fait:{method:"PUT",url:t+"/api/devoirs/:id/fait"},copie:{method:"PUT",url:t+"/api/devoirs/:id/copie/cours/:cours_id/creneau_emploi_du_temps/:creneau_emploi_du_temps_id/date_due/:date_due",params:{id:"@id",cours_id:"@cours_id",creneau_emploi_du_temps_id:"@creneau_emploi_du_temps_id",date_due:"@date_due"}}})}]).factory("EmploisDuTemps",["$resource","APP_PATH",function(e,t){return e(t+"/api/emplois_du_temps",{debut:"@debut",fin:"@fin",uid:"@uid"})}]).factory("Enseignants",["$resource","APP_PATH",function(e,t){return e(t+"/api/etablissements/:uai/statistiques/enseignants/:enseignant_id",{uai:"@uai",enseignant_id:"@enseignant_id"})}]).factory("Etablissements",["$resource","APP_PATH",function(e,t){return e(t+"/api/etablissements/:uai",{uai:"@uai"})}]).factory("Salles",["$resource","APP_PATH",function(e,t){return e(t+"/api/salles/:id",{id:"@id"},{bulk:{method:"POST",isArray:!0,url:t+"/api/salles/bulk",params:{salles:"@salles"}}})}]).factory("CahiersDeTextes",["$resource","APP_PATH",function(e,t){return e(t+"/api/cahiers_de_textes/:id",{id:"@id"},{bulk:{method:"POST",isArray:!0,url:t+"/api/cahiers_de_textes/bulk",params:{cahiers_de_textes:"@cahiers_de_textes"}}})}]).factory("TypesDeDevoir",["$resource","APP_PATH",function(e,t){return e(t+"/api/types_de_devoir/:id",{id:"@id"})}]).factory("Matchable",["$resource","APP_PATH",function(e,t){return e(t+"/api/matchables/:uai/:hash_item",{uai:"@uai",hash_item:"@hash_item",id_annuaire:"@id_annuaire"})}]),angular.module("cahierDeTextesClientApp").service("API",["$http","APP_PATH","StatistiquesRegroupements","Cours","CreneauxEmploiDuTemps","Devoirs","EmploisDuTemps","Enseignants","Etablissements","TypesDeDevoir",function(e,t,n,a,i,s,r,o,l,c){this.get_etablissement=function(e){return l.get(e)},this.query_statistiques_regroupements=function(e){return n.query(e)},this.query_types_de_devoir=_.memoize(function(){return c.query()}),this.get_type_de_devoir=_.memoize(function(e){return c.get({id:e})}),this.query_emplois_du_temps=function(){return r.query()},this.get_creneau_emploi_du_temps=function(e){return i.get(e)},this.get_creneaux_emploi_du_temps_similaires=function(n){return e.get(t+"/api/creneaux_emploi_du_temps/"+n.id+"/similaires?debut="+n.debut.toISOString()+"&fin="+n.fin.toISOString())},this.query_enseignants=function(e){return o.query(e)},this.get_enseignant=function(e){return o.get(e)},this.get_cours=function(e){return a.get(e)},this.query_devoirs=function(e){return s.query(e)},this.get_devoir=function(e){return s.get(e)}}]),angular.module("cahierDeTextesClientApp").service("Documents",["$http","$q","URL_DOCS","Annuaire",function(e,t,n,a){var i=this;i.list_files=_.memoize(function(t){var a={cmd:"open",target:""};return t==undefined?a.tree=1:a.target=t,e.get(n+"/api/connector",{params:a})}),i.get_ctxt_folder_hash=_.memoize(function(e){var t,n,s,r,o;return a.get_structure(e.structure_id).then(function(e){return t=e.data,i.list_files()}).then(function(e){return n=_(e.data.files).findWhere({phash:null,name:t.name}),i.list_files(n.hash)}).then(function(e){return s=_(e.data.files).findWhere({phash:n.hash,name:"classes"}),i.list_files(s.hash)}).then(function(t){return r=_(t.data.files).findWhere({phash:s.hash,name:e.name}),i.list_files(r.hash)}).then(function(e){return o=_(e.data.files).findWhere({phash:r.hash,name:"Cahier de textes.ct"}),o.hash})}),i.ajout_au_cahier_de_textes=function(t,a){return i.get_ctxt_folder_hash(t).then(function(t){var i={cmd:"paste","targets[]":a.hash,"renames[]":a.name,dst:t,cut:!1};return e.get(n+"/api/connector",{params:i})}).then(function(e){return e.data})},i.upload_dans_cahier_de_textes=function(a,s){return i.get_ctxt_folder_hash(a).then(function(a){return t.all(_(s).map(function(t){var i=new FormData;return i.append("cmd","upload"),i.append("target",a),i.append("upload[]",t),i.append("renames[]",t.name),e.post(n+"/api/connector",i,{headers:{"Content-Type":undefined},transformRequest:angular.identity})})).then(function(e){return e})})}}]),angular.module("cahierDeTextesClientApp").service("fileUpload",["$http",function(e){this.uploadFileToUrl=function(t,n,a){var i=new FormData;return i.append("file",t),_.chain(a).keys().each(function(e){i.append(e,a[e])}),e.post(n,i,{transformRequest:angular.identity,headers:{"Content-Type":undefined}})}}]),angular.module("cahierDeTextesClientApp").service("PopupsCreneau",["$uibModal","toastr","POPUP_ACTIONS",function(e,t,n){var a=function(a,i,s){s=!0,e.open(a).result.then(function(e){_(e.actions_done).each(function(e){switch(e){case n.CANCELLED:t.info("","Annulation.");break;case n.CRENEAU_DELETED:t.info("","Cr\xe9neau supprim\xe9.");break;case n.CRENEAU_MODIFIED:t.info("","Cr\xe9neau mis \xe0 jour.");break;case n.SEQUENCE_PEDAGOGIQUE_CREATED:t.success("","S\xe9quence p\xe9dagogique cr\xe9\xe9e.");break;case n.SEQUENCE_PEDAGOGIQUE_MODIFIED:t.success("","S\xe9quence p\xe9dagogique modifi\xe9e.");break;case n.SEQUENCE_PEDAGOGIQUE_DUPLICATED:break;case n.SEQUENCE_PEDAGOGIQUE_DELETED:t.success("","S\xe9quence p\xe9dagogique supprim\xe9e.");break;case n.DEVOIR_CREATED:t.success("","Devoir cr\xe9\xe9.");break;case n.DEVOIR_MODIFIED:t.success("","Devoir modifi\xe9.");break;case n.DEVOIR_DUPLICATED:break;case n.DEVOIR_DELETED:t.success("","Devoir supprim\xe9.")}}),i(e)})["finally"](function(){s=!1})};this.edition=function(e,t,n,i,s,r,o,l){a({templateUrl:"app/views/popup_edition.html",controller:"PopupEditionCtrl",resolve:{raw_data:function(){return e},matieres:function(){return t},classes:function(){return n},creneau:function(){return i},cours:function(){return s},devoirs:function(){return r}},backdrop:"static"},o,l)},this.display=function(e,t,n,i,s){a({templateUrl:"app/views/popup_display.html",controller:"PopupDisplayCtrl",resolve:{titre:function(){return e},cours:function(){return t},devoirs:function(){return n}},backdrop:"static"},i,s)}}]),angular.module("cahierDeTextesClientApp").service("Redirection",["$state","User",function(e,t){this.doorman=function(n){t.get_user().then(function(t){if(0===_(n).size()||-1===_(n).indexOf(t.data.profil_actif.type)&&!t.data.profil_actif.admin){var a="404";switch(t.data.profil_actif.type){case"DIR":a="enseignants";break;case"ADM":case"EVS":case"ENS":case"DOC":case"TUT":case"ELV":a="emploi_du_temps"}e.go(a,e.params,{reload:!0,inherit:!0,notify:!0})}})}}]),angular.module("cahierDeTextesClientApp").service("Utils",["$locale","moment","SEMAINES_VACANCES",function(e,t,n){var a=this;this.school_year_start=function(){var e=t(),n=t();return e.month()+1>8?n.set("year",e.year()):n.set("year",e.year()-1),n.set("month",8),n.set("date",1),n},this.school_year_end=function(){var e=t(),n=t();return e.month()+1>8?n.set("year",e.year()+1):n.set("year",e.year()),n.set("month",6),n.set("date",7),n},this.is_in_school_year=function(e){return e=t(e),e.isAfter(this.school_year_start())&&e.isBefore(this.school_year_end())},this.sont_ce_les_vacances=function(e,t){return-1!=n[t].indexOf(e)},this.what_month=function(e){var n=t(),a=n.year();return e<36&&n.month()>7?a++:n.month()<7&&a--,t(a).isoWeek(e).month()},this.fix_semainier_pronote=function(e,n){var i=52,s=parseInt(e).toString(2);s=a.padStart(s,i+1,"0"),s=s.substr(0,i).split("").reverse().join("");var r=i-t(new Date(n)).week(),o=s.slice(r,i)+s.substr(0,r);return o=o.split("").reverse().join(""),parseInt(o,2)},this.overlay_semainier=function(){return _.chain(_.range(1,52)).map(function(e){return{semaine:e,mois:a.what_month(e)}}).groupBy(function(e){return e.mois}).toArray().map(function(t,n){return{index:n>7?n-8:n+4,label:e.DATETIME_FORMATS.MONTH[n],semaines:t}}).value()},this.groupByKey=function(e,t){return _.chain(e).map(function(e){return e[t]}).object(e).value()},this.padEnd=function(e,t,n){if(e.length>=t)return e;var a="";return _((t-e.length)/n.length).times(function(){a+=n}),(e+a).substr(0,t)},this.padStart=function(e,t,n){if(e.length>=t)return e;var a="";return _((t-e.length)/n.length).times(function(){a+=n}),(a+e).substr(-1*t)},this.libelleHeure_to_Moment=function(e){var n=e.split(":").map(function(e){return parseInt(e)}),a=(new Date).getTimezoneOffset()/60*-1;return t().set({hour:n[0]+a,minute:n[1],second:n[2]})},this.fixnum_to_bitfield=function(e){var t=e.toString(2),n="";return _(52-t.length).times(function(){n+="0"}),t=n+t,_(t.split("").map(function(e){return parseInt(e)}).reverse()).rest()},this.bitfield_to_fixnum=function(e){return parseInt(e.reverse().join("")+"0",2)}}]),angular.module("cahierDeTextesClientApp").service("log",["$http","$state","APP_PATH","User","URL_ENT",function(e,t,n,a,i){this.add=function(s,r,o){a.get_user().then(function(a){var l=a.data;e.post(i+"/api/logs",{application_id:s,user_id:l.id,structure_id:l.profil_actif.structure_id,profil_id:l.profil_actif.type,url:(_(r).isNull()?n+t.current.url:r).substr(0,1023),params:_(o).isNull()?_(t.params).map(function(e,t){return t+"="+e}).join("&"):o}).then(function(){},function(){})})}}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){e.put("views/404.html","<em>Votre profil actuel ne vous permet pas d'acc\xe9der au Cahier de Textes.</em>")}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){e.put("views/assignements.html",'<div class="panel panel-default"     ng:swipe-left="decr_offset()"     ng:swipe-right="incr_offset()">    <div class="panel-heading">        <div class="row col-md-12">            <h2>                Du {{from_date | amDateFormat:\'Do MMMM YYYY\'}} au {{to_date | amDateFormat:\'Do MMMM YYYY\'}}            </h2>        </div>        <div class="row col-md-12">            <select class="pull-left"                    ng:options="matiere as matiere.name for (id,matiere) in matieres"                    ng:model="matiere_selected"                    ng:change="filter_data( matiere_selected )">                <option value="" selected>Toutes les mati\xe8res</option>            </select>            <select class="pull-left"                    ng:model="period_offset"                    ng:options="period.offset as period.label for period in period_offsets_list">            </select>            <button class="btn btn-default" ng:click="incr_offset()"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></button>            <button class="btn btn-default" ng:click="decr_offset()"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button>            <div class="pull-right options">                <label><checkbox ng:model="affiche_faits"></checkbox> Afficher les devoirs d\xe9j\xe0 faits</label>                <label><checkbox ng:model="tri_ascendant"></checkbox> Tri ascendant</label>            </div>        </div>        <div class="clearfix"></div>    </div></div><ul class="list-group todo-list" ng:if="devoirs">    <li ng:repeat="devoir in devoirs | orderBy:\'date_due\':tri_ascendant"        ng:if="devoir.date_fait == null || affiche_faits"        style="list-style:none"        class="devoir list-group-item" >        <div class="row alert alert-default title">            <div class="pull-left date">{{devoir.date_due | amDateFormat: \'dddd D MMMM\'}}</div>        </div>        <div class="row contenu">            <display-devoir class="col-md-5 alert alert-default"                            devoir="devoir"></display-devoir>            <display-sequence-pedagogique class="col-md-5 alert alert-default"                                          ng:if="devoir.cours.contenu !== \'\'"                                          sp="devoir.cours"></display-sequence-pedagogique>            <div class="col-md-2 pull-right todo">                <switch-devoir devoir="devoir"                               ng:if="current_user.profil_actif.type === \'ELV\'" ></switch-devoir>            </div>        </div>        <div class="clearfix"></div>    </li></ul><span class="no-data" ng:if="devoirs.length === 0">    Aucun devoir trouv\xe9 pour cette p\xe9riode.</span>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){e.put("views/dashboard_teacher.html",'<div class="panel panel-default">    <div class="panel-heading">        <div class="row">            <a class="btn btn-info pull-left" ui:sref="enseignants" ng:if="current_user.profil_actif.type === \'DIR\'" >\u2190 Retour \xe0 la liste des enseignants</a>        </div>    </div>    <div class="panel-body">        <h4 class="col-md-12 pull-left">{{enseignant.firstname}} {{enseignant.lastname}}</h4>        <div class="col-md-4">            <div class="panel panel-default">                <div class="panel-body">                    <legend ng:repeat="email in enseignant.emails">                        <span class="glyphicon glyphicon-envelope"></span>                        <a class="email" href="mailto:{{email.address}}"                           ng:style="{\'font-size\': email.primary ? \'inherit\' : \'75%\'}">{{email.address}}</a>                    </legend>                    <fieldset>                        <legend><span class="glyphicon glyphicon-briefcase"></span> Mati\xe8res enseign\xe9es</legend>                        <span class="label label-primary pull-left" ng:repeat="matiere in enseignant.liste_matieres">{{matiere.name}}</span>                    </fieldset>                    <fieldset>                        <legend><span class="glyphicon glyphicon-envelope"></span> Classes et Groupes</legend>                        <span class="label pull-left"                              ng:class="{\'label-success\': regroupement.type === \'GRP\', \'label-info\': regroupement.type === \'CLS\', \'label-warning\': regroupement.type === \'GPL\' }"                              ng:repeat="regroupement in enseignant.liste_regroupements">{{regroupement.name}}</span>                    </fieldset>                    <fieldset ng:if="enseignant.prof_principal.length > 0">                        <legend><span class="glyphicon glyphicon-bell"></span> Professeur principal de</legend>                        <span class="label label-info pull-left" ng:repeat="regroupement in enseignant.prof_principal">{{regroupement.name}}</span>                    </fieldset>                </div>            </div>        </div>        <div class="col-md-8">            <div class="panel panel-default">                <div class="panel-body row">                    <nvd3 data="graphiques.pieChart.data" options="graphiques.pieChart.options"></nvd3>                    <nvd3 data="graphiques.multiBarChart.data" options="graphiques.multiBarChart.options"></nvd3>                </div>            </div>        </div>    </div></div><div class="panel panel-default">    <div class="panel-heading">        <div class="row">            <div class="col-md-9">                <div class="ui-select-wrapper">                    <ui-select multiple class="pull-left" theme="bootstrap"                               append-to-body="true"                               ng:if="enseignant.liste_regroupements.length > 0"                               ng:change="graphiques.populate( raw_data )"                               ng:model="scope.selected_regroupements">                        <ui-select-match placeholder="Regroupement(s)...">                            <span class="label" ng:class="{\'label-success\': $item.type === \'GRP\', \'label-info\': $item.type === \'CLS\', \'label-warning\': $item.type === \'GPL\' }">                                {{$item.name}}                            </span>                        </ui-select-match>                        <ui-select-choices repeat="regroupement in enseignant.liste_regroupements | orderBy:[\'type\',\'name\']"                                           group-by="\'full_type\'">                            {{regroupement.name}}                        </ui-select-choices>                    </ui-select>                    <button class="btn btn-xs btn-primary"                            ng:click="select_all_regroupements()"><span class="glyphicon glyphicon-certificate"></span></button>                    <button class="btn btn-xs btn-default"                            ng:click="select_no_regroupements()"><span class="glyphicon glyphicon-erase"></span></button>                </div>            </div>            <select class="col-md-3"                    ng:model="moisCourant"                    ng:change="graphiques.populate( raw_data )"                    ng:options="mois.indexOf(m)+1 as m for m in mois">                <option value="">Toute l\'ann\xe9e</option>            </select>        </div>        <label>            <checkbox class="btn-success"                      ng:model="scope.montre_valides"></checkbox>            afficher les saisies vis\xe9es        </label>        <div class="clearfix"></div>    </div>    <div class="panel-body">        <table class="table">            <thead>                <tr>                    <th style="width:12em;">Date</th>                    <th style="width:12em;">Classe / Groupe</th>                    <th style="width:12em;">Mati\xe8re</th>                    <th>Cours</th>                    <th>Travail \xe0 faire</th>                    <th>                        <button class="btn btn-warning pull-right"                                ng:class="{\'disabled\': nb_saisies_visables < 1 }"                                ng:if="current_user.profil_actif.type === \'DIR\'"                                ng:click="valide_all()">                            <span class="glyphicon glyphicon-check"></span> Viser la totalit\xe9                        </button>                    </th>                </tr>            </thead>            <tbody>                <tr ng:repeat="saisie in raw_data | filter:filter_saisie( montre_valides, moisCourant, selected_regroupements ) | orderBy:\'cours.date_cours\'"                    ng:class="{\'even\': $even, \'odd\': $odd, \'recent\': saisie.recent && current_user.profil_actif.type === \'DIR\' }">                    <td>{{saisie.cours.date_cours | amDateFormat:\'Do MMMM YYYY\'}}</td>                    <td ng:bind="saisie.group.name"></td>                    <td ng:bind="saisie.matiere.name"></td>                    <td>                        <div class="alert alert-default" ng:bind-html="saisie.cours.contenu"></div>                    </td>                    <td>                        <div class="alert alert-default" ng:repeat="devoir in saisie.devoirs" ng:bind-html="devoir.contenu"></div>                    </td>                    <td>                        <span switch                              class="violet"                              disabled="current_user.profil_actif.type !== \'DIR\' || saisie.recent"                              ng:disabled="current_user.profil_actif.type !== \'DIR\' || saisie.recent"                              ng:model="saisie.valide"                              ng:change="current_user.profil_actif.type === \'DIR\' && !saisie.recent && valide( saisie )" >                        </span>                    </td>                </tr>            </tbody>        </table>    </div></div>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){e.put("views/dashboard_teachers.html",'<div class="panel panel-default">    <div class="panel-heading">        <div class="row">            <div class="ui-select-wrapper">                <ui-select multiple class="pull-left" theme="bootstrap"                           append-to-body="true"                           ng:change="filter_data()"                           ng:model="scope.selected_regroupements">                    <ui-select-match placeholder="Regroupement(s)...">                        <span class="label" ng:class="{\'label-success\': $item.type === \'GRP\', \'label-info\': $item.type === \'CLS\', \'label-warning\': $item.type === \'GPL\' }">                            {{$item.name}}                        </span>                    </ui-select-match>                    <ui-select-choices repeat="regroupement in regroupements | orderBy:[\'type\',\'name\']"                                       group-by="\'full_type\'">                        <span class="label" ng:class="{\'label-success\': regroupement.type === \'GRP\', \'label-info\': regroupement.type === \'CLS\', \'label-warning\': regroupement.type === \'GPL\' }">                            {{regroupement.name}}                        </span>                    </ui-select-choices>                </ui-select>                <button class="btn btn-xs btn-primary"                        ng:click="select_all_regroupements()"><span class="glyphicon glyphicon-certificate"></span></button>                <button class="btn btn-xs btn-default"                        ng:click="select_no_regroupements()"><span class="glyphicon glyphicon-erase"></span></button>            </div>        </div>    </div></div><div class="col-xs-12 col-sm-6 col-md-3 col-lg-3 bloc-enseignant"     ng:repeat="chart in individualCharts.enseignants | orderBy:\'enseignant.details.lastname\'"     ng:if="chart.display">    <div class="panel panel-default">        <div class="panel-heading">            <h4>                <a ui:sref="enseignant({ enseignant_id: chart.enseignant.details.id })">                    {{chart.enseignant.details.firstname}} {{chart.enseignant.details.lastname}}                </a>            </h4>        </div>        <div class="panel-body">            <span ng:if="chart.pieChart.data[0].value + chart.pieChart.data[1].value == 0">                Aucune saisie \xe0 ce jour.            </span>            <nvd3 data="chart.pieChart.data" options="chart.pieChart.options"                  ng:if="chart.pieChart.data[0].value + chart.pieChart.data[1].value > 0">            </nvd3>        </div>    </div></div>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){
e.put("views/import.html",'<uib-tabset justified="true" active="step">    <uib-tab index="0" select="step = 0">        <uib-tab-heading><h1>1. Charger un fichier Pronote,</h1></uib-tab-heading>        <div class="panel panel-default col-md-3">            <div class="panel-heading">explications</div>            <div class="panel-body">                D\'abord il faut charger un fichier export\xe9 depuis Pronote.            </div>        </div>        <div class="panel panel-default col-md-9">            <div class="panel-heading">action</div>            <div class="panel-body">                <input class="btn" type="file" accept=".xml"                       ng:class="{\'btn-primary\': !fichier, \'btn-default\': fichier}" file-model="fichier" />                <button class="pull-right btn"                        ng:class="{\'disabled btn-default\': !fichier, \'btn-primary\': fichier}"                        ng:click="process_load( fichier )" >                    <span class="glyphicon glyphicon-log-in"></span> Charger les donn\xe9es et passer \xe0 l\'\xe9tape 2.                </button>            </div>        </div>    </uib-tab>    <uib-tab index="1" select="step = 1; import_done = false" disable="step < 1">        <uib-tab-heading><h1>2. Recoller les donn\xe9es manquantes,</h1></uib-tab-heading>        <div class="panel panel-default col-md-3">            <div class="panel-heading">explications</div>            <div class="panel-body">                D\'abord il faut charger un fichier export\xe9 depuis Pronote.            </div>        </div>        <div class="panel panel-default col-md-9">            <div class="panel-heading">action</div>            <div class="panel-body">                <label>                    <checkbox ng:model="scope.display_all"></checkbox>                    Afficher tout.                </label>                <uib-tabset justified="true" active="0">                    <uib-tab ng:repeat="dataset in matcheable_data">                        <uib-tab-heading>                            <h4 ng:style="{\'color\': dataset.unmatched() > 0 ? \'#eb5454\' : \'inherit\', \'font-weight\': dataset.unmatched() > 0 ? \'bold\' : \'normal\'}">                                {{dataset.title}}                            </h4>                            ({{dataset.unmatched()}} \xe0 traiter sur {{dataset.total()}})                        </uib-tab-heading>                        <div class="panel">                            <table class="table table-striped table-bordered table-hover table-condensed" >                                <thead>                                    <tr>                                        <th>Pronote</th>                                        <th>Annuaire Acad\xe9mique</th>                                    </tr>                                </thead>                                <tbody>                                    <tr ng:if="dataset.unmatched() == 0 && !scope.display_all">                                        <td colspan=3>                                            <h3>Aucun recoupement \xe0 faire. </h3>                                        </td>                                    </tr>                                    <!-- matchablerow -->                                    <tr ng:repeat="node in dataset.pronote"                                        ng:if="node.edit || scope.display_all"                                        ng:class="{\'ok\': node.laclasse, \'ko\': !node.laclasse}">                                        <td>                                            <span>                                                {{node.displayed_label}}                                            </span>                                        </td>                                        <td>                                            <span ng:if="!node.edit">{{node.laclasse.displayed_label}}</span>                                            <select class="select-annuaire"                                                    ng:if="node.edit && matieres"                                                    ng:model="node.laclasse"                                                    ng:change="match_this( node, pronote.UAI )"                                                    ng:options="official as official.displayed_label for official in dataset.annuaire | orderBy:[\'displayed_label\']">{{official.displayed_label}}</select>                                            <div class="pull-right">                                                <button class="btn btn-default"                                                        ng:if="node.edit && node.laclasse"                                                        ng:click="unmatch_this( node, pronote.UAI )"><span class="glyphicon glyphicon-erase" aria-hidden="true"></span>                                                </button>                                                <button class="btn btn-default"                                                        ng:if="!node.edit"                                                        ng:click="node.edit = true"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>                                                </button>                                            </div>                                        </td>                                    </tr>                                    <!-- /matchablerow -->                                </tbody>                            </table>                        </div>                    </uib-tab>                </uib-tabset>                <button class="btn pull-right btn-success"                        ng:click="validate_matches()" >                    Recollement possibles effectu\xe9s, pass\xe9 \xe0 l\'\xe9tape d\'import                </button>            </div>        </div>    </uib-tab>    <uib-tab index="2" select="step = 2" disable="step < 1">        <uib-tab-heading><h1>3. Lancer l\'import.</h1> </uib-tab-heading>        <div class="panel panel-default col-md-3">            <div class="panel-heading">explications</div>            <div class="panel-body">                D\'abord il faut charger un fichier export\xe9 depuis Pronote.            </div>        </div>        <div class="panel panel-default col-md-9">            <div class="panel-heading">action</div>            <div class="panel-body">                <div class="panel panel-default import" style="color: #333;">                    <!-- Crit\xe8res de filtrage -->                    <fieldset class="col-md-12">                        <legend> <h4>S\xe9lection des cr\xe9neaux \xe0 importer</h4>  </legend>                        <!-- par regroupements -->                        <div class="col-md-4">                            <div class="ui-select-wrapper">                                <ui-select multiple class="pull-left" theme="bootstrap"                                           append-to-body="true"                                           ng:model="scope.selected.classes">                                    <ui-select-match placeholder="Classe(s)...">                                        <span class="label label-success">{{$item.Nom}}</span> <i class="glyphicon glyphicon-warning-sign" style="color: red" title="Risque de duplication de cr\xe9neaux d\xe9j\xe0 existants" ng:if="$item.existing_creneaux > 0"></i>                                    </ui-select-match>                                    <ui-select-choices repeat="classe in pronote.Classes[0].Classe | orderBy:[\'Nom\']">                                        {{classe.Nom}}<i class="glyphicon glyphicon-warning-sign" style="color: red" title="Risque de duplication de cr\xe9neaux d\xe9j\xe0 existants" ng:if="classe.existing_creneaux > 0"></i>                                    </ui-select-choices>                                </ui-select>                                <button class="btn btn-xs btn-primary"                                        ng:click="scope.selected.classes = pronote.Classes[0].Classe"><span class="glyphicon glyphicon-certificate"></span></button>                                <button class="btn btn-xs btn-default"                                        ng:click="scope.selected.classes = []"><span class="glyphicon glyphicon-erase"></span></button>                            </div>                        </div>                        <div class="col-md-4">                            <div class="ui-select-wrapper">                                <ui-select multiple class="pull-left" theme="bootstrap"                                           append-to-body="true"                                           ng:model="scope.selected.groupes">                                    <ui-select-match placeholder="Groupe(s) d\'\xe9l\xe8ves...">                                        <span class="label label-info">{{$item.Nom}}</span> <i class="glyphicon glyphicon-warning-sign" style="color: red" title="Risque de duplication de cr\xe9neaux d\xe9j\xe0 existants" ng:if="$item.existing_creneaux > 0"></i>                                    </ui-select-match>                                    <ui-select-choices repeat="groupe in pronote.Groupes[0].Groupe | orderBy:[\'Nom\']">                                        {{groupe.Nom}}<i class="glyphicon glyphicon-warning-sign" style="color: red" title="Risque de duplication de cr\xe9neaux d\xe9j\xe0 existants" ng:if="groupe.existing_creneaux > 0"></i>                                    </ui-select-choices>                                </ui-select>                                <button class="btn btn-xs btn-primary"                                        ng:click="scope.selected.groupes = pronote.Groupes[0].Groupe"><span class="glyphicon glyphicon-certificate"></span></button>                                <button class="btn btn-xs btn-default"                                        ng:click="scope.selected.groupes = []"><span class="glyphicon glyphicon-erase"></span></button>                            </div>                        </div>                        <!-- par mati\xe8res -->                        <div class="col-md-4">                            <div class="ui-select-wrapper">                                <ui-select multiple class="pull-left" theme="bootstrap"                                           append-to-body="true"                                           ng:model="scope.selected.matieres">                                    <ui-select-match placeholder="Mati\xe8re(s)...">{{$item.Libelle}}</ui-select-match>                                    <ui-select-choices repeat="matiere in pronote.Matieres[0].Matiere | orderBy:[\'Nom\']">                                        {{matiere.Libelle}}                                    </ui-select-choices>                                </ui-select>                                <button class="btn btn-xs btn-primary"                                        ng:click="scope.selected.matieres = pronote.Matieres[0].Matiere"><span class="glyphicon glyphicon-certificate"></span></button>                                <button class="btn btn-xs btn-default"                                        ng:click="scope.selected.matieres = []"><span class="glyphicon glyphicon-erase"></span></button>                            </div>                        </div>                    </fieldset>                    <!-- /Crit\xe8res de filtrage -->                    <div class="col-md-12" style="text-align: right;">                        <button class="btn btn-lg btn-warning"                                ng:click="process_import()">                            <span class="glyphicon glyphicon-cogs"></span> Valider                        </button>                    </div>                    <fieldset class="col-md-12 summary">                        <label>                            Totalit\xe9 des cr\xe9neaux :                            <ul>                                <li>{{counters.creneaux_ready}} cr\xe9neaux valides</li>                                <li>{{counters.creneaux_not_ready}} cr\xe9neaux invalides (donn\xe9es associ\xe9es non recoll\xe9es)</li>                                <!-- <li>{{counters.creneaux_broken}} cr\xe9neaux non importables (donn\xe9es manquantes)</li> -->                            </ul>                        </label>                        <label>                            Cr\xe9neaux s\xe9lectionn\xe9s :                            <ul>                                <li>{{counters.filtered_creneaux_ready}} cr\xe9neaux valides</li>                                <li>{{counters.filtered_creneaux_not_ready}} cr\xe9neaux invalides (donn\xe9es associ\xe9es non recoll\xe9es)</li>                            </ul>                        </label>                    </fieldset>                    <uib-accordion class="col-md-12">                        <div uib-accordion-group is-open="ui.show_detailed_creneaux">                            <uib-accordion-heading>                                Afficher le d\xe9tail des cr\xe9neaux <i class="glyphicon" ng:class="{\'glyphicon-chevron-down\': ui.show_detailed_creneaux, \'glyphicon-chevron-right\': !ui.show_detailed_creneaux}"></i>                            </uib-accordion-heading>                            <div class="col-md-12"                                 ng:if="ui.show_detailed_creneaux">                                <div class="btn-group pull-right" role="group" style="margin:0 6px 6px 0;">                                    <button class="btn"                                            ng:class="{\' btn-primary active\': ui.display_ready, \'btn-default\': !ui.display_ready}"                                            ng:click="ui.display_ready = !ui.display_ready">                                        <i class="glyphicon" ng:class="{\'glyphicon-eye-open\': ui.display_ready, \'glyphicon-eye-close\': !ui.display_ready}"></i> Cr\xe9neaux valides.                                    </button>                                    <button class="btn btn-default"                                            ng:class="{\' btn-primary active\': ui.display_problems, \'btn-default\': !ui.display_problems}"                                            ng:click="ui.display_problems = !ui.display_problems">                                        <i class="glyphicon" ng:class="{\'glyphicon-eye-open\': ui.display_problems, \'glyphicon-eye-close\': !ui.display_problems}"></i> Cr\xe9neaux \xe0 traiter.                                    </button>                                </div>                            </div>                            <table class="table table-striped table-bordered table-hover table-condensed"                                   ng:class="{\'hidden\': !ui.show_detailed_creneaux}"                                   ng:if="ui.show_detailed_creneaux">                                <thead>                                    <tr>                                        <th></th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'Jour\'] )">Jour</a>                                            <span ng:if="ui.sortCreneauxBy == [\'Jour\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-Jour\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'NumeroPlaceDebut\'] )">\xe0</a>                                            <span ng:if="ui.sortCreneauxBy == [\'NumeroPlaceDebut\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-NumeroPlaceDebut\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'NombrePlaces\'] )">pendant</a>                                            <span ng:if="ui.sortCreneauxBy == [\'NombrePlaces\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-NombrePlaces\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'Matiere\'] )">mati\xe8re</a>                                            <span ng:if="ui.sortCreneauxBy == [\'Matiere\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-Matiere\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'Professeur\'] )">enseignant(s)</a>                                            <span ng:if="ui.sortCreneauxBy == [\'Professeur\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-Professeur\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'Classe\',\'Groupe\'] )">regroupement(s)</a>                                            <span ng:if="ui.sortCreneauxBy == [\'Classe\',\'Groupe\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-Classe\',\'-Groupe\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'Salle\'] )">salle(s)</a>                                            <span ng:if="ui.sortCreneauxBy == [\'Salle\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-Salle\']">\u2193</span>                                        </th>                                        <th>                                            <a ng:click="ui.sort_creneaux_by( [\'ready\'] )"><i class="glyphicon glyphicon-warning-sign" title="Probl\xe8me(s) identifi\xe9(s)"></i></a>                                            <span ng:if="ui.sortCreneauxBy == [\'ready\']">\u2191</span>                                            <span ng:if="ui.sortCreneauxBy == [\'-ready\']">\u2193</span>                                        </th>                                    </tr>                                </thead>                                <tbody>                                    <!--  | filter:filter_creneau( ui, scope.selected ) | orderBy:ui.sortCreneauxBy -->                                    <tr ng:repeat="creneau in scope.creneaux | filter:filter_creneau( ui, scope.selected ) | orderBy:ui.sortCreneauxBy"                                        ng:class="{\'ok\': creneau.ready, \'ko\': !creneau.ready}">                                        <td>                                            {{$index + 1}}                                        </td>                                        <td>                                            {{jours_de_la_semaine[ creneau.Jour ]}}                                        </td>                                        <td>                                            {{pronote.plages_horaires[ creneau.NumeroPlaceDebut ].LibelleHeureDebut}}                                        </td>                                        <td>                                            {{creneau.NombrePlaces * pronote.GrilleHoraire[0].DureePlace}} minutes                                        </td>                                        <td ng:class="{\'ko rouge\': !creneau.readiness.matiere }">                                            <span ng:if="creneau.Matiere">{{pronote.matieres[ creneau.Matiere.Ident ].displayed_label}}</span>                                        </td>                                        <td ng:class="{\'ko rouge\': !creneau.readiness.enseignant }">                                            <span ng:if="creneau.Professeur">{{pronote.enseignants[ creneau.Professeur.Ident ].displayed_label}} <sup uib-tooltip-html="beautify_semainier( creneau.Professeur.Semaines )" tooltip-trigger="\'click\'">({{creneau.Professeur.Semaines}})</sup></span>                                        </td>                                        <td ng:class="{\'ko rouge\': !creneau.readiness.classe && !creneau.readiness.groupe_eleve }">                                            <span ng:if="creneau.Classe">{{pronote.classes[ creneau.Classe.Ident ].Nom}} <sup uib-tooltip-html="beautify_semainier( creneau.Classe.Semaines )" tooltip-trigger="\'click\'">({{creneau.Classe.Semaines}})</sup></span>                                            <span ng:if="creneau.Groupe">{{pronote.groupes_eleves[ creneau.Groupe.Ident ].Nom}} <sup uib-tooltip-html="beautify_semainier( creneau.Groupe.Semaines )" tooltip-trigger="\'click\'">({{creneau.Groupe.Semaines}})</sup></span>                                        </td>                                        <td>                                            <span ng:if="creneau.Salle">{{pronote.salles[ creneau.Salle.Ident ].Nom}} <sup uib-tooltip-html="beautify_semainier( creneau.Salle.Semaines )" tooltip-trigger="\'click\'">({{creneau.Salle.Semaines}})</sup></span>                                        </td>                                        <td class="import-readiness"                                            ng:class="{\'vert\': creneau.ready, \'rouge\': !creneau.ready }">                                            <span ng:if="creneau.ready"> <i class="glyphicon glyphicon-ok" title="Aucun probl\xe8me"></i> </span>                                            <span ng:if="!creneau.readiness.matiere"> <i class="glyphicon glyphicon-book" title="Mati\xe8re inconnue"></i> </span>                                            <span ng:if="!creneau.readiness.enseignant"> <i class="glyphicon glyphicon-user" title="Enseignant inconnu"></i> </span>                                            <span ng:if="!creneau.readiness.classe && !creneau.readiness.groupe_eleve"> <i class="glyphicon glyphicon-education" title="Classe/Groupe inconnu"></i> </span>                                        </td>                                    </tr>                                </tbody>                            </table>                        </div>                    </uib-accordion>                </div>            </div>            </div>    </uib-tab></uib-tabset>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){e.put("views/index.html",'<header ng:controller="HeaderCtrl"        ng:class="{\'embedded\': embedded}">    <div class="onglets">        <a class="btn"           ng:repeat="tab in tabs"           ui:sref="{{tab.uisref}}"           ng:class="{\'btn-warning\': tab.active, \'btn-default\': !tab.active}"           ng:click="set_active_tab( tab.uisref )">            <span class="{{tab.css_class}}"></span> {{tab.heading}}        </a>        <select class="pull-right choix-enfant"                ng:if="current_user && current_user.profil_actif.type === \'TUT\'"                ng:options="enfant as enfant.enfant.firstname+\' \'+enfant.enfant.lastname for enfant in current_user.enfants track by enfant.enfant.id"                ng:model="current_user.enfant_actif"                ng:change="reload()"></select>    </div></header><div id="ui-view-content"     ui-view="content"     ng:class="{\'embedded\': embedded}"></div><footer class="col-md-12"        ng:controller="FooterCtrl" ng:cloak>    <div class="pull-left">        <div class="btn-group" uib-dropdown>            <button uib-dropdown-toggle type="button" class="btn btn-xs btn-default uib-dropdown-toggle">                <span class="glyphicon glyphicon-cog"></span> Pr\xe9f\xe9rences            </button>            <ul uib-dropdown-menu class="uib-dropdown-menu user-preferences" role="menu">                <li><label><checkbox ng:model="current_user.parametrage_cahier_de_textes.affichage_week_ends"                                     ng:change="save_and_reload()"></checkbox> Afficher les week-ends</label></li>                <li class="divider"></li>                <li><label><checkbox ng:model="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir"                                     ng:change="save_and_reload()"></checkbox> Afficher les types de devoirs</label></li            </ul>        </div>    </div>    <a href="https://github.com/laclasse-com/service-cahiertextes" class="pull-right">version {{version}}</a></footer>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){e.put("views/popup_display.html",'<div class="modal-header">    <h3>{{date | date : \'fullDate\' }}<span ng:if="creneau.salles.length > 0">, salle {{creneau.salles[0].nom}}</span></h3>    <h4>{{matiere.name}}</h4></div><div class="modal-body">    <uib-tabset>        <uib-tab ng:if="devoirs.length > 0" heading="Travail \xe0 faire">            <div ng:repeat="devoir in devoirs"                 class="devoir col-md-12" >                <div class="col-md-8">                    <display-devoir devoir="devoir"></display-devoir>                </div>                <div class="col-md-4">                    <ul>                        <li class="clickable"                            tooltip-trigger="\'click\'"                            tooltip-placement="right"                            uib-tooltip-html="devoir.cours.contenu">                            <span><i class="picto" ng:style="{\'background-image\':\'url(\' + app_path + \'/app/node_modules/laclasse-common-client/images/picto_cours.svg)\'}"></i> S\xe9quence p\xe9dagogique : <em>{{devoir.cours.date_cours | date : \'dd/MM\'}}</em></span>                        </li>                    </ul>                    <switch-devoir devoir="devoir"                                   ng:if="current_user.profil_actif.type === \'ELV\'" ></switch-devoir>                </div>            </div>            <div class="clearfix"></div>        </uib-tab>        <uib-tab heading="S\xe9quence p\xe9dagogique">            <div class="col-md-8">                <display-sequence-pedagogique sp="cours" ng:if="cours.contenu" ></display-sequence-pedagogique>            </div>            <div class="col-md-4">                <ul>                    <li class="clickable" ng:repeat="devoir in cours.devoirs"                        tooltip-trigger="\'click\'"                        tooltip-placement="right"                        uib-tooltip-html="devoir.tooltip"                        ng:class="{ \'type1\': devoir.type_devoir_id == 1, \'type2\': devoir.type_devoir_id == 2, \'type3\': devoir.type_devoir_id == 3, \'type4\': devoir.type_devoir_id == 4, \'type5\': devoir.type_devoir_id == 5, \'type6\': devoir.type_devoir_id == 6, \'fait\': devoir.fait }" >                        <span><i class="picto" ng:style="{\'background-image\':\'url(\' + app_path + \'/app/node_modules/laclasse-common-client/images/picto_devoir.svg)\'}"></i> Devoir associ\xe9 : <em>{{devoir.date_due | date : \'dd/MM\'}}</em></span>                    </li>                </ul>            </div>            <div class="clearfix"></div>        </uib-tab>    </uib-tabset></div><div class="modal-footer">    <button class="btn btn-default btn-sm pull-right" ng:click="fermer()">        <span class="glyphicon glyphicon-remove-sign"></span> Fermer    </button></div>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){
e.put("views/popup_edition.html",'<div class="modal-header"     ng:class="{\'not-yours\': !creneau.mine}">    <!-- {{{ Lecture seule -->    <span ng:if="!mode_edition_creneau">        <h3>{{creneau.heure_debut | amDateFormat : \'dddd D MMMM YYYY\' }}, semaine {{creneau.n_week}}</h3>        <h4>            {{selected_regroupement.name}} - {{selected_matiere.name}} ({{creneau.heure_debut | amDateFormat: \'HH:mm\'}} - {{creneau.heure_fin | amDateFormat: \'HH:mm\'}}<span ng:if="creneau.salles.length > 0">, salle {{creneau.salles[0].nom}}</span>)        </h4>    </span>    <!-- }}} -->    <!-- {{{ \xc9dition -->    <div class="edition-creneau"         ng:if="mode_edition_creneau">        <div class="col-md-6">            <label>Choisir la classe/le groupe :</label>            <select ng:model="scope.selected_regroupement"                    ng:options="classe as classe.name group by classe.type for classe in classes | orderBy:[\'type\',\'name\']"                    ng:required="true">            </select>        </div>        <div class="col-md-6">            <label>Choisir la mati\xe8re :</label>            <select ng:model="scope.selected_matiere"                    ng:options="matiere as matiere.name for matiere in matieres | orderBy:[\'name\']"                    ng:required="true">            </select>        </div>        <div class="col-md-12 horaire">            <label>Choisir l\'horaire :</label>            <select ng:options="index as jour for (index, jour) in jours"                    ng:model="creneau.jour_de_la_semaine">            </select>            de            <div uib-dropdown class="uib-dropdown horaire">                <a uib-dropdown-toggle class="uib-dropdown-toggle" role="button" data-toggle="uib-dropdown" data-target="#" href="">{{creneau.tmp_heure_debut | amDateFormat: \'HH:mm\'}}</a>                <div uib-dropdown-menu class="uib-dropdown-menu" role="menu" ng:click="$event.stopPropagation()">                    <div uib-timepicker                         class="uib-timepicker"                         ng:model="creneau.tmp_heure_debut"                         data-show-meridian="false"                         data-minute-step="5"                         ng:required="true"></div>                </div>            </div>            \xe0            <div uib-dropdown class="uib-dropdown horaire">                <a uib-dropdown-toggle class="uib-dropdown-toggle" role="button" data-toggle="uib-dropdown" data-target="#" href="">{{creneau.tmp_heure_fin | amDateFormat: \'HH:mm\'}}</a>                <div uib-dropdown-menu class="uib-dropdown-menu" role="menu" ng:click="$event.stopPropagation()">                    <div uib-timepicker                         class="uib-timepicker"                         ng:model="creneau.tmp_heure_fin"                         data-show-meridian="false"                         data-minute-step="5"                         ng:required="true"></div>                </div>            </div>        </div>        <div class="col-md-12">            <label>Choisir les semaines actives :</label>            <div class="btn-group templates-semainier">                <button class="btn btn-xs"                        ng:repeat="template in templates_semainier"                        ng:click="template.apply()">{{template.label}}</button>            </div>            <div class="semainier">                <fieldset ng:repeat="mois in overlay_semainier | orderBy:\'index\'">                    <legend>{{mois.label}}</legend>                    <div class="btn-group">                        <button type="button" class="btn btn-xs btn-default"                                ng:repeat="semaine in mois.semaines track by $index"                                ng:class="{\'active\': semaines_actives.regroupement[ semaine.semaine - 1 ], \'vacances\': sont_ce_les_vacances( semaine.semaine, ZONE ), \'this-week\': semaine.semaine === creneau.n_week}"                                ng:model="semaines_actives.regroupement[ semaine.semaine - 1 ]"                                uib-btn-checkbox                                btn-checkbox-true="1"                                btn-checkbox-false="0" >                            {{semaine.semaine}}                        </button>                    </div>                </fieldset>            </div>            <div class="pull-right legende">                <label>L\xe9gende :</label>                <span class="btn btn-xs btn-default" title="Cr\xe9neau absent de cette semaine"> </span> Cr\xe9neau absent de cette semaine                <span class="btn btn-xs btn-default active" title="Cr\xe9neau pr\xe9sent cette semaine"> </span> Cr\xe9neau pr\xe9sent cette semaine                <span class="btn btn-xs btn-default vacances" title="Vacances scolaires"> </span> Vacances scolaires            </div>        </div>    </div>    <!-- }}} -->    <div class="error-messages">        <div class="alert alert-danger" role="alert" ng:repeat="erreur in erreurs">{{erreur.message}}</div>    </div></div><div class="modal-body" ng:if="!mode_edition_creneau && !mode_duplication">    <uib-tabset>        <!-- ####################### S\xe9quence P\xe9dagogique du jour ####################### -->        <uib-tab heading="S\xe9quence p\xe9dagogique du jour" >            <div class="row">                <div class="col-md-9 contenu">                    <div class="panel panel-default">                        <div data-text-angular                             class="panel-body"                             ng:model="cours.contenu"                             ng:change="is_dirty( cours )"                             ng:if="cours.editable && !cours.deleted" ></div>                        <div class="panel-body"                             ng:bind-html="cours.contenu"                             ng:if="!cours.editable && !cours.deleted" ></div>                        <div class="panel-body deleted"                             ng:if="cours.deleted" >(S\xe9quence p\xe9dagogique supprim\xe9e)</div>                        <div class="panel-footer ressources" ng:if="!cours.deleted">                            <div class="row">                                <div class="attached-document" ng:repeat="ressource in cours.ressources">                                    <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>                                    <button class="btn btn-sm btn-danger" ng:click="remove_ressource( cours, ressource.hash )">\u2715</button>                                </div>                            </div>                            <div uib-dropdown class="uib-dropdown" ng:if="!creneau.etranger">                                <button uib-dropdown-toggle class="btn btn-sm btn-default uib-dropdown-toggle pull-right" role="button" data-toggle="uib-dropdown" data-target="#" href=""                                        ng:class="{\'disabled\': faulty_docs_app}">                                    <span class="glyphicon glyphicon-plus-sign"></span> Ajouter une ressource                                </button>                                <div uib-dropdown-menu class="uib-dropdown-menu" role="menu" ng:click="$event.stopPropagation()">                                    <div cartable                                         class="treecontrol-container"                                         racine="cartable.files"                                         target="cours"                                         regroupement="selected_regroupement"                                         add-callback="consume_Documents_response_callback">                                    </div>                                    <input type="file"                                           class="upload"                                           name="upload[]"                                           onchange="angular.element(this).scope().upload_and_add_ressource( angular.element(this).scope().cours, this.files)" />                                </div>                            </div>                            <div class="clearfix"></div>                        </div>                    </div>                </div>                <div class="col-md-3 infos">                    <ul class="pull-left">                        <li class="clickable"                            ng:repeat="devoir in cours.devoirs"                            ng:if="!devoir.deleted"                            uib-tooltip-html="devoir.tooltip"                            tooltip-trigger="\'click\'"                            tooltip-placement="bottom"                            ng:class="{ \'type1\': devoir.type_devoir_id == 1, \'type2\': devoir.type_devoir_id == 2, \'type3\': devoir.type_devoir_id == 3, \'type4\': devoir.type_devoir_id == 4, \'type5\': devoir.type_devoir_id == 5, \'type6\': devoir.type_devoir_id >= 6, \'fait\': devoir.fait }" >                            <span><i class="picto" ng:style="{\'background-image\':\'url(\' + app_path + \'/app/vendor/laclasse-common-client/images/picto_devoir.svg)\'}"></i> Devoir associ\xe9 : <em>{{devoir.date_due | date : \'dd/MM\'}}</em></span>                        </li>                    </ul>                </div>                <div class="col-md-3" ng:if="cours.id">                    <button type="button" class="btn btn-xs btn-danger pull-right supprimer"                            ng:click="effacer_cours(  )"                            ng:if="cours.id && ( cours.deleted || ( !creneau.etranger && cours.editable ) )" >                        <span ng:if="!cours.deleted"><span class="glyphicon glyphicon-trash"></span> Supprimer</span>                        <span ng:if="cours.deleted"><span class="glyphicon glyphicon-trash"></span> Annuler la suppression</span>                    </button>                </div>            </div>            <div class="panel panel-default">                <div class="panel-heading">                    Travail \xe0 faire suite \xe0 cette s\xe9quence p\xe9dagogique                </div>                <div class="panel-body">                    <button class="btn btn-default ajout-devoir"                            ng:if="creneau.can_add_homework"                            ng:click="ajout_devoir( cours.devoirs, \'next\' )">                        <span class="glyphicon glyphicon-plus-sign"></span> Ajouter un devoir                    </button>                    <div class="panel panel-default"                         ng:repeat="devoir in cours.devoirs">                        <div class="row">                            <div class="col-md-9"                                 ng:if="!devoir.deleted">                                <div class="panel-heading enseignant-saisie" ng:if="!creneau.etranger">                                    <label class="col-md-6" ng:if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir">Type de travail :                                        <select ng:required="true"                                                ng:change="is_dirty( devoir )"                                                ng:model="devoir.type_devoir_id"                                                ng:options="type_de_devoir.id as type_de_devoir.description for type_de_devoir in types_de_devoir">                                        </select>                                    </label>                                    <label class="col-md-6">Date de rendu :                                        <select ng:required="true"                                                ng:model="devoir.date_due"                                                ng:change="set_creneau_date_due( devoir )"                                                ng:options="creneau.date_due as formateCreneau( creneau ) group by creneau.semaine for creneau in creneaux_devoirs_possibles">                                        </select>                                    </label>                                    <div class="col-md-12">                                        <label>Temps de travail estim\xe9 : </label>                                        <span uib-rating                                              ng:model="devoir.temps_estime"                                              max="15"                                              readonly="false"                                              ng:click="is_dirty( devoir )"                                              on-hover="estimation_over(devoir, value)"                                              on-leave="estimation_leave(devoir)"                                              state-on="\'temps-est-on\'"                                              state-off="\'temps-est-off\'"></span>                                        <span class="label pull-right" ng:class="{\'label-success\': devoir.overValue<4, \'label-info\': devoir.overValue>=4 && devoir.overValue<8 , \'label-warning\': devoir.overValue>=8 && devoir.overValue<12, \'label-danger\': devoir.overValue>=12}" ng:if="devoir.overValue > 0 || devoir.temps_estime > 0">{{devoir.minutes || devoir.temps_estime * 5}} min</span>                                    </div>                                    <div class="clearfix"></div>                                </div>                                <text-angular class="panel-body" ng:model="devoir.contenu" ng:change="is_dirty( devoir )" ng:if="!creneau.etranger"></text-angular>                                <div class="panel-heading enseignant-saisie" ng:if="creneau.etranger">                                    <label ng:if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir">Type de travail : <em>{{devoir.type_devoir.description}}</em></label>                                    <label ng:if="devoir.temps_estime">Temps de travail estim\xe9 : <em>{{devoir.temps_estime * 5}} min</em></label>                                </div>                                <div class="panel-body" ng:bind-html="devoir.contenu" ng:if="creneau.etranger"></div>                                <div class="panel-footer ressources">                                    <div class="row">                                        <div class="attached-document" ng:repeat="ressource in devoir.ressources">                                            <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>                                            <button class="btn btn-sm btn-danger" ng:click="remove_ressource( devoir, ressource.hash )">\u2715</button>                                        </div>                                    </div>                                    <div uib-dropdown class="uib-dropdown" ng:if="!creneau.etranger">                                        <button uib-dropdown-toggle class="btn btn-sm btn-default uib-dropdown-toggle pull-right" role="button" data-toggle="uib-dropdown" data-target="#" href=""                                                ng:class="{\'disabled\': faulty_docs_app}">                                            <span class="glyphicon glyphicon-plus-sign"></span> Ajouter une ressource                                        </button>                                        <div uib-dropdown-menu class="uib-dropdown-menu" role="menu" ng:click="$event.stopPropagation()">                                            <div cartable                                                 class="treecontrol-container"                                                 racine="cartable.files"                                                 target="devoir"                                                 regroupement="selected_regroupement"                                                 add-callback="consume_Documents_response_callback">                                            </div>                                            <input type="file"                                                   class="upload"                                                   name="upload[]"                                                   onchange="angular.element(this).scope().upload_and_add_ressource( angular.element(this).scope().devoir, this.files)" />                                        </div>                                    </div>                                    <div class="clearfix"></div>                                </div>                            </div>                            <div class="col-md-9 deleted"                                 ng:if="devoir.deleted" >(Devoir supprim\xe9)</div>                            <div class="col-md-3">                                <button type="button" class="btn btn-xs btn-danger pull-right supprimer"                                        ng:click="effacer_devoir( devoir )"                                        ng:if="devoir.id && !creneau.etranger && !devoir.cours.deleted">                                    <span ng:if="!devoir.deleted"><span class="glyphicon glyphicon-trash"></span> Supprimer</span>                                    <span ng:if="devoir.deleted"><span class="glyphicon glyphicon-trash"></span> Annuler la suppression</span>                                </button>                            </div>                        </div>                    </div>                </div>            </div>        </uib-tab>        <!-- ####################### Devoirs d\xfbs ce jour ####################### -->        <uib-tab>            <uib-tab-heading ng:class="{\'has\': devoirs.length > 0}">Travail \xe0 faire pour ce jour</uib-tab-heading>            <button class="btn btn-default ajout-devoir"                    ng:click="ajout_devoir( devoirs, creneau )"                    ng:if="creneau.can_add_homework">                <span class="glyphicon glyphicon-plus-sign"></span> Ajouter un devoir            </button>            <div class="clearfix"></div>            <div class="panel panel-default"                 ng:repeat="devoir in devoirs">                <div class="row">                    <div class="col-md-9"                         ng:if="!devoir.deleted">                        <div class="panel-heading enseignant-saisie" ng:if="!creneau.etranger">                            <label class="col-md-12" ng:if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir">Type de travail :                                <select ng:required="true"                                        ng:change="is_dirty( devoir )"                                        ng:model="devoir.type_devoir_id"                                        ng:options="type_de_devoir.id as type_de_devoir.description for type_de_devoir in types_de_devoir">                                </select>                            </label>                            <div class="col-md-12">                                <label>Temps de travail estim\xe9 : </label>                                <span uib-rating                                      ng:model="devoir.temps_estime"                                      max="15"                                      readonly="false"                                      ng:click="is_dirty( devoir )"                                      on-hover="estimation_over(devoir, value)"                                      on-leave="estimation_leave(devoir)"                                      state-on="\'temps-est-on\'"                                      state-off="\'temps-est-off\'"></span>                                <span class="label pull-right"                                      ng:class="{\'label-success\': devoir.overValue<4, \'label-info\': devoir.overValue>=4 && devoir.overValue<8 , \'label-warning\': devoir.overValue>=8 && devoir.overValue<12, \'label-danger\': devoir.overValue>=12}"                                      ng:if="devoir.overValue > 0 || devoir.temps_estime > 0">{{devoir.minutes || devoir.temps_estime * 5}} min</span>                            </div>                            <div class="clearfix"></div>                        </div>                        <text-angular class="panel-body"                                      ng:model="devoir.contenu"                                      ng:change="is_dirty( devoir )"                                      ng:if="!creneau.etranger"></text-angular>                        <div class="panel-heading enseignant-saisie" ng:if="creneau.etranger">                            <label>Type de travail : <em>{{devoir.type_devoir.description}}</em></label>                            <label ng:if="devoir.temps_estime">Temps de travail estim\xe9 : <em>{{devoir.temps_estime * 5}} min</em></label>                        </div>                        <div class="panel-body" ng:bind-html="devoir.contenu" ng:if="creneau.etranger"></div>                        <div class="panel-footer ressources">                            <div class="row">                                <div class="attached-document" ng:repeat="ressource in devoir.ressources">                                    <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>                                    <button class="btn btn-sm btn-danger" ng:click="remove_ressource( devoir, ressource.hash )">\u2715</button>                                </div>                            </div>                            <div uib-dropdown class="uib-dropdown" ng:if="!creneau.etranger">                                <button uib-dropdown-toggle class="btn btn-sm btn-default uib-dropdown-toggle pull-right" role="button" data-toggle="uib-dropdown" data-target="#" href=""                                        ng:class="{\'disabled\': faulty_docs_app}">                                    <span class="glyphicon glyphicon-plus-sign"></span> Ajouter une ressource                                </button>                                <div uib-dropdown-menu class="uib-dropdown-menu" role="menu" ng:click="$event.stopPropagation()">                                    <div cartable                                         class="treecontrol-container"                                         racine="cartable.files"                                         target="devoir"                                         regroupement="selected_regroupement"                                         add-callback="consume_Documents_response_callback">                                    </div>                                    <input type="file"                                           class="upload"                                           name="upload[]"                                           onchange="angular.element(this).scope().upload_and_add_ressource( angular.element(this).scope().devoir, this.files)" />                                </div>                            </div>                            <div class="clearfix"></div>                        </div>                    </div>                    <div class="col-md-3 infos"                         ng:if="!devoir.deleted">                        <ul class="pull-left">                            <li class="clickable"                                ng:if="devoir.cours.contenu"                                uib-tooltip-html="devoir.cours.tooltip"                                tooltip-trigger="\'click\'"                                tooltip-placement="bottom">                                <span class="glyphicon glyphicon-briefcase"></span> S\xe9quence P\xe9dagogique                            </li>                        </ul>                    </div>                    <div class="col-md-9 deleted"                         ng:if="devoir.deleted" >(Devoir supprim\xe9)</div>                    <div class="col-md-3">                        <button type="button" class="btn btn-xs btn-danger pull-right supprimer"                                ng:click="effacer_devoir( devoir )"                                ng:if="devoir.id && !creneau.etranger && !devoir.cours.deleted">                            <span ng:if="!devoir.deleted"><span class="glyphicon glyphicon-trash"></span> Supprimer</span>                            <span ng:if="devoir.deleted"><span class="glyphicon glyphicon-trash"></span> Annuler la suppression</span>                        </button>                    </div>                </div>            </div>        </uib-tab>    </uib-tabset>    <div class="clearfix"></div></div><!-- Duplication de S\xe9quence P\xe9dagogique --><div class="modal-body" ng:if="mode_duplication">    <div class="alert alert-success" role="alert" ng:if="creneaux_similaires.length == 0">Plus aucune duplication possible</div>    <div class="duplication-saisie" ng:if="creneaux_similaires.length > 0" >        <div class="col-md-12">            <ol>                <li>                    <label>Choisir le cr\xe9neau vers lequel copier la s\xe9quence p\xe9dagogique :</label>                    <ul>                        <li ng:bind-html="cours.contenu"></li>                    </ul>                    <select class="col-md-3 pull-left"                            ng:model="scope.selected_regroupement_id_duplication"                            ng:options="classe.id as classe.name for classe in classes">                        <option value="" selected>Toutes les classes</option>                    </select>                    <select ng:required                            ng:change="creneau_cible_duplication_SP_updated()"                            ng:model="creneaux_similaires.selected"                            ng:options="creneau as formateCreneau( creneau ) group by creneau.classe.name for creneau in creneaux_similaires | orderBy:[\'+start\'] | filter:selected_regroupement_id_duplication" >                    </select>                </li>                <li ng:if="cours.devoirs.length > 0">                    <label>Choisir le cr\xe9neau vers lequel copier ses devoirs :</label>                    <ol>                        <li ng:repeat="devoir in cours.devoirs"                            ng:if="!devoir.deleted">                            <ul>                                <li ng:if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir"><i class="picto" ng:style="{\'background-image\':\'url(\' + app_path + \'/app/vendor/laclasse-common-client/images/picto_devoir.svg)\'}"></i> Type de devoir : <em>{{devoir.type_devoir.description}}</em></li>                                <li>Date due : <em>{{devoir.date_due | amDateFormat : \'dddd D MMMM YYYY\'}}</em></li>                                <li ng:bind-html="devoir.contenu"></li>                            </ul>                            <select ng:change="are_we_go_for_duplication()"                                    ng:model="devoir.creneau_cible"                                    ng:options="creneau as formateCreneau( creneau ) for creneau in creneaux_devoirs_possibles_duplication | orderBy:\'date_due\'" >                            </select>                        </li>                    </ol>                </li>            </ol>        </div>        <div class="col-md-12 footer">            <button type="button" class="btn btn-sm btn-success pull-right"                    ng:click="dupliquer()"                    ng:class="{ \'disabled\': !ok_go_for_duplication }">                <span><span class="glyphicon glyphicon-share"></span> Dupliquer</span>            </button>        </div>    </div>    <div class="clearfix"></div></div><!-- /Duplication de S\xe9quence P\xe9dagogique --><div class="modal-footer">    <button type="button" class="btn btn-sm btn-warning pull-left"            ng:if="!creneau.etranger && mode_edition_creneau && dirty"            ng:click="effacer_creneau()">        <span class="glyphicon glyphicon-trash"></span> Supprimer le cr\xe9neau    </button>    <button type="button" class="btn btn-sm btn-default pull-left"            ng:click="switch_to_creneau_edition()"            ng:if="!creneau.etranger && !mode_edition_creneau" >        <span><span class="glyphicon glyphicon-edit"></span> Modifier le cr\xe9neau</span>    </button>    <button type="button" class="btn btn-sm btn-default pull-left"            ng:click="switch_to_duplication_mode()"            ng:if="!creneau.etranger && cours.contenu && !mode_edition_creneau && !mode_duplication && creneaux_similaires.length > 0 && !dirty" >        <span><span class="glyphicon glyphicon-transfer"></span> Copier \xe0 d\'autres cr\xe9neaux</span>    </button>    <button type="button" class="btn btn-sm btn-default"            ng:click="switch_to_modification_mode()"            ng:if="mode_duplication || mode_edition_creneau && !creneau.en_creation" >        <span><span class="glyphicon glyphicon-transfer"></span> Revenir en modification</span>    </button>    <button type="button" class="btn btn-sm btn-success pull-right" ng:click="valider()" ng:if="!creneau.etranger && dirty || (mode_edition_creneau && scope.selected_regroupement)">        <span class="glyphicon glyphicon-ok-sign"></span> Valider    </button>    <button type="button" class="btn btn-sm btn-default pull-right" ng:click="annuler()">        <span class="glyphicon glyphicon-remove-sign"></span>        <span ng:if="dirty || mode_edition_creneau"> Annuler</span>        <span ng:if="!dirty && !mode_edition_creneau"> Fermer</span>    </button></div>')}]),angular.module("cahierDeTextesClientApp").run(["$templateCache",function(e){
e.put("views/textbook.html",'<div class="panel panel-default">    <div class="panel-heading" ng:if="current_user.profil_actif.type === \'ENS\' || current_user.profil_actif.type === \'EVS\' || current_user.profil_actif.type === \'DIR\' || current_user.profil_actif.type === \'ADM\' || current_user.profil_actif.type === \'DOC\'">        <div class="ui-select-wrapper">            <ui-select multiple class="pull-left" theme="bootstrap"                       append-to-body="true"                       ng:change="refresh_calendar()"                       ng:model="scope.selected_regroupements">                <ui-select-match placeholder="Regroupement(s)...">                    <span class="label" ng:class="{\'label-success\': $item.type === \'GRP\', \'label-info\': $item.type === \'CLS\', \'label-warning\': $item.type === \'GPL\' }">                        {{$item.name}}                    </span>                </ui-select-match>                <ui-select-choices repeat="classe in current_user.actual_groups | orderBy:[\'type\',\'name\']"                                   group-by="\'full_type\'">                    <span class="label" ng:class="{\'label-success\': classe.type === \'GRP\', \'label-info\': classe.type === \'CLS\', \'label-warning\': classe.type === \'GPL\' }">                        {{classe.name}}                    </span>                </ui-select-choices>            </ui-select>            <button class="btn btn-xs btn-primary"                    ng:click="select_all_regroupements()"><span class="glyphicon glyphicon-certificate"></span></button>            <button class="btn btn-xs btn-default"                    ng:click="select_no_regroupements()"><span class="glyphicon glyphicon-erase"></span></button>        </div>        <div class="pull-right options" ng:if="current_user.profil_actif.type === \'ENS\' || current_user.profil_actif.type === \'DOC\'">            <label><checkbox class="btn-info" ng:model="scope.uniquement_mes_creneaux"                             ng:change="refresh_calendar()"></checkbox> Ne montrer que ce qui me concerne directement</label>        </div>        <div class="clearfix"></div>    </div>    <div class="panel-body"         ng:class="{\'vacances\': c_est_les_vacances}">        <div data-calendar="emploi_du_temps"             id="emploi_du_temps"             data-ui-calendar="calendar.options"             class="calendar"             ng:model="calendar.events"             calendar-watch-event="extraEventSignature"             ng:swipe-left="next()"             ng:swipe-right="prev()"></div>        <div class="col-md-12">            <div class="pull-right legende">                <label>L\xe9gende :</label>                <label><span class="label edt-cours" title="Cours"> </span> Cours</label>                <!-- <span class="label edt-permanence" title="Permanence"> </span> Permanence -->                <label><span class="label edt-devoir-a-faire" title="Devoir \xe0 faire"> </span> Devoir \xe0 faire</label>                <label ng:if="current_user.profil_actif.type === \'ELV\'"><span class="label edt-devoir-fait" title="Devoir fait ! Youpi !"> </span> Devoir fait</label>                <label><span class="label edt-devoir-note-maison" title="Devoir \xe0 faire \xe0 la maison"> </span> DM - devoir maison</label>                <label><span class="label edt-devoir-note-surveille" title="Devoir surveill\xe9"> </span> DS - devoir surveill\xe9</label>            </div>        </div>    </div></div>')}]);