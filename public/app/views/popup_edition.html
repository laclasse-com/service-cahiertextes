<div class="modal-header">
  <button type="button" class="close pull-right" aria-hidden="true" data-ng-click="annuler()"><i class="picto" data-ng-style="{'background-image':'url(' + app_path + '/app/bower_components/charte-graphique-laclasse-com/images/picto_cross.svg)'}"></i></button>

  <h3>{{creneau.heure_debut | date : 'fullDate' }}, semaine {{creneau.n_week}}</h3>
  <!-- {{{ Lecture seule -->
  <h3>
    <span data-ng-if="!creneau.en_creation || !creneau.vierge">
      {{classe.libelle}} - {{matiere.libelle_long}} ({{creneau.heure_debut | date: 'shortTime'}} - {{creneau.heure_fin | date: 'shortTime'}})
    </span>
  </h3>
  <!-- }}} -->

  <!-- {{{ Édition -->
  <div class="edition-creneau" data-ng-if="creneau.en_creation">
    <div class="row" data-ng-if="creneau.vierge">
      <div class="col-md-6">
	<label>Choisir la classe :</label>
	<select data-ng-model="scope.classe"
		data-ng-options="classe as classe.libelle for classe in classes track by classe.id"
		data-ng-required="true">
	</select>
      </div>

      <div class="col-md-6">
	<label>Choisir la matière :</label>
	<select data-ng-model="scope.matiere"
		data-ng-options="matiere as matiere.libelle_long for matiere in matieres track by matiere.id"
		data-ng-required="true">
	</select>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
	<label>Choisir l'horaire :</label>
	de
	<div class="dropdown horaire">
	  <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#" href="">{{creneau.tmp_heure_debut | date: 'shortTime'}}</a>
	  <ul class="dropdown-menu" role="menu">
	    <timepicker class="timepicker"
			data-ng-model="creneau.tmp_heure_debut"
			data-show-meridian="false"
			data-minute-step="5"
			data-ng-required="true"></timepicker>
	  </ul>
	</div>
	à
	<div class="dropdown horaire">
	  <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#" href="">{{creneau.tmp_heure_fin | date: 'shortTime'}}</a>
	  <ul class="dropdown-menu" role="menu">
	    <timepicker class="timepicker"
			data-ng-model="creneau.tmp_heure_fin"
			data-show-meridian="false"
			data-minute-step="5"
			data-ng-required="true"></timepicker>
	  </ul>
	</div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
	<label>Choisir les semaines actives :</label>
	<div class="btn-group">
	  <button class="btn btn-xs" data-ng-click="apply_template( 'tout' )">Tout</button>
	  <button class="btn btn-xs" data-ng-click="apply_template( 'rien' )">Rien</button>
	  <button class="btn btn-xs" data-ng-click="apply_template( 'paires' )">Paires</button>
	  <button class="btn btn-xs" data-ng-click="apply_template( 'impaires' )">Impaires</button>
	  <button class="btn btn-xs" data-ng-click="apply_template( 'unique' )">Unique</button>
	  <button class="btn btn-xs" data-ng-click="apply_template( 'inverser' )">Inverser</button>
	  <button class="btn btn-xs" data-ng-click="apply_template( 'reinitialiser' )">Réinitialiser</button>
	</div>
	<div class="btn-group">
	  <button type="button" class="btn btn-xs"
		  data-ng-class="{'btn-default': !semaine, 'btn-warning': semaine, 'btn-info': sont_ce_les_vacances( $index + 1, ZONE )}"
		  data-ng-model="semaines_actives.regroupement[ $index ]"
		  btn-checkbox btn-checkbox-true="1" btn-checkbox-false="0"
		  data-ng-repeat="semaine in semaines_actives.regroupement track by $index" >
	    {{$index + 1}}
	  </button>
	</div>

	<div class="pull-right">
	  <label>Légende :</label>
	  <span class="btn btn-xs btn-default" title="Créneau absent de cette semaine">Créneau absent de cette semaine</span>
	  <span class="btn btn-xs btn-warning" title="Créneau présent cette semaine">Créneau présent cette semaine</span>
	  <span class="btn btn-xs btn-info" title="Vacances scolaires">Vacances scolaires</span>
	</div>

      </div>
    </div>
  </div>
  <!-- }}} -->

  <div class="error-messages">
    <div class="alert alert-danger" role="alert" data-ng-repeat="erreur in erreurs">{{erreur.message}}</div>
  </div>
</div>

<div class="modal-body" data-ng-if="!creneau.en_creation && !mode_duplication">
  <tabset>

    <!-- ####################### Séquence Pédagogique du jour ####################### -->
    <tab heading="Séquence pédagogique du jour" >
      <div class="row">
	<div class="col-md-9 contenu">
	  <div class="panel panel-default">

	    <div data-text-angular
		 class="panel-body"
		 data-ng-model="cours.contenu"
		 data-ng-change="is_dirty( cours )"
		 data-ng-if="cours.editable && !cours.deleted" ></div>
	    <div class="panel-body"
		 data-ng-bind-html="cours.contenu"
		 data-ng-if="!cours.editable && !cours.deleted" ></div>
	    <div class="panel-body deleted"
		 data-ng-if="cours.deleted" >(Séquence pédagogique supprimée)</div>
	    <div class="panel-footer ressources" data-ng-if="!cours.deleted">
	      <div class="row">
		<div class="attached-document" data-ng-repeat="ressource in cours.ressources">
		  <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>
		  <button class="btn btn-sm btn-danger" data-ng-click="remove_ressource( cours, ressource.hash )">✕</button>
		</div>
	      </div>

	      <div class="dropdown row" data-ng-if="!creneau.etranger">
		<button class="btn btn-sm btn-primary dropdown-toggle pull-right" role="button" data-toggle="dropdown" data-target="#" href=""
			data-ng-class="{'disabled': faulty_docs_app}">
		  <span class="glyphicon glyphicon-plus-sign"></span> Ajouter une ressource
		</button>
		<ul class="dropdown-menu" role="menu" ng-click="$event.stopPropagation()">
		  <div class="treecontrol-container">
		    <treecontrol class="tree-classic"
				 tree-model="cartable.files"
				 options="treeOptions"
				 expanded-nodes="cartable.expandedNodes"
				 on-selection="treeClicked( node )"
				 data-ng-class="{'even': $even, 'odd': $odd}">
		      {{node.name}} ({{node.mime}}) <button class="btn btn-sm btn-success" data-ng-click="add_ressource( cours, node.name, node.hash )">+</button>
		    </treecontrol>
		  </div>

		  <input type="file"
			 class="upload"
			 name="upload[]"
			 multiple
			 onchange="angular.element(this).scope().upload_and_add_ressource( angular.element(this).scope().cours, this.files)" />
		</ul>
	      </div>
	    </div>
	  </div>
	</div>
	<div class="col-md-3 infos">
	  <ul class="pull-left">
	    <li class="clickable"
		data-ng-repeat="devoir in cours.devoirs"
		data-ng-if="!devoir.deleted"
		tooltip-trigger="click"
		tooltip-html-unsafe="{{devoir.tooltip}}"
		data-ng-class="{ 'type1': devoir.type_devoir_id == 1, 'type2': devoir.type_devoir_id == 2, 'type3': devoir.type_devoir_id == 3, 'type4': devoir.type_devoir_id == 4, 'type5': devoir.type_devoir_id == 5, 'type6': devoir.type_devoir_id == 6, 'fait': devoir.fait }" >
	      <span><i class="picto" data-ng-style="{'background-image':'url(' + app_path + '/app/bower_components/charte-graphique-laclasse-com/images/picto_devoir.svg)'}"></i> Devoir associé : <em>{{devoir.date_due | date : 'dd/MM'}}</em></span>
	    </li>
	  </ul>
	</div>
	<div class="col-md-12" data-ng-if="cours.id">
	  <button type="button" class="btn btn-sm btn-danger pull-right supprimer"
		  data-ng-click="effacer_cours(  )"
		  data-ng-if="cours.deleted || ( !creneau.etranger && cours.editable )" >
	    <span class="glyphicon glyphicon-trash" data-ng-if="!cours.deleted"> Supprimer la séquence pédagogique</span>
	    <span class="glyphicon glyphicon-trash" data-ng-if="cours.deleted"> Annuler la suppression</span>
	  </button>
	</div>
      </div>

      <div class="panel panel-default">
	<div class="panel-heading">
	  Travail à faire suite à cette séquence pédagogique
	</div>
	<div class="panel-body">
	  <button class="btn btn-default ajout-devoir"
		  data-ng-if="!creneau.etranger"
		  data-ng-click="ajout_devoir( cours.devoirs, creneaux_devoirs_possibles[ 1 ] )">
	    <span class="glyphicon glyphicon-plus-sign"></span> Ajouter un devoir
	  </button>
	  <div class="panel panel-default"
	       data-ng-repeat="devoir in cours.devoirs">

	    <div class="col-md-9"
		 data-ng-if="!devoir.deleted">
	      <div class="panel-heading enseignant-saisie" data-ng-if="!creneau.etranger">
		<label class="col-md-6" data-ng-if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir">Type de travail :
		  <select data-ng-required="true"
			  data-ng-change="is_dirty( null )"
			  data-ng-model="devoir.type_devoir_id"
			  data-ng-options="type_de_devoir.id as type_de_devoir.description for type_de_devoir in types_de_devoir">
		  </select>
		</label>
		<label class="col-md-6">Date de rendu :
		  <select data-ng-required="true"
			  data-ng-model="devoir.date_due"
			  data-ng-change="set_creneau_date_due( devoir )"
			  data-ng-options="creneau.date_due as ( creneau | formateCreneau ) group by creneau.semaine for creneau in creneaux_devoirs_possibles">
		  </select>
		</label>

		<div class="col-md-12">
		  <label>Temps de travail estimé : </label>
		  <rating data-ng-model="devoir.temps_estime"
			  max="15"
			  readonly="false"
			  ng-click="is_dirty( null )"
			  on-hover="estimation_over(devoir, value)"
			  on-leave="estimation_leave(devoir)"
			  state-on="'temps-est-on'"
			  state-off="'temps-est-off'"></rating>
		  <span class="label pull-right" data-ng-class="{'label-success': devoir.overValue<4, 'label-info': devoir.overValue>=4 && devoir.overValue<8 , 'label-warning': devoir.overValue>=8 && devoir.overValue<12, 'label-danger': devoir.overValue>=12}" data-ng-if="devoir.overValue > 0 || devoir.temps_estime > 0">{{devoir.minutes || devoir.temps_estime * 5}} min</span>
		</div>
		<div class="clearfix"></div>
	      </div>
	      <text-angular class="panel-body" data-ng-model="devoir.contenu" data-ng-change="is_dirty( devoir )" data-ng-if="!creneau.etranger"></text-angular>

	      <div class="panel-heading enseignant-saisie" data-ng-if="creneau.etranger">
		<label data-ng-if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir">Type de travail : <em>{{devoir.type_devoir.description}}</em></label>
		<label data-ng-if="devoir.temps_estime">Temps de travail estimé : <em>{{devoir.temps_estime * 5}} min</em></label>
	      </div>
	      <div class="panel-body" data-ng-bind-html="devoir.contenu" data-ng-if="creneau.etranger"></div>

	      <div class="panel-footer ressources">
		<div class="row">
		  <div class="attached-document" data-ng-repeat="ressource in devoir.ressources">
		    <a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>
		    <button class="btn btn-sm btn-danger" data-ng-click="remove_ressource( devoir, ressource.hash )">✕</button>
		  </div>
		</div>

		<div class="dropdown row" data-ng-if="!creneau.etranger">
		  <button class="btn btn-sm btn-primary dropdown-toggle pull-right" role="button" data-toggle="dropdown" data-target="#" href=""
			  data-ng-class="{'disabled': faulty_docs_app}">
		    <span class="glyphicon glyphicon-plus-sign"></span> Ajouter une ressource
		  </button>
		  <ul class="dropdown-menu" role="menu" ng-click="$event.stopPropagation()">
		    <div class="treecontrol-container">
		      <treecontrol class="tree-classic"
				   tree-model="cartable.files"
				   options="treeOptions"
				   expanded-nodes="cartable.expandedNodes"
				   on-selection="treeClicked( node )"
				   data-ng-class="{'even': $even, 'odd': $odd}">
			{{node.name}} ({{node.mime}}) <button class="btn btn-sm btn-success" data-ng-click="add_ressource( devoir, node.name, node.hash )">+</button>
		      </treecontrol>
		    </div>

		    <input type="file"
			   class="upload"
			   name="upload[]"
			   multiple
			   onchange="angular.element(this).scope().upload_and_add_ressource( angular.element(this).scope().devoir, this.files)" />
		  </ul>
		</div>
	      </div>

	    </div>

	    <div class="col-md-9 deleted"
		 data-ng-if="devoir.deleted" >(Devoir supprimé)</div>

	    <div class="col-md-12">
	      <button type="button" class="btn btn-sm btn-danger pull-right supprimer"
		      data-ng-click="effacer_devoir( devoir )"
		      data-ng-if="!creneau.etranger && !devoir.cours.deleted">
		<span class="glyphicon glyphicon-trash" data-ng-if="!devoir.deleted"> Supprimer le devoir</span>
		<span class="glyphicon glyphicon-trash" data-ng-if="devoir.deleted"> Annuler la suppression</span>
	      </button>
	    </div>

	    <div class="clearfix"></div>
	  </div>
	</div>
      </div>

    </tab>

    <!-- ####################### Devoirs dûs ce jour ####################### -->
    <tab heading="Travail à faire pour ce jour">
      <button class="btn btn-default ajout-devoir" data-ng-click="ajout_devoir( devoirs, creneau )" data-ng-if="!creneau.etranger">
	<span class="glyphicon glyphicon-plus-sign"></span> Ajouter un devoir
      </button>
      <div class="clearfix"></div>

      <div class="panel panel-default" data-ng-repeat="devoir in devoirs">

	<div class="col-md-9"
	     data-ng-if="!devoir.deleted">

	  <div class="panel-heading enseignant-saisie" data-ng-if="!creneau.etranger">
	    <label class="col-md-12" data-ng-if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir">Type de travail :
	      <select data-ng-required="true"
		      data-ng-change="is_dirty( null )"
		      data-ng-model="devoir.type_devoir_id"
		      data-ng-options="type_de_devoir.id as type_de_devoir.description for type_de_devoir in types_de_devoir">
	      </select>
	    </label>

	    <div class="col-md-12">
	      <label>Temps de travail estimé : </label>
	      <rating data-ng-model="devoir.temps_estime"
		      max="15"
		      readonly="false"
		      ng-click="is_dirty( null )"
		      on-hover="estimation_over(devoir, value)"
		      on-leave="estimation_leave(devoir)"
		      state-on="'temps-est-on'"
		      state-off="'temps-est-off'"></rating>
	      <span class="label pull-right" data-ng-class="{'label-success': devoir.overValue<4, 'label-info': devoir.overValue>=4 && devoir.overValue<8 , 'label-warning': devoir.overValue>=8 && devoir.overValue<12, 'label-danger': devoir.overValue>=12}" data-ng-if="devoir.overValue > 0 || devoir.temps_estime > 0">{{devoir.minutes || devoir.temps_estime * 5}} min</span>
	    </div>
	    <div class="clearfix"></div>
	  </div>
	  <text-angular class="panel-body" data-ng-model="devoir.contenu" data-ng-change="is_dirty( devoir )" data-ng-if="!creneau.etranger"></text-angular>

	  <div class="panel-heading enseignant-saisie" data-ng-if="creneau.etranger">
	    <label>Type de travail : <em>{{devoir.type_devoir.description}}</em></label>
	    <label data-ng-if="devoir.temps_estime">Temps de travail estimé : <em>{{devoir.temps_estime * 5}} min</em></label>
	  </div>
	  <div class="panel-body" data-ng-bind-html="devoir.contenu" data-ng-if="creneau.etranger"></div>

	  <div class="panel-footer ressources">
	    <div class="row">
	      <div class="attached-document" data-ng-repeat="ressource in devoir.ressources">
		<a target="_blank" href="{{ressource.url}}">{{ressource.name}}</a>
		<button class="btn btn-sm btn-danger" data-ng-click="remove_ressource( devoir, ressource.hash )">✕</button>
	      </div>
	    </div>

	    <div class="dropdown row" data-ng-if="!creneau.etranger">
	      <button class="btn btn-sm btn-primary dropdown-toggle pull-right" role="button" data-toggle="dropdown" data-target="#" href=""
		      data-ng-class="{'disabled': faulty_docs_app}">
		<span class="glyphicon glyphicon-plus-sign"></span> Ajouter une ressource
	      </button>
	      <ul class="dropdown-menu" role="menu" ng-click="$event.stopPropagation()">
		<div class="treecontrol-container">
		  <treecontrol class="tree-classic"
			       tree-model="cartable.files"
			       options="treeOptions"
			       expanded-nodes="cartable.expandedNodes"
			       on-selection="treeClicked( node )"
			       data-ng-class="{'even': $even, 'odd': $odd}">
		    {{node.name}} ({{node.mime}}) <button class="btn btn-sm btn-success" data-ng-click="add_ressource( devoir, node.name, node.hash )">+</button>
		  </treecontrol>
		</div>

		<input type="file"
		       class="upload"
		       name="upload[]"
		       multiple
		       onchange="angular.element(this).scope().upload_and_add_ressource( angular.element(this).scope().devoir, this.files)" />
	      </ul>
	    </div>
	  </div>
	</div>

	<div class="col-md-3 infos"
	     data-ng-if="!devoir.deleted">
	  <ul class="pull-left">
	    <li class="clickable">
	      <span data-ng-if="devoir.cours.contenu"
		    data-tooltip-trigger="click"
		    data-tooltip-html-unsafe="{{devoir.cours.contenu}}">
		<span class="glyphicon glyphicon-briefcase"></span> Séquence Pédagogique
	      </span>
	    </li>
	  </ul>
	</div>

	<div class="col-md-9 deleted"
	     data-ng-if="devoir.deleted" >(Devoir supprimé)</div>

	<div class="col-md-12">
	  <button type="button" class="btn btn-sm btn-danger pull-right supprimer"
		  data-ng-click="effacer_devoir( devoir )" data-ng-if="!creneau.etranger && !devoir.cours.deleted">
	    <span class="glyphicon glyphicon-trash" data-ng-if="!devoir.deleted"> Supprimer le devoir</span>
	    <span class="glyphicon glyphicon-trash" data-ng-if="devoir.deleted"> Annuler la suppression</span>
	  </button>
	</div>

	<div class="clearfix"></div>
      </div>
    </tab>

  </tabset>
  <div class="clearfix"></div>
</div>

<!-- Duplication de Séquence Pédagogique -->
<div class="modal-body" data-ng-if="mode_duplication">
  <div class="alert alert-success" role="alert" data-ng-if="creneaux_similaires.length == 0">Plus aucune duplication possible</div>
  <div class="duplication-saisie" data-ng-if="creneaux_similaires.length > 0" >
    <div class="col-md-12">
      <ol>
	<li>
	  <label>Choisir le créneau vers lequel copier la séquence pédagogique :</label>
	  <ul>
	    <li data-ng-bind-html="cours.contenu"></li>
	  </ul>
	  <select data-ng-required
		  data-ng-change="creneau_cible_duplication_SP_updated()"
		  data-ng-model="creneaux_similaires.selected"
		  data-ng-options="creneau as ( creneau | formateCreneau ) group by creneau.classe.libelle for creneau in creneaux_similaires | orderBy:['+classe.libelle', '+date_due']" >
	  </select>
	</li>
	<li data-ng-if="cours.devoirs.length > 0">
	  <label>Choisir le créneau vers lequel copier ses devoirs :</label>
	  <ol>
	    <li data-ng-repeat="devoir in cours.devoirs"
		data-ng-if="!devoir.deleted">
	      <ul>
		<li data-ng-if="current_user.parametrage_cahier_de_textes.affichage_types_de_devoir"><i class="picto" data-ng-style="{'background-image':'url(' + app_path + '/app/bower_components/charte-graphique-laclasse-com/images/picto_devoir.svg)'}"></i> Type de devoir : <em>{{devoir.type_devoir.description}}</em></li>
		<li>Date due : <em>{{devoir.date_due | date:'fullDate'}}</em></li>
		<li data-ng-bind-html="devoir.contenu"></li>
	      </ul>
	      <select data-ng-change="are_we_go_for_duplication()"
		      data-ng-model="devoir.creneau_cible"
		      data-ng-options="creneau as ( creneau | formateCreneau ) for creneau in creneaux_devoirs_possibles_duplication | orderBy:'date_due'" >
	      </select>
	    </li>
	  </ol>
	</li>
      </ol>
    </div>
    <div class="col-md-12 footer">
      <button type="button" class="btn btn-sm btn-success pull-right"
	      data-ng-click="dupliquer()"
	      data-ng-class="{ 'disabled': !ok_go_for_duplication }">
	<span class="glyphicon glyphicon-share"> Dupliquer</span>
      </button>
    </div>
  </div>
  <div class="clearfix"></div>
</div>
<!-- /Duplication de Séquence Pédagogique -->

<div class="modal-footer">
  <button type="button" class="btn btn-sm btn-warning pull-left"
	  data-ng-if="!creneau.etranger && creneau.en_creation"
	  data-ng-click="effacer_creneau()">
    <span class="glyphicon glyphicon-trash"></span> Supprimer le créneau
  </button>

  <button type="button" class="btn btn-sm btn-default pull-left"
	  data-ng-click="switch_to_creneau_edition()"
	  data-ng-if="!creneau.etranger && !creneau.en_creation" >
    <span class="glyphicon glyphicon-edit"> Modifier le créneau</span>
  </button>

  <button type="button" class="btn btn-sm btn-default"
	  data-ng-click="switch_to_duplication_mode()"
	  data-ng-if="!creneau.etranger && cours.contenu && !creneau.en_creation && !mode_duplication && creneaux_similaires.length > 0 && !dirty" >
    <span class="glyphicon glyphicon-transfer"> Copier à d'autres créneaux</span>
  </button>

  <button type="button" class="btn btn-sm btn-default"
	  data-ng-click="switch_to_modification_mode()"
	  data-ng-if="mode_duplication || creneau.en_creation" >
    <span class="glyphicon glyphicon-transfer"> Revenir en modification</span>
  </button>

  <button type="button" class="btn btn-sm btn-success pull-right" data-ng-click="valider()" data-ng-if="!creneau.etranger && dirty || creneau.en_creation">
    <span class="glyphicon glyphicon-ok-sign"></span> Valider
  </button>
  <button type="button" class="btn btn-sm btn-default pull-right" data-ng-click="annuler()">
    <span class="glyphicon glyphicon-remove-sign"></span> <span data-ng-if="dirty || creneau.en_creation">Annuler</span>
    <span data-ng-if="!dirty && !creneau.en_creation">Fermer</span>
  </button>
</div>

<iframe data-ng-src="{{DOCS_URL_login}}" style="display:none;"></iframe>
